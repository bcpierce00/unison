<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="generator" content="hevea 2.35">
<style type="text/css">
.equationcontainer{position:relative;}
.equationnumber{float:right;left:auto;position:absolute;right:0}
.equationnumber-valign{float:right;left:auto;position:absolute;right:0;margin-top:-0.5em;}
.floatrule{background-color: black; border: none; height: 1px; width: 80%}
.phantom{display: inline-block; visibility: hidden}
.hphantom{display: inline-block; height: 0; visibility: hidden}
.vphantom{display: inline-block; visibility: hidden; width: 0}
.smash{display: inline-block; height: 0; line-height: 0}
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.toc{list-style:none;}
.footnotetext{margin:0ex; padding:0ex;}
div.footnotetext P{margin:0px; text-indent:1em;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.footnoterule{background-color: black; border: none; height: 1px; margin: 1em auto 1em 0px; width: 40%}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.title{margin:2ex auto;text-align:center}
.titlemain{margin:1ex 2ex 2ex 1ex;}
.titlerest{margin:0ex 2ex;}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
div table{margin-left:inherit;margin-right:inherit;margin-bottom:2px;margin-top:2px}
td table{margin:auto;}
table{border-collapse:collapse;}
td{padding:0;}
.cellpadding0 tr td{padding:0;}
.cellpadding1 tr td{padding:1px;}
pre{text-align:left;margin-left:0ex;margin-right:auto;}
blockquote{margin-left:4ex;margin-right:4ex;text-align:left;}
td p{margin:0px;}
.quote{margin-left:3em;margin-right:3em;text-align:inherit;text-indent:0pt}
.quotation{margin-left:3em;margin-right:3em;text-align:inherit;text-indent:1.5em}
.verse{margin-left:3em;margin-right:3em;text-indent:1.5em hanging each-line}
.parbox{box-sizing: border-box;
display: inline-block;
text-indent: 0;
}
.rule-rect{fill: black;}
.lrbox{box-sizing:border-box;display:inline-block;overflow:visible;white-space:nowrap;}
.center-lrbox{display:inline-block;margin-left:50%;transform:translateX(-50%);}
.makebox{}
.framebox{border:1px solid black;padding:0.25em;}
.vertical-rule{border:none;width:2px;background-color:black;}
.horizontal-rule{border:none;background-color:black;}
.hrule{border:none;height:2px;width:100%;background-color:black;}
.hfill{border:none;height:1px;width:200%;background-color:black;}
.vdisplay{border-collapse:separate;border-spacing:2px;line-height:1.1;width:auto; empty-cells:show; border:2px solid red;}
.vdcell{white-space:nowrap;padding:0px; border:2px solid green;}
.display{border-collapse:separate;border-spacing:2px;line-height:1.1;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px; border:none;}
.dcenter{margin:0ex auto;}
.vdcenter{border:solid #FF8000 2px; margin:0ex auto;}
.minipage{text-align:left; margin-left:0em; margin-right:auto;}
.marginpar{border:solid thin black; margin-bottom:1ex; width:20%; text-align:left;}
.marginparleft{float:left; clear:left; margin-left:0ex; margin-right:1ex;}
.marginparright{float:right; clear:right; margin-left:1ex; margin-right:0ex;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
</style>

 <META name="Author" content="Benjamin C. Pierce">
 <link rel="stylesheet" href="/home/bcpierce/pub/unison/unison.css">
 
<title>unison-manual</title>
</head>
<body >
<!--HEVEA command line is: hevea unison-manual.tex -->
<!--CUT STYLE article--><!--CUT DEF section 1 --><p><div id="manualbody"></p><div class="center"><span style="font-size:xx-large"><span style="font-size:150%"><span style="color:red">DraftDraftDraftDraft</span></span></span></div><p><div id="manualheader"></p><div class="center"><span style="font-size:xx-large"><span style="font-size:150%"><span style="color:black">Unison File Synchronizer</span></span></span><span style="font-size:xx-large"><span style="font-size:150%"><br>
</span></span><span style="font-size:150%"><span style="font-size:xx-large"><span style="color:black">User Manual and Reference Guide</span></span></span><span style="font-size:150%"><span style="font-size:xx-large"><br>
<span style="font-size:x-large">Version 2.51.4<br>
<span style="font-size:large">Copyright 1998-2020, Benjamin C. Pierce
</span></span></span></span></div><p></div></p><!--TOC section id="sec1" Contents-->
<h2 id="sec1" class="section">Contents</h2><!--SEC END --><blockquote class="quote">
<a href="#overview"><span style="font-size:large"><span style="font-weight:bold">Overview</span></span></a><br>
<a href="#intro"><span style="font-size:large"><span style="font-weight:bold">Preface</span></span></a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#people">People</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#lists">Mailing Lists and Bug Reporting</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#status">Development Status</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#copying">Copying</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#ack">Acknowledgements</a><br>
<a href="#install"><span style="font-size:large"><span style="font-weight:bold">Installation</span></span></a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#download">Downloading Unison</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#afterinstall">Running Unison</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#upgrading">Upgrading</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#building">Building Unison from Scratch</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;<a href="#build-unix">Unix</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;<a href="#build-osx">Mac OS X</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;<a href="#build-win">Windows</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;<a href="#build-opts">Installation Options</a><br>
<a href="#tutorial"><span style="font-size:large"><span style="font-weight:bold">Tutorial</span></span></a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#prelim">Preliminaries</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#local">Local Usage</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#remote">Remote Usage</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#rshmeth">Remote Shell Method</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#socketmeth">Socket Method</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#usingit">Using Unison for All Your Files</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#usingmultiple">Using Unison to Synchronize More Than Two Machines</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#further">Going Further</a><br>
<a href="#basics"><span style="font-size:large"><span style="font-weight:bold">Basic Concepts</span></span></a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#roots">Roots</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#paths">Paths</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#updates">What is an Update?</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#conflicts">What is a Conflict?</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#recon">Reconciliation</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#failures">Invariants</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#caveats">Caveats and Shortcomings</a><br>
<a href="#reference"><span style="font-size:large"><span style="font-weight:bold">Reference Guide</span></span></a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#running">Running Unison</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#unisondir">The <span style="font-family:monospace">.unison</span> Directory</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#archives">Archive Files</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#prefs">Preferences</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#profile">Profiles</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#profileegs">Sample Profiles</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;<a href="#minimalprofile">A Minimal Profile</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;<a href="#basicprofile">A Basic Profile</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;<a href="#powerprofile">A Power-User Profile</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#backups">Keeping Backups</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#merge">Merging Conflicting Versions</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#ui">The User Interface</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#exit">Exit Code</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#pathspec">Path Specification</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#ignore">Ignoring Paths</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#symlinks">Symbolic Links</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#perms">Permissions</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#crossplatform">Cross-Platform Synchronization</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#speed">Slow Links</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#speeding">Making Unison Faster on Large Files</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#fastcheck">Fast Update Detection</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#mountpoints">Mount Points and Removable Media</a><br>
&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2003;&#X2022;<a href="#click">Click-starting Unison</a><br>
<a href="#ssh"><span style="font-size:large"><span style="font-weight:bold">Ssh</span></span></a><br>
<a href="#news"><span style="font-size:large"><span style="font-weight:bold">Changes in Version 2.51.4</span></span></a><br>

</blockquote><p><hr></p><!--TOC section id="sec2" Overview-->
<h2 id="sec2" class="section">Overview</h2><!--SEC END --><p>Unison is a file-synchronization tool for Unix and Windows. It allows
two replicas of a collection of files and directories to be stored on
different hosts (or different disks on the same host), modified
separately, and then brought up to date by propagating the changes in
each replica to the other.</p><p>Unison
shares a number of features with tools such as configuration
management packages (<a href="http://www.cyclic.com/">CVS</a>,
<a href="http://www.XCF.Berkeley.EDU/~jmacd/prcs.html">PRCS</a>,
etc.),
distributed filesystems
(<a href="http://www.coda.cs.cmu.edu/">Coda</a>,
etc.),
uni-directional mirroring utilities
(<a href="http://samba.anu.edu.au/rsync/">rsync</a>,
etc.),
and other synchronizers
(<a href="http://www.pumatech.com">Intellisync</a>,
<a href="http://www.merl.com/reports/TR99-14/">Reconcile</a>,
etc). 
However, there are several points where it differs:
</p><ul class="itemize"><li class="li-itemize">
Unison runs on both Windows (95, 98, NT, 2k, and XP) and Unix (OSX, Solaris,
Linux, etc.) systems. Moreover, Unison works <em>across</em>
platforms, allowing you to synchronize a Windows laptop with a
Unix server, for example.
</li><li class="li-itemize">Unlike a distributed filesystem, Unison is a user-level program:
there is no need to modify the kernel or to have
superuser privileges on either host.
</li><li class="li-itemize">Unlike simple mirroring or backup utilities, Unison can deal
with updates to both replicas of a distributed directory structure.
Updates that do not conflict are propagated automatically.
Conflicting updates are detected and displayed.
</li><li class="li-itemize">Unison works between any pair of machines connected to the
internet, communicating over either a direct socket link or
tunneling over an encrypted <span style="font-family:monospace">ssh</span> connection.
It is careful with network bandwidth, and runs well over slow links
such as PPP connections. Transfers of small updates to large files are
optimized using a compression protocol similar to rsync.
</li><li class="li-itemize">Unison has a clear and precise specification, described
below. </li><li class="li-itemize">Unison is resilient to failure. It is careful to leave the
replicas and its own private structures in a sensible state at all
times, even in case of abnormal termination or communication
failures.
</li><li class="li-itemize">Unison is free; full source code is available under the GNU
Public License.
</li></ul><p><hr></p><!--TOC section id="sec3" Preface-->
<h2 id="sec3" class="section">Preface</h2><!--SEC END --><!--TOC subsection id="sec4" People-->
<h3 id="sec4" class="subsection">People</h3><!--SEC END --><p><a href="http://www.cis.upenn.edu/~bcpierce/">Benjamin Pierce</a> leads the
Unison project.
The current version of Unison was designed and implemented by
<a href="http://www.research.att.com/~trevor/">Trevor Jim</a>,
<a href="http://www.cis.upenn.edu/~bcpierce/">Benjamin Pierce</a>,
and
<a href="http://www.pps.jussieu.fr/~vouillon/">J&#XE9;r&#XF4;me Vouillon</a>,
with
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>,
Malo Denielou,
<a href="http://www.brics.dk/~zheyang/">Zhe Yang</a>,
Sylvain Gommier, and
Matthieu Goulay.
The Mac user interface was started by Trevor Jim and enormously improved by
Ben Willmore.
Our implementation of the
<a href="http://samba.org/rsync/">rsync</a>
protocol was built by
<a href="http://www.eecs.harvard.edu/~nr/">Norman Ramsey</a>
and Sylvain Gommier. It is based on
<a href="http://samba.anu.edu.au/~tridge/">Andrew Tridgell</a>&#X2019;s
<a href="http://samba.anu.edu.au/~tridge/phd_thesis.pdf">thesis work</a>
and inspired by his
<a href="http://samba.org/rsync/">rsync</a>
utility.
The mirroring and merging functionality was implemented by
Sylvain Roy, improved by Malo Denielou, and improved yet further by
St&#XE9;phane Lescuyer.
<a href="http://wwwfun.kurims.kyoto-u.ac.jp/~garrigue/">Jacques Garrigue</a>
contributed the original Gtk version of the user
interface; the Gtk2 version was built by Stephen Tse.
Sundar Balasubramaniam helped build a prototype implementation of
an earlier synchronizer in Java.
<a href="http://www.cis.upenn.edu/~ishin/">Insik Shin</a>
and
<a href="http://www.cis.upenn.edu/~lee/">Insup Lee</a> contributed design
ideas to this implementation.
<a href="http://research.microsoft.com/~fournet/">Cedric Fournet</a>
contributed to an even earlier prototype.</p><!--TOC subsection id="sec5" Mailing Lists and Bug Reporting-->
<h3 id="sec5" class="subsection">Mailing Lists and Bug Reporting</h3><!--SEC END -->
<!--TOC paragraph id="sec6" Mailing Lists:-->
<h4 id="sec6" class="paragraph">Mailing Lists:</h4><!--SEC END --><p>Moderated mailing lists are available for discussions among users and
discussions among developers.
See
</p><blockquote class="quote">
<a href="https://github.com/bcpierce00/unison/wiki/Mailing-Lists"><span style="font-family:monospace">https://github.com/bcpierce00/unison/wiki/Mailing-Lists</span></a>
</blockquote><p>
for descriptions of what content is appropriate on which list, and
subscripion instructions.</p>
<!--TOC paragraph id="sec7" Reporting bugs:-->
<h4 id="sec7" class="paragraph">Reporting bugs:</h4><!--SEC END --><p>Reports of bugs affecting correctness or safety are of interest to
many people.
If Unison is not working the way you expect, see the instructions for
debugging, reporting bugs, and asking for help at
</p><blockquote class="quote">
<a href="https://github.com/bcpierce00/unison/wiki/Reporting-Bugs-and-Feature-Requests"><span style="font-family:monospace">https://github.com/bcpierce00/unison/wiki/Reporting-Bugs-and-Feature-Requests</span></a>
</blockquote>
<!--TOC paragraph id="sec8" Feature Requests:-->
<h4 id="sec8" class="paragraph">Feature Requests:</h4><!--SEC END --><p>Requests for features likely to be of interest to others are welcome,
but will probably just be added to the ever-growing todo list.
Please see the URL in the previous section for guidance on feature
requests.
</p><!--TOC subsection id="sec9" Development Status-->
<h3 id="sec9" class="subsection">Development Status</h3><!--SEC END --><p>Unison is no longer under active development as a research
project. (Our research efforts are now focused on a follow-on
project called Boomerang, described at
<a href="http://www.cis.upenn.edu/~bcpierce/harmony"><span style="font-family:monospace">http://www.cis.upenn.edu/~bcpierce/harmony</span></a>.)
At this point, there is no one whose job it is to maintain Unison,
fix bugs, or answer questions.</p><p>However, the original developers are all still using Unison daily. It
will continue to be maintained and supported for the foreseeable future,
and we will occasionally release new versions with bug fixes, small
improvements, and contributed patches.</p><p>Proposed changes to unison are welcome.
They should be submitted as pull requests.
(Since safety and robustness are Unison&#X2019;s most important properties,
patches will be held to high standards of clear design and clean coding.)
If you want to contribute to Unison, start by downloading the developer
tarball from the download page. For some details on how the code is
organized, etc., see the file <span style="font-family:monospace">CONTRIB</span>.</p><!--TOC subsection id="sec10" Copying-->
<h3 id="sec10" class="subsection">Copying</h3><!--SEC END --><p>This file is part of Unison.</p><p>Unison is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.</p><p>Unison is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.</p><p>The GNU General Public License can be found at
<a href="http://www.gnu.org/licenses"><span style="font-family:monospace">http://www.gnu.org/licenses</span></a>. A copy is also included in the
Unison source distribution in the file <span style="font-family:monospace">COPYING</span>.</p><!--TOC subsection id="sec11" Acknowledgements-->
<h3 id="sec11" class="subsection">Acknowledgements</h3><!--SEC END --><p>Work on Unison has been supported by the National Science Foundation
under grants CCR-9701826 and ITR-0113226, <em>Principles and Practice of
Synchronization</em>, and by University of Pennsylvania&#X2019;s Institute for
Research in Cognitive Science (IRCS).</p><p><hr></p><!--TOC section id="sec12" Installation-->
<h2 id="sec12" class="section">Installation</h2><!--SEC END --><p>Unison is designed to be easy to install. The following sequence of
steps should get you a fully working installation in a few minutes. If
you run into trouble, you may find the suggestions on the
<a href="http://www.cis.upenn.edu/~bcpierce/unison/faq.html">Frequently Asked
Questions page</a> helpful. Pre-built binaries are available for a
variety of platforms.</p><p>Unison can be used with either of two user interfaces:
</p><ol class="enumerate" type=1><li class="li-enumerate">
a simple textual interface, suitable for dumb terminals (and
running from scripts), and
</li><li class="li-enumerate">a more sophisticated graphical interface, based on Gtk2 (on
Linux/Windows) or the native UI framework (on OSX).
</li></ol><p>You will need to install a copy of Unison on every machine that you
want to synchronize. However, you only need the version with a
graphical user interface (if you want a GUI at all) on the machine
where you&#X2019;re actually going to display the interface (the <em>client</em>
machine). Other machines that you synchronize with can get along just
fine with the textual version.</p><!--TOC subsection id="sec13" Downloading Unison-->
<h3 id="sec13" class="subsection">Downloading Unison</h3><!--SEC END --><p>See <a href="https://github.com/bcpierce00/unison/wiki/Downloading-Unison"><span style="font-family:monospace">https://github.com/bcpierce00/unison/wiki/Downloading-Unison</span></a>.</p><p>If a pre-built binary of Unison is available for the client machine&#X2019;s
architecture, just download it and put it somewhere in your search
path (if you&#X2019;re going to invoke it from the command line) or on your
desktop (if you&#X2019;ll be click-starting it).</p><p>The executable file for the graphical version (with a name including
<code class="verb">gtkui</code>) actually provides <em>both</em> interfaces: the graphical one
appears by default, while the textual interface can be selected by including
<code class="verb">-ui text</code> on the command line. The <code class="verb">textui</code> executable
provides just the textual interface.</p><p>If you don&#X2019;t see a pre-built executable for your architecture, you&#X2019;ll
need to build it yourself. See the <a href="#building">Building Unison from Scratch</a> section.</p><p>Check to make sure that what you have downloaded is really executable.
Either click-start it, or type <span style="font-size:large"><span style="font-family:monospace">unison -version</span></span> at the command
line.</p><p>Unison can be used in three different modes: with different directories on a
single machine, with a remote machine over a direct socket connection, or
with a remote machine using <span style="font-family:monospace">ssh</span> for authentication and secure
transfer. If you intend to use the last option, you may need to install
<span style="font-family:monospace">ssh</span>; see the <a href="#ssh">Installing Ssh</a> section.</p><!--TOC subsection id="sec14" Running Unison-->
<h3 id="sec14" class="subsection">Running Unison</h3><!--SEC END --><p>Once you&#X2019;ve got Unison installed on at least one system, read
the <a href="#tutorial">Tutorial</a> section of the user manual (or type <span style="font-size:large"><span style="font-family:monospace">unison -doc
tutorial</span></span>) for instructions on how to get started.</p><!--TOC subsection id="sec15" Upgrading-->
<h3 id="sec15" class="subsection">Upgrading</h3><!--SEC END --><p>Upgrading to a new version of Unison is as simple as throwing away the old
binary and installing the new one.</p><p>Before upgrading, it is a good idea to run the <em>old</em> version one last
time, to make sure all your replicas are completely synchronized. A new
version of Unison will sometimes introduce a different format for the
archive files used to remember information about the previous state of the
replicas. In this case, the old archive will be ignored (not deleted &#X2014; if
you roll back to the previous version of Unison, you will find the old
archives intact), which means that any differences between the replicas will
show up as conflicts that need to be resolved manually.</p><!--TOC subsection id="sec16" Building Unison from Scratch-->
<h3 id="sec16" class="subsection">Building Unison from Scratch</h3><!--SEC END --><p>If a pre-built image is not available, you will need to compile it from
scratch; the sources are available from the same place as the binaries.</p><p>In principle, Unison should work on any platform to which OCaml has been
ported and on which the <code class="verb">Unix</code> module is fully implemented. It has
been tested on many flavors of Windows (98, NT, 2000, XP) and Unix (OS X,
Solaris, Linux, FreeBSD), and on both 32- and 64-bit architectures.</p><!--TOC subsubsection id="sec17" Unix-->
<h4 id="sec17" class="subsubsection">Unix</h4><!--SEC END --><p>Unison can be built with or without a graphical user interface (GUI). The
build system will decide automatically depending on the libraries installed
on your system, but you can also type <span style="font-family:monospace">make UISTYLE=text</span> to build
Unison without GUI.</p><p>You&#X2019;ll need the Objective Caml compiler,
available from <a href="http://caml.inria.fr"><span style="font-family:monospace">http://caml.inria.fr</span></a>. OCaml is available from most
package managers
Building and installing OCaml
on Unix systems is very straightforward; just follow the instructions in the
distribution. You&#X2019;ll probably want to build the native-code compiler in
addition to the bytecode compiler, as Unison runs much faster when compiled
to native code, but this is not absolutely necessary.
(Quick start: on many systems, the following sequence of commands will
get you a working and installed compiler: first do <span style="font-family:monospace">make world opt</span>,
then <span style="font-family:monospace">su</span> to root and do <span style="font-family:monospace">make install</span>.)</p><p>You&#X2019;ll also need the GNU <span style="font-family:monospace">make</span> utility, which is standard on most Unix
systems. Unison&#X2019;s build system is not parallelizable, so don&#X2019;t use flags
that cause it to start processes in parallel (e.g. -j).</p><p>Once you&#X2019;ve got OCaml installed, grab a copy of the Unison sources, unzip
and untar them, change to the new <span style="font-size:large"><span style="font-family:monospace">unison</span></span> directory, and type &#X201C;<span style="font-family:monospace">make UISTYLE=text</span>&#X201D;. The result should be an executable file called
<span style="font-size:large"><span style="font-family:monospace">unison</span></span>. Type <span style="font-size:large"><span style="font-family:monospace">./unison</span></span> to make sure the program is
executable. You should get back a usage message.</p><p>If you want to build the graphical user interface, you will need to install
some additional things:
</p><ul class="itemize"><li class="li-itemize">
The Gtk2 development libraries (package <span style="font-family:monospace">libgtk2.0-dev</span> on debian
based systems).
</li><li class="li-itemize">OCaml bindings for Gtk2. Install them from your software repositories
(package <span style="font-family:monospace">liblablgtk2-ocaml</span> on debian based systems). Also available
from <a href="http://wwwfun.kurims.kyoto-u.ac.jp/soft/olabl/lablgtk.html"><span style="font-family:monospace">http://wwwfun.kurims.kyoto-u.ac.jp/soft/olabl/lablgtk.html</span></a>.
</li><li class="li-itemize">Pango, a text rendering library and a part of Gtk2. On some systems
(e.g. Ubuntu) the bindings between Pango and OCaml need to be installed
explicitly (package <span style="font-family:monospace">liblablgtk-extras-ocaml-dev</span> on Ubuntu).
</li></ul><p>
Type <span style="font-family:monospace">make src</span> to build Unison. If Gtk2 is available on the system,
Unison with a GUI will be built automatically.</p><p>Put the <code class="verb">unison</code> executable somewhere in your search path, either by
adding the Unison directory to your PATH variable or by copying the
executable to some standard directory where executables are stored. Or just
type <span style="font-family:monospace">make install</span> to install Unison to <span style="font-family:monospace">$HOME/bin/unison</span>.</p><!--TOC subsubsection id="sec18" Mac OS X-->
<h4 id="sec18" class="subsubsection">Mac OS X</h4><!--SEC END --><p>To build the text-only user interface, follow the instructions above for
building on Unix systems. You should do this first, even if you are also
planning on building the GUI, just to make sure it works.</p><p>To build the basic GUI version, you&#X2019;ll first need to download and install
the XCode developer tools from Apple. Once this is done, just type <span style="font-family:monospace">make</span> in the <span style="font-family:monospace">src</span> directory, and if things go well you
should get an application that you can move from <span style="font-family:monospace">uimac/build/Default/Unison.app</span> to wherever you want it.</p><!--TOC subsubsection id="sec19" Windows-->
<h4 id="sec19" class="subsubsection">Windows</h4><!--SEC END --><p>Although the binary distribution should work on any version of Windows,
some people may want to build Unison from scratch on those systems too.</p>
<!--TOC paragraph id="sec20" Bytecode version:-->
<h4 id="sec20" class="paragraph">Bytecode version:</h4><!--SEC END --><p> The simpler but slower compilation option
to build a Unison executable is to build a bytecode version. You need
first install Windows version of the OCaml compiler (version 3.07 or
later, available from <a href="http://caml.inria.fr"><span style="font-family:monospace">http://caml.inria.fr</span></a>). Then grab a copy
of Unison sources and type
</p><pre class="verbatim">       make NATIVE=false
</pre><p>
to compile the bytecode. The result should be an executable file called
<code class="verb">unison.exe</code>.</p>
<!--TOC paragraph id="sec21" Native version:-->
<h4 id="sec21" class="paragraph">Native version:</h4><!--SEC END --><p> Building a more efficient, native version of
Unison on Windows requires a little more work. See the file <span style="font-family:monospace">INSTALL.win32</span> in the source code distribution.</p><!--TOC subsubsection id="sec22" Installation Options-->
<h4 id="sec22" class="subsubsection">Installation Options</h4><!--SEC END --><p>The <code class="verb">Makefile</code> in the distribution includes several switches that
can be used to control how Unison is built. Here are the most useful
ones:
</p><ul class="itemize"><li class="li-itemize">
Building with <code class="verb">NATIVE=true</code> uses the native-code OCaml
compiler, yielding an executable that will run quite a bit faster. We use
this for building distribution versions.
</li><li class="li-itemize">Building with <code class="verb">make DEBUGGING=true</code> generates debugging
symbols.
</li><li class="li-itemize">Building with <code class="verb">make STATIC=true</code> generates a (mostly)
statically linked executable. We use this for building distribution
versions, for portability.
</li></ul><p><hr></p><!--TOC section id="sec23" Tutorial-->
<h2 id="sec23" class="section">Tutorial</h2><!--SEC END --><!--TOC subsection id="sec24" Preliminaries-->
<h3 id="sec24" class="subsection">Preliminaries</h3><!--SEC END --><p>Unison can be used with either of two user interfaces:
</p><ol class="enumerate" type=1><li class="li-enumerate">
a straightforward textual interface and
</li><li class="li-enumerate">a more sophisticated graphical interface
</li></ol><p>
The textual interface is more convenient for running from scripts and
works on dumb terminals; the graphical interface is better for most
interactive use. For this tutorial, you can use either. If you are running
Unison from the command line, just typing <span style="font-family:monospace">unison</span>
will select either the text or the graphical interface, depending on which
has been selected as default when the executable you are running was
built. You can force the text interface even if graphical is the default by
adding <span style="font-family:monospace">-ui text</span>.
The other command-line arguments to both versions are identical.</p><p>The graphical version can also be run directly by clicking on its icon, but
this may require a little set-up (see the <a href="#click">Click-starting
Unison</a> section). For this tutorial, we assume that you&#X2019;re starting it from the
command line.</p><p>Unison can synchronize files and directories on a single machine, or
between two machines on a network. (The same program runs on both
machines; the only difference is which one is responsible for
displaying the user interface.) If you&#X2019;re only interested in a
single-machine setup, then let&#X2019;s call that machine the <em>client</em>. If
you&#X2019;re synchronizing two machines, let&#X2019;s call them <em>client</em> and
<em>server</em>.</p><!--TOC subsection id="sec25" Local Usage-->
<h3 id="sec25" class="subsection">Local Usage</h3><!--SEC END --><p>Let&#X2019;s get the client machine set up first and see how to synchronize
two directories on a single machine.</p><p>Follow the instructions in the <a href="#install">Installation</a> section to either
download or build an executable version of Unison, and install it
somewhere on your search path. (If you just want to use the textual user
interface, download the appropriate textui binary. If you just want to
the graphical interface&#X2014;or if you will use both interfaces [the gtkui
binary actually has both compiled in]&#X2014;then download the gtkui binary.)</p><p>Create a small test directory <span style="font-family:monospace">a.tmp</span> containing a couple of files
and/or subdirectories, e.g.,
</p><pre class="verbatim">       mkdir a.tmp
       touch a.tmp/a a.tmp/b
       mkdir a.tmp/d
       touch a.tmp/d/f
</pre><p>
Copy this directory to b.tmp:
</p><pre class="verbatim">       cp -r a.tmp b.tmp
</pre><p>Now try synchronizing <span style="font-family:monospace">a.tmp</span> and <span style="font-family:monospace">b.tmp</span>. (Since they are
identical, synchronizing them won&#X2019;t propagate any changes, but Unison
will remember the current state of both directories so that it will be
able to tell next time what has changed.) Type:
</p><pre class="verbatim">       unison a.tmp b.tmp
</pre><p>
(You may need to add <code class="verb">-ui text</code>, depending how your unison binary was built.)</p><p><br>
<em>Textual Interface:</em></p><ul class="itemize"><li class="li-itemize">

You should see a message notifying you that all the files are actually
equal and then get returned to the command line.
</li></ul><p><br>
<em>Graphical Interface:</em></p><ul class="itemize"><li class="li-itemize">

You should get a big empty window with a message at the bottom
notifying you that all files are identical. Choose the Exit item from
the File menu to get back to the command line.
</li></ul><p>Next, make some changes in a.tmp and/or b.tmp. For example:
</p><pre class="verbatim">        rm a.tmp/a
        echo "Hello" &gt; a.tmp/b
        echo "Hello" &gt; b.tmp/b
        date &gt; b.tmp/c
        echo "Hi there" &gt; a.tmp/d/h
        echo "Hello there" &gt; b.tmp/d/h
</pre><p>
Run Unison again:
</p><pre class="verbatim">       unison a.tmp b.tmp
</pre><p>This time, the user interface will display only the files that have
changed. If a file has been modified in just one
replica, then it will be displayed with an arrow indicating the
direction that the change needs to be propagated. For example,
</p><pre class="verbatim">                 &lt;---  new file   c  [f]
</pre><p>
indicates that the file <span style="font-family:monospace">c</span> has been modified only in the second
replica, and that the default action is therefore to propagate the new
version to the first replica. To <span style="font-weight:bold">f</span>ollow Unison&#X2019;s recommendation,
press the &#X201C;f&#X201D; at the prompt.</p><p>If both replicas are modified and their contents are different, then
the changes are in conflict: <span style="font-family:monospace">&lt;-?-&gt;</span> is displayed to indicate
that Unison needs guidance on which replica should override the
other.
</p><pre class="verbatim">     new file  &lt;-?-&gt;  new file   d/h  []
</pre><p>
By default, neither version will be propagated and both
replicas will remain as they are.</p><p>If both replicas have been modified but their new contents are the same
(as with the file <span style="font-family:monospace">b</span>), then no propagation is necessary and
nothing is shown. Unison simply notes that the file is up to date.</p><p>These display conventions are used by both versions of the user
interface. The only difference lies in the way in which Unison&#X2019;s
default actions are either accepted or overridden by the user.</p><p><br>
<em>Textual Interface:</em></p><ul class="itemize"><li class="li-itemize">

The status of each modified file is displayed, in turn.
When the copies of a file in the two replicas are not identical, the
user interface will ask for instructions as to how to propagate the
change. If some default action is indicated (by an arrow), you can
simply press Return to go on to the next changed file. If you want to
do something different with this file, press &#X201C;<code class="verb">&lt;</code>&#X201D; or &#X201C;<code class="verb">&gt;</code>&#X201D; to force
the change to be propagated from right to left or from left to right,
or else press &#X201C;<code class="verb">/</code>&#X201D; to skip this file and leave both replicas alone.
When it reaches the end of the list of modified files, Unison will ask
you one more time whether it should proceed with the updates that have
been selected.<p>When Unison stops to wait for input from the user, pressing &#X201C;<code class="verb">?</code>&#X201D;
will always give a list of possible responses and their meanings.
</p></li></ul><p><br>
<em>Graphical Interface:</em></p><ul class="itemize"><li class="li-itemize">

The main window shows all the files that have been modified in either
<span style="font-family:monospace">a.tmp</span> or <span style="font-family:monospace">b.tmp</span>. To override a default action (or to select
an action in the case when there is no default), first select the file, either
by clicking on its name or by using the up- and down-arrow keys. Then
press either the left-arrow or &#X201C;<code class="verb">&lt;</code>&#X201D; key (to cause the version in b.tmp to
propagate to a.tmp) or the right-arrow or &#X201C;<code class="verb">&gt;</code>&#X201D; key (which makes the a.tmp
version override b.tmp).<p>Every keyboard command can also be invoked from the menus at the top
of the user interface. (Conversely, each menu item is annotated with
its keyboard equivalent, if it has one.)</p><p>When you are satisfied with the directions for the propagation of changes
as shown in the main window, click the &#X201C;Go&#X201D; button to set them in
motion. A check sign will be displayed next to each filename
when the file has been dealt with.
</p></li></ul><!--TOC subsection id="sec26" Remote Usage-->
<h3 id="sec26" class="subsection">Remote Usage</h3><!--SEC END --><p>Next, we&#X2019;ll get Unison set up to synchronize replicas on two different
machines.</p><p>Follow the instructions in the Installation section to download or
build an executable version of Unison on the server machine, and
install it somewhere on your search path. (It doesn&#X2019;t matter whether
you install the textual or graphical version, since the copy of Unison on
the server doesn&#X2019;t need to display any user interface at all.)</p><p>It is important that the version of Unison installed on the server
machine is the same as the version of Unison on the client machine.
But some flexibility on the version of Unison at the client side can
be achieved by using the <code class="verb">-addversionno</code> option; see
the <a href="#prefs">Preferences</a> section.</p><p>Now there is a decision to be made. Unison provides two methods for
communicating between the client and the server:
</p><ul class="itemize"><li class="li-itemize">
<em>Remote shell method</em>: To use this method, you must have
some way of invoking remote commands on the server from the client&#X2019;s
command line, using a facility such as <code class="verb">ssh</code>.
This method is more convenient (since there is no need to manually
start a &#X201C;unison server&#X201D; process on the server) and also more
secure (especially if you use <code class="verb">ssh</code>).</li><li class="li-itemize"><em>Socket method</em>: This method requires only that you can get
TCP packets from the client to the server and back. A draconian
firewall can prevent this, but otherwise it should work anywhere.
</li></ul><p>Decide which of these you want to try, and continue with
the <a href="#rshmeth">Remote Shell Method</a> section or
the <a href="#socketmeth">Socket Method</a> section, as appropriate.</p><!--TOC subsection id="sec27" Remote Shell Method-->
<h3 id="sec27" class="subsection">Remote Shell Method</h3><!--SEC END --><p>The standard remote shell facility on Unix systems is <code class="verb">ssh</code>, which provides the
same functionality as the older <code class="verb">rsh</code> but much better security. Ssh is available from
<a href="http://www.openssh.org"><span style="font-family:monospace">http://www.openssh.org</span></a>. See section&#X2004;&#X200D;<a href="#ssh-win">??</a>
for installation instructions for the Windows version.</p><p>Running
<code class="verb">ssh</code> requires some coordination between the client and server
machines to establish that the client is allowed to invoke commands on
the server; please refer to the <code class="verb">ssh</code> documentation
for information on how to set this up. The examples in this section
use <code class="verb">ssh</code>, but you can substitute <code class="verb">rsh</code> for <code class="verb">ssh</code> if
you wish.</p><p>First, test that we can invoke Unison on the server from the client.
Typing
</p><pre>
        ssh <span style="font-style:italic">remotehostname</span> unison -version
</pre><p>
should print the same version information as running
</p><pre class="verbatim">        unison -version
</pre><p>
locally on the client. If remote execution fails, then either
something is wrong with your ssh setup (e.g., &#X201C;permission denied&#X201D;)
or else the search path that&#X2019;s being used when executing commands on
the server doesn&#X2019;t contain the <code class="verb">unison</code> executable (e.g.,
&#X201C;command not found&#X201D;).</p><p>Create a test directory <span style="font-family:monospace">a.tmp</span> in your home directory on the client
machine.</p><p>Test that the local unison client can start and connect to the
remote server. Type
</p><pre>
          unison -testServer a.tmp ssh://<span style="font-style:italic">remotehostname</span>/a.tmp
</pre><p>Now cd to your home directory and type:
</p><pre class="verbatim">          unison a.tmp ssh://remotehostname/a.tmp
</pre><p>
The result should be that the entire directory <span style="font-family:monospace">a.tmp</span> is propagated
from the client to your home directory on the server.</p><p>After finishing the first synchronization, change a few files and try
synchronizing again. You should see similar results as in the local
case.</p><p>If your user name on the server is not the same as on the client, you
need to specify it on the command line:
</p><pre class="verbatim">          unison a.tmp ssh://username@remotehostname/a.tmp
</pre><p><span style="font-style:italic">Notes:</span>
</p><ul class="itemize"><li class="li-itemize">
If you want to put <code class="verb">a.tmp</code> some place other than your home
directory on the remote host, you can give an absolute path for it by
adding an extra slash between <code class="verb">remotehostname</code> and the beginning
of the path:
<pre class="verbatim">          unison a.tmp ssh://remotehostname//absolute/path/to/a.tmp
</pre></li><li class="li-itemize">You can give an explicit path for the <code class="verb">unison</code> executable
on the server by using the command-line option <span style="font-size:large"><span style="font-family:monospace">-servercmd
/full/path/name/of/unison</span></span> or adding
<span style="font-size:large"><span style="font-family:monospace">servercmd=/full/path/name/of/unison</span></span> to your profile (see
the <a href="#profile">Profiles</a> section). Similarly, you can specify a
explicit path for the <code class="verb">ssh</code> program using the <span style="font-size:large"><span style="font-family:monospace">-sshcmd</span></span>
option.
Extra arguments can be passed to <code class="verb">ssh</code> by setting the
<code class="verb">-sshargs</code> preference.
</li></ul><!--TOC subsection id="sec28" Socket Method-->
<h3 id="sec28" class="subsection">Socket Method</h3><!--SEC END --><blockquote class="quote">
<span style="font-weight:bold"><span style="color:red">Warning:</span></span> The socket method is
insecure: not only are the texts of your changes transmitted over
the network in unprotected form, it is also possible for anyone in
the world to connect to the server process and read out the contents
of your filesystem! (Of course, to do this they must understand the
protocol that Unison uses to communicate between client and server,
but all they need for this is a copy of the Unison sources.) The socket
method is provided only for expert users with specific needs; everyone
else should use the <code class="verb">ssh</code> method.
</blockquote><p>To run Unison over a socket connection, you must start a Unison
daemon process on the server. This process runs continuously,
waiting for connections over a given socket from client machines
running Unison and processing their requests in turn.</p><p>Note that socket mode cannot be started from a profile. It should be started as a command-line argument only.</p><p>To start the daemon, type
</p><pre class="verbatim">       unison -socket NNNN
</pre><p>
on the server machine, where <span style="font-family:monospace">NNNN</span> is the socket number that the
daemon should listen on for connections from clients. (<span style="font-family:monospace">NNNN</span> can
be any large number that is not being used by some other program; if
<span style="font-family:monospace">NNNN</span> is already in use, Unison will exit with an error
message.) Note that paths specified by the client will be interpreted
relative to the directory in which you start the server process; this
behavior is different from the ssh case, where the path is relative to
your home directory on the server.</p><p>Create a test directory <span style="font-family:monospace">a.tmp</span> in your home directory on the
client machine. Now type:
</p><pre>
       unison a.tmp socket://<span style="font-style:italic">remotehostname</span>:NNNN/a.tmp
</pre><p>
The result should be that the entire directory <span style="font-family:monospace">a.tmp</span> is
propagated from the client to the server (<span style="font-family:monospace">a.tmp</span> will be
created on the server in the directory that the server was started
from).
After finishing the first synchronization, change a few files and try
synchronizing again. You should see similar results as in the local
case.</p><p>Since the socket method is not used by many people, its functionality is
rather limited. For example, the server can only deal with one client at a
time.</p><!--TOC subsection id="sec29" Using Unison for All Your Files-->
<h3 id="sec29" class="subsection">Using Unison for All Your Files</h3><!--SEC END --><p>Once you are comfortable with the basic operation of Unison, you may
find yourself wanting to use it regularly to synchronize your commonly
used files. There are several possible ways of going about this:</p><ol class="enumerate" type=1><li class="li-enumerate">
Synchronize your whole home directory, using the Ignore facility
(see the <a href="#ignore">Ignoring Paths</a> section)
to avoid synchronizing temporary files and things that only belong on
one host.
</li><li class="li-enumerate">Create a subdirectory called <span style="font-family:monospace">shared</span> (or <span style="font-family:monospace">current</span>, or
whatever) in your home directory on each host, and put all the files
you want to synchronize into this directory.
</li><li class="li-enumerate">Create a subdirectory called <span style="font-family:monospace">shared</span> (or <span style="font-family:monospace">current</span>, or
whatever) in your home directory on each host, and put <em>links to</em>
all the files you want to synchronize into this directory. Use the
<span style="font-family:monospace">follow</span> preference (see the <a href="#symlinks">Symbolic Links</a> section) to make
Unison treat these links as transparent.
</li><li class="li-enumerate">Make your home directory the root of the synchronization, but
tell Unison to synchronize only some of the files and subdirectories
within it on any given run. This can be accomplished by using the <span style="font-family:monospace">-path</span> switch
on the command line:
<pre>
       unison /home/<span style="font-style:italic">username</span> ssh://<span style="font-style:italic">remotehost</span>//home/<span style="font-style:italic">username</span> -path shared
</pre>
The <span style="font-family:monospace">-path</span> option can be used as many times as needed, to
synchronize several files or subdirectories:
<pre>
       unison /home/<span style="font-style:italic">username</span> ssh://<span style="font-style:italic">remotehost</span>//home/<span style="font-style:italic">username</span> <code class="verb">\</code>
          -path shared <code class="verb">\</code>
          -path pub <code class="verb">\</code>
          -path .netscape/bookmarks.html
</pre>
These <code class="verb">-path</code> arguments can also be put in your preference file.
See the <a href="#prefs">Preferences</a> section for an example.
</li></ol><p>Most people find that they only need to maintain a profile (or
profiles) on one of the hosts that they synchronize, since Unison is
always initiated from this host. (For example, if you&#X2019;re
synchronizing a laptop with a fileserver, you&#X2019;ll probably always run
Unison on the laptop.) This is a bit different from the usual
situation with asymmetric mirroring programs like <code class="verb">rdist</code>, where
the mirroring operation typically needs to be initiated from the
machine with the most recent changes. the <a href="#profile">Profiles</a> section
covers the syntax of Unison profiles, together with some sample profiles.</p><p>Some tips on improving Unison&#X2019;s performance can be found on the
<a href="http://www.cis.upenn.edu/~bcpierce/unison/faq.html">Frequently
Asked Questions page</a>.</p><!--TOC subsection id="sec30" Using Unison to Synchronize More Than Two Machines-->
<h3 id="sec30" class="subsection">Using Unison to Synchronize More Than Two Machines</h3><!--SEC END --><p>Unison is designed for synchronizing pairs of replicas. However, it is
possible to use it to keep larger groups of machines in sync by performing
multiple pairwise synchronizations.</p><p>If you need to do this, the most reliable way to set things up is to
organize the machines into a &#X201C;star topology,&#X201D; with one machine designated
as the &#X201C;hub&#X201D; and the rest as &#X201C;spokes,&#X201D; and with each spoke machine
synchronizing only with the hub. The big advantage of the star topology is
that it eliminates the possibility of confusing &#X201C;spurious conflicts&#X201D;
arising from the fact that a separate archive is maintained by Unison for
every pair of hosts that it synchronizes.</p><!--TOC subsection id="sec31" Going Further-->
<h3 id="sec31" class="subsection">Going Further</h3><!--SEC END --><p>On-line documentation for the various features of Unison
can be obtained either by typing
</p><pre class="verbatim">        unison -doc topics
</pre><p>
at the command line, or by selecting the Help menu in the graphical
user interface.
The on-line information and the printed manual are essentially identical.
</p><p>If you use Unison regularly, you should subscribe to one of the mailing
lists, to receive announcements of new versions. See
the <a href="#lists">Mailing Lists and Bug Reporting</a> section.</p><p><hr></p><!--TOC section id="sec32" Basic Concepts-->
<h2 id="sec32" class="section">Basic Concepts</h2><!--SEC END --><p>To understand how Unison works, it is necessary to discuss a few
straightforward concepts.
These concepts are developed more rigorously and at more length in a number
of papers, available at <a href="http://www.cis.upenn.edu/~bcpierce/papers"><span style="font-family:monospace">http://www.cis.upenn.edu/~bcpierce/papers</span></a>.
But the informal presentation here should be enough for most users.</p><!--TOC subsection id="sec33" Roots-->
<h3 id="sec33" class="subsection">Roots</h3><!--SEC END --><p>A replica&#X2019;s <em>root</em> tells Unison where to find a set of files to be
synchronized, either on the local machine or on a remote host.
For example,
</p><pre>
      <span style="font-style:italic">relative/path/of/root</span>
</pre><p>
specifies a local root relative to the directory where Unison is
started, while
</p><pre>
      /<span style="font-style:italic">absolute/path/of/root</span>
</pre><p>
specifies a root relative to the top of the local filesystem,
independent of where Unison is running. Remote roots can begin with
<code class="verb">ssh://</code>,
<code class="verb">rsh://</code>
to indicate that the remote server should be started with rsh or ssh:
</p><pre>
      ssh://<span style="font-style:italic">remotehost</span>//<span style="font-style:italic">absolute/path/of/root</span>
      rsh://<span style="font-style:italic">user</span>@<span style="font-style:italic">remotehost</span>/<span style="font-style:italic">relative/path/of/root</span>
</pre><p>
If the remote server is already running (in the socket mode), then the syntax
</p><pre>
      socket://<span style="font-style:italic">remotehost</span>:<span style="font-style:italic">portnum</span>//<span style="font-style:italic">absolute/path/of/root</span>
      socket://<span style="font-style:italic">remotehost</span>:<span style="font-style:italic">portnum</span>/<span style="font-style:italic">relative/path/of/root</span>
</pre><p>
is used to specify the hostname and the port that the client Unison should
use to contact it.</p><p>The syntax for roots is based on that of URIs (described in RFC 2396).
The full grammar is:
</p><pre>
  <span style="font-style:italic">replica</span> ::= [<span style="font-style:italic">protocol</span>:]//[<span style="font-style:italic">user</span>@][<span style="font-style:italic">host</span>][:<span style="font-style:italic">port</span>][/<span style="font-style:italic">path</span>]
           |  <span style="font-style:italic">path</span>

  <span style="font-style:italic">protocol</span> ::= file
            |  socket
            |  ssh
            |  rsh

  <span style="font-style:italic">user</span> ::= [-_a-zA-Z0-9]+

  <span style="font-style:italic">host</span> ::= [-_a-zA-Z0-9.]+

  <span style="font-style:italic">port</span> ::= [0-9]+
</pre><p>
When <code class="verb">path</code> is given without any protocol prefix, the protocol is
assumed to be <code class="verb">file:</code>. Under Windows, it is possible to
synchronize with a remote directory using the <code class="verb">file:</code> protocol over
the Windows Network Neighborhood. For example,
</p><pre class="verbatim">       unison foo //host/drive/bar
</pre><p>
synchronizes the local directory <code class="verb">foo</code> with the directory
<code class="verb">drive:\bar</code> on the machine <code class="verb">host</code>, provided that <code class="verb">host</code>
is accessible via Network Neighborhood. When the <code class="verb">file:</code> protocol
is used in this way, there is no need for a Unison server to be running
on the remote host. However, running Unison this way is only a good
idea if the remote host is reached by a very fast network connection,
since the full contents of every file in the remote replica will have to
be transferred to the local machine to detect updates.</p><p>The names of roots are <em>canonized</em> by Unison before it uses them
to compute the names of the corresponding archive files, so <span style="font-family:monospace">//saul//home/bcpierce/common</span> and <span style="font-family:monospace">//saul.cis.upenn.edu/common</span>
will be recognized as the same replica under different names.</p><!--TOC subsection id="sec34" Paths-->
<h3 id="sec34" class="subsection">Paths</h3><!--SEC END --><p>A <em>path</em> refers to a point <em>within</em> a set of files being
synchronized; it is specified relative to the root of the replica.</p><p>Formally, a path is just a sequence of names, separated by <code class="verb">/</code>.
Note that the path separator character is always a forward slash, no
matter what operating system Unison is running on. Forward slashes
are converted to backslashes as necessary when paths are converted to
filenames in the local filesystem on a particular host.
(For example, suppose that we run Unison on a Windows system, synchronizing
the local root <code class="verb">c:\pierce</code> with the root
<code class="verb">ssh://saul.cis.upenn.edu/home/bcpierce</code> on a Unix server. Then
the path <code class="verb">current/todo.txt</code> refers to the file
<code class="verb">c:\pierce\current\todo.txt</code> on the client and
<code class="verb">/home/bcpierce/current/todo.txt</code> on the server.)</p><p>The empty path (i.e., the empty sequence of names) denotes the whole
replica. Unison displays the empty path as &#X201C;<code class="verb">[root]</code>.&#X201D;</p><p>If <code class="verb">p</code> is a path and <code class="verb">q</code> is a path beginning with <code class="verb">p</code>, then
<code class="verb">q</code> is said to be a <em>descendant</em> of <code class="verb">p</code>. (Each path is also a
descendant of itself.)</p><!--TOC subsection id="sec35" What is an Update?-->
<h3 id="sec35" class="subsection">What is an Update?</h3><!--SEC END --><p>The <em>contents</em> of a path <code class="verb">p</code> in a particular replica could be a
file, a directory, a symbolic link, or absent (if <code class="verb">p</code> does not
refer to anything at all in that replica). More specifically:
</p><ul class="itemize"><li class="li-itemize">
If <code class="verb">p</code> refers to an ordinary file, then the
contents of <code class="verb">p</code> are the actual contents of this file (a string of bytes)
plus the current permission bits of the file.
</li><li class="li-itemize">If <code class="verb">p</code> refers to a symbolic link, then the contents of <code class="verb">p</code>
are just the string specifying where the link points.
</li><li class="li-itemize">If <code class="verb">p</code> refers to a directory, then the
contents of <code class="verb">p</code> are just the token &#X201C;DIRECTORY&#X201D; plus the current
permission bits of the directory.
</li><li class="li-itemize">If <code class="verb">p</code> does not refer to anything in this replica, then the
contents of <code class="verb">p</code> are the token &#X201C;ABSENT.&#X201D;
</li></ul><p>
Unison keeps a record of the contents of each path after each
successful synchronization of that path (i.e., it remembers the
contents at the last moment when they were the same in the two
replicas).</p><p>We say that a path is <em>updated</em> (in some replica) if its current
contents are different from its contents the last time it was successfully
synchronized. Note that whether a path is updated has nothing to do with
its last modification time&#X2014;Unison considers only the contents when
determining whether an update has occurred. This means that touching a file
without changing its contents will <em>not</em> be recognized as an update. A
file can even be changed several times and then changed back to its original
contents; as long as Unison is only run at the end of this process, no
update will be recognized.</p><p>What Unison actually calculates is a close approximation to this
definition; see the <a href="#caveats">Caveats and Shortcomings</a> section.</p><!--TOC subsection id="sec36" What is a Conflict?-->
<h3 id="sec36" class="subsection">What is a Conflict?</h3><!--SEC END --><p>A path is said to be <em>conflicting</em> if the following conditions all hold:
</p><ol class="enumerate" type=1><li class="li-enumerate">
it has been updated in one replica,
</li><li class="li-enumerate">it or any of its descendants has been updated in the other
replica,
and
</li><li class="li-enumerate">its contents in the two replicas are not identical.
</li></ol><!--TOC subsection id="sec37" Reconciliation-->
<h3 id="sec37" class="subsection">Reconciliation</h3><!--SEC END --><p>Unison operates in several distinct stages:
</p><ol class="enumerate" type=1><li class="li-enumerate">
On each host, it compares its archive file (which records
the state of each path in the replica when it was last synchronized)
with the current contents of the replica, to determine which paths
have been updated.
</li><li class="li-enumerate">It checks for &#X201C;false conflicts&#X201D; &#X2014; paths that have been
updated on both replicas, but whose current values are identical.
These paths are silently marked as synchronized in the archive files
in both replicas.
</li><li class="li-enumerate">It displays all the updated paths to the user. For updates that
do not conflict, it suggests a default action (propagating the new
contents from the updated replica to the other). Conflicting updates
are just displayed. The user is given an opportunity to examine the
current state of affairs, change the default actions for
nonconflicting updates, and choose actions for conflicting updates.
</li><li class="li-enumerate">It performs the selected actions, one at a time. Each action is
performed by first transferring the new contents to a temporary file
on the receiving host, then atomically moving them into place.
</li><li class="li-enumerate">It updates its archive files to reflect the new state of the
replicas.
</li></ol><!--TOC subsection id="sec38" Invariants-->
<h3 id="sec38" class="subsection">Invariants</h3><!--SEC END --><p>Given the importance and delicacy of the job that it performs, it is
important to understand both what a synchronizer does under normal
conditions and what can happen under unusual conditions such as system
crashes and communication failures.</p><p>Unison is careful to protect both its internal state and the state of
the replicas at every point in this process. Specifically, the
following guarantees are enforced:
</p><ul class="itemize"><li class="li-itemize">
At every moment, each path in each replica has either (1) its <em>original</em> contents (i.e., no change at all has been made to this
path), or (2) its <em>correct</em> final contents (i.e., the value that the
user expected to be propagated from the other replica).
</li><li class="li-itemize">At every moment, the information stored on disk about Unison&#X2019;s
private state can be either (1) unchanged, or (2) updated to reflect
those paths that have been successfully synchronized.
</li></ul><p>
The upshot is that it is safe to interrupt Unison at any time, either
manually or accidentally. [Caveat: the above is <em>almost</em> true there
are occasionally brief periods where it is not (and, because of
shortcoming of the Posix filesystem API, cannot be); in particular, when
it is copying a file onto a directory or vice versa, it must first move
the original contents out of the way. If Unison gets
interrupted during one of these periods, some manual cleanup may be
required. In this case, a file called <span style="font-family:monospace">DANGER.README</span> will be left
in your home directory, containing information about the operation that
was interrupted. The next time you try to run Unison, it will notice this
file and warn you about it.]</p><p>If an interruption happens while it is propagating updates, then there
may be some paths for which an update has been propagated but which
have not been marked as synchronized in Unison&#X2019;s archives. This is no
problem: the next time Unison runs, it will detect changes to these
paths in both replicas, notice that the contents are now equal, and
mark the paths as successfully updated when it writes back its private
state at the end of this run.</p><p>If Unison is interrupted, it may sometimes leave temporary working files
(with suffix <code class="verb">.tmp</code>) in the replicas. It is safe to delete these
files. Also, if the <code class="verb">backups</code> flag is set, Unison will
leave around old versions of files that it overwrites, with names like
<code class="verb">file.0.unison.bak</code>. These can be deleted safely when they are no
longer wanted.</p><p>Unison is not bothered by clock skew between the different hosts on
which it is running. It only performs comparisons between timestamps
obtained from the same host, and the only assumption it makes about
them is that the clock on each system always runs forward.</p><p>If Unison finds that its archive files have been deleted (or that the
archive format has changed and they cannot be read, or that they don&#X2019;t
exist because this is the first run of Unison on these particular
roots), it takes a conservative approach: it behaves as though the
replicas had both been completely empty at the point of the last
synchronization. The effect of this is that, on the first run, files
that exist in only one replica will be propagated to the other, while
files that exist in both replicas but are unequal will be marked as
conflicting.</p><p>Touching a file without changing its contents should never affect whether or
not Unison does an update. (When running with the fastcheck preference set
to true&#X2014;the default on Unix systems&#X2014;Unison uses file modtimes for a
quick first pass to tell which files have definitely not changed; then, for
each file that might have changed, it computes a fingerprint of the file&#X2019;s
contents and compares it against the last-synchronized contents. Also, the
<code class="verb">-times</code> option allows you to synchronize file times, but it does not
cause identical files to be changed; Unison will only modify the file
times.)</p><p>It is safe to &#X201C;brainwash&#X201D; Unison by deleting its archive files
<em>on both replicas</em>. The next time it runs, it will assume that
all the files it sees in the replicas are new.</p><p>It is safe to modify files while Unison is working. If Unison
discovers that it has propagated an out-of-date change, or that the
file it is updating has changed on the target replica, it will signal
a failure for that file. Run Unison again to propagate the latest
change.
</p><p>Changes to the ignore patterns from the user interface (e.g., using
the &#X2018;i&#X2019; key) are immediately reflected in the current profile.</p><!--TOC subsection id="sec39" Caveats and Shortcomings-->
<h3 id="sec39" class="subsection">Caveats and Shortcomings</h3><!--SEC END --><p>Here are some things to be careful of when using Unison.</p><ul class="itemize"><li class="li-itemize">
In the interests of speed, the update detection algorithm may
(depending on which OS architecture that you run Unison on)
actually use an approximation to the definition given in
the <a href="#updates">What is an Update?</a> section.<p>In particular, the Unix
implementation does not compare the actual contents of files to their
previous contents, but simply looks at each file&#X2019;s inode number and
modtime; if neither of these have changed, then it concludes that the
file has not been changed.</p><p>Under normal circumstances, this approximation is safe, in the sense
that it may sometimes detect &#X201C;false updates&#X201D; but will never miss a real
one. However, it is possible to fool it, for example by using
<code class="verb">retouch</code> to change a file&#X2019;s modtime back to a time in the past.
</p></li><li class="li-itemize">If you synchronize between a single-user filesystem and a shared
Unix server, you should pay attention to your permission bits: by
default, Unison will synchronize permissions verbatim, which may leave
group-writable files on the server that could be written over by a lot of
people.<p>You can control this by setting your <code class="verb">umask</code> on both computers to
something like 022, masking out the &#X201C;world write&#X201D; and &#X201C;group write&#X201D;
permission bits.</p><p>Unison does not synchronize the <code class="verb">setuid</code> and <code class="verb">setgid</code> bits, for
security.</p></li><li class="li-itemize">The graphical user interface is single-threaded. This
means that if Unison is performing some long-running operation, the
display will not be repainted until it finishes. We recommend not
trying to do anything with the user interface while Unison is in the
middle of detecting changes or propagating files.</li><li class="li-itemize">Unison does not understand hard links.</li><li class="li-itemize">It is important to be a little careful when renaming directories
containing <span style="font-family:monospace">ignore</span>d files.<p>For example, suppose Unison is synchronizing directory A between the two
machines called the &#X201C;local&#X201D; and the &#X201C;remote&#X201D; machine; suppose directory
A contains a subdirectory D; and suppose D on the local machine contains a
file or subdirectory P that matches an ignore directive in the profile used
to synchronize. Thus path A/D/P exists on the local machine but not on the
remote machine.</p><p>If D is renamed to D&#X2019; on the remote machine, and this change is
propagated to the local machine, all such files or subdirectories P
will be deleted. This is because Unison sees the rename as a delete and a
separate create: it deletes the old directory (including the ignored files)
and creates a new one (<em>not</em> including the ignored files, since they
are completely invisible to it).
</p></li></ul><p><hr></p><!--TOC section id="sec40" Reference Guide-->
<h2 id="sec40" class="section">Reference Guide</h2><!--SEC END --><p>This section covers the features of Unison in detail.</p><!--TOC subsection id="sec41" Running Unison-->
<h3 id="sec41" class="subsection">Running Unison</h3><!--SEC END --><p>There are several ways to start Unison.
</p><ul class="itemize"><li class="li-itemize">
Typing &#X201C;<span style="font-family:monospace">unison </span><span style="font-family:monospace"><span style="font-style:italic">profile</span></span>&#X201D; on the command line. Unison
will look for a file <span style="font-family:monospace"><span style="font-style:italic">profile</span></span><span style="font-family:monospace">.prf</span> in the <code class="verb">.unison</code>
directory. If this file does not specify a pair of roots, Unison will
prompt for them and add them to the information specified by the profile.
</li><li class="li-itemize">Typing &#X201C;<span style="font-family:monospace">unison </span><span style="font-family:monospace"><span style="font-style:italic">profile</span></span><span style="font-family:monospace"> </span><span style="font-family:monospace"><span style="font-style:italic">root1</span></span><span style="font-family:monospace"> </span><span style="font-family:monospace"><span style="font-style:italic">root2</span></span>&#X201D; on the command
line.
In this case, Unison will use <span style="font-family:monospace"><span style="font-style:italic">profile</span></span>, which should not contain
any <span style="font-family:monospace">root</span> directives.
</li><li class="li-itemize">Typing &#X201C;<span style="font-family:monospace">unison </span><span style="font-family:monospace"><span style="font-style:italic">root1</span></span><span style="font-family:monospace"> </span><span style="font-family:monospace"><span style="font-style:italic">root2</span></span>&#X201D; on the command line. This
has the same effect as typing &#X201C;<span style="font-family:monospace">unison default </span><span style="font-family:monospace"><span style="font-style:italic">root1</span></span><span style="font-family:monospace"> </span><span style="font-family:monospace"><span style="font-style:italic">root2</span></span>.&#X201D;
</li><li class="li-itemize">Typing just &#X201C;<span style="font-family:monospace">unison</span>&#X201D; (or invoking Unison by clicking on
a desktop icon). In this case, Unison will ask for the profile to use
for synchronization (or create a new one, if necessary).
</li></ul><!--TOC subsection id="sec42" The <span style="font-family:monospace">.unison</span> Directory-->
<h3 id="sec42" class="subsection">The <span style="font-family:monospace">.unison</span> Directory</h3><!--SEC END --><p>Unison stores a variety of information in a private directory on each
host. If the environment variable <span style="font-family:monospace">UNISON</span> is defined, then its
value will be used as the path/folder name for this directory.
This can be just a name, or a path.</p><p>A name on it&#X2019;s own, for example <span style="font-family:monospace">UNISON=mytestname</span> will
place a folder in the same directory that the Unison binary was run
in, with that name. Using a path like <span style="font-family:monospace">UNISON=../mytestname2</span>
will place that folder in the folder above where the Unison binary was
run from.</p><p>If <span style="font-family:monospace">UNISON</span> is not defined, then the directory depends on which
operating system you are using. In Unix, the default is to use
<span style="font-family:monospace">$HOME/.unison</span>.
In Windows, if the environment variable
<span style="font-family:monospace">USERPROFILE</span> is defined, then the directory will be
<span style="font-family:monospace">$USERPROFILE</span>\<span style="font-family:monospace">.unison</span>;
otherwise if <span style="font-family:monospace">HOME</span> is defined, it will be
<span style="font-family:monospace">$HOME</span>\<span style="font-family:monospace">.unison</span>;
otherwise, it will be
<span style="font-family:monospace">c:</span>\<span style="font-family:monospace">.unison</span>.
On OS X,
<span style="font-family:monospace">$HOME/.unison</span> will be used if it is present, but
<span style="font-family:monospace">$HOME/Library/Application Support/Unison</span> will be created and used by
default.</p><p>The archive file for each replica is found in the <span style="font-family:monospace">.unison</span>
directory on that replica&#X2019;s host. Profiles (described below) are
always taken from the <span style="font-family:monospace">.unison</span> directory on the client host.</p><p>Note that Unison maintains a completely different set of archive files
for each pair of roots.</p><p>We do not recommend synchronizing the whole <span style="font-family:monospace">.unison</span> directory, as this
will involve frequent propagation of large archive files. It should be safe
to do it, though, if you really want to. Synchronizing just the profile
files in the <span style="font-family:monospace">.unison</span> directory is definitely OK.</p><!--TOC subsection id="sec43" Archive Files-->
<h3 id="sec43" class="subsection">Archive Files</h3><!--SEC END --><p>The name of the archive file on each replica is calculated from
</p><ul class="itemize"><li class="li-itemize">
the <em>canonical names</em> of all the hosts (short names like
<code class="verb">saul</code> are converted into full addresses like <code class="verb">saul.cis.upenn.edu</code>),
</li><li class="li-itemize">the paths to the replicas on all the hosts (again, relative
pathnames, symbolic links, etc. are converted into full, absolute paths), and
</li><li class="li-itemize">an internal version number that is changed whenever a new Unison
release changes the format of the information stored in the archive.
</li></ul><p>
This method should work well for most users. However, it is occasionally
useful to change the way archive names are generated. Unison provides
two ways of doing this.</p><p>The function that finds the canonical hostname of the local host (which
is used, for example, in calculating the name of the archive file used to
remember which files have been synchronized) normally uses the
<code class="verb">gethostname</code> operating system call. However, if the environment
variable <code class="verb">UNISONLOCALHOSTNAME</code> is set, its value will be used
instead. This makes it easier to use Unison in situations where a
machine&#X2019;s name changes frequently (e.g., because it is a laptop and gets
moved around a lot).</p><p>A more powerful way of changing archive names is provided by the
<code class="verb">rootalias</code> preference. The preference file may contain any number of
lines of the form:
</p><pre>
    rootalias = //<span style="font-style:italic">hostnameA</span>//<span style="font-style:italic">path-to-replicaA</span> -&gt; //<span style="font-style:italic">hostnameB</span>/<span style="font-style:italic">path-to-replicaB</span>
</pre><p>
When calculating the name of the archive files for a given pair of roots,
Unison replaces any root that matches the left-hand side of any rootalias
rule by the corresponding right-hand side.</p><p>So, if you need to relocate a root on one of the hosts, you can add a
rule of the form:
</p><pre>
    rootalias = //<span style="font-style:italic">new-hostname</span>//<span style="font-style:italic">new-path</span> -&gt; //<span style="font-style:italic">old-hostname</span>/<span style="font-style:italic">old-path</span>
</pre><p>
Note that root aliases are case-sensitive, even on case-insensitive file
systems.</p><p><em>Warning</em>: The <code class="verb">rootalias</code> option is dangerous and should only
be used if you are sure you know what you&#X2019;re doing. In particular, it
should only be used if you are positive that either (1) both the original
root and the new alias refer to the same set of files, or (2) the files
have been relocated so that the original name is now invalid and will
never be used again. (If the original root and the alias refer to
different sets of files, Unison&#X2019;s update detector could get confused.)
After introducing a new <code class="verb">rootalias</code>, it is a good idea to run Unison
a few times interactively (with the <code class="verb">batch</code> flag off, etc.) and
carefully check that things look reasonable&#X2014;in particular, that update
detection is working as expected.</p><!--TOC subsection id="sec44" Preferences-->
<h3 id="sec44" class="subsection">Preferences</h3><!--SEC END --><p>Many details of Unison&#X2019;s behavior are configurable by user-settable
&#X201C;preferences.&#X201D;</p><p>Some preferences are boolean-valued; these are often called <em>flags</em>.
Others take numeric or string arguments, indicated in the preferences
list by <span style="font-family:monospace">n</span> or <span style="font-family:monospace">xxx</span>. Some string arguments take the backslash as
an escape to include the next character literally; this is mostly useful
to escape a space or the backslash; a trailing backslash is ignored and is
useful to protect a trailing whitespace in the string that would otherwise
be trimmed. Most of the string preferences can be given several times;
the arguments are accumulated into a list internally.</p><p>There are two ways to set the values of preferences: temporarily, by
providing command-line arguments to a particular run of Unison, or
permanently, by adding commands to a <em>profile</em> in the <span style="font-family:monospace">.unison</span>
directory on the client host. The order of preferences (either on the
command line or in preference files) is not significant. On the command
line, preferences and other arguments (the profile name and roots) can be
intermixed in any order.</p><p>To set the value of a preference <span style="font-family:monospace">p</span> from the command line, add an
argument <span style="font-family:monospace">-p</span> (for a boolean flag) or <span style="font-family:monospace">-p n</span> or <span style="font-family:monospace">-p xxx</span> (for
a numeric or string preference) anywhere on the command line. To set a
boolean flag to <code class="verb">false</code> on the command line, use <span style="font-family:monospace">-p=false</span>.</p><p>Here are all the preferences supported by Unison. This list can be
obtained by typing <span style="font-family:monospace">unison -help</span>.
</p><blockquote class="quote">
<pre class="verbatim">Usage: unison [options]
    or unison root1 root2 [options]
    or unison profilename [options]

Basic options: 
 -auto              automatically accept default (nonconflicting) actions
 -batch             batch mode: ask no questions at all
 -doc xxx           show documentation ('-doc topics' lists topics)
 -fat               use appropriate options for FAT filesystems
 -group             synchronize group attributes
 -i                 interactive profile mode (text UI); command-line only
 -ignore xxx        add a pattern to the ignore list
 -ignorenot xxx     add a pattern to the ignorenot list
 -nocreation xxx    prevent file creations on one replica
 -nodeletion xxx    prevent file deletions on one replica
 -noupdate xxx      prevent file updates and deletions on one replica
 -owner             synchronize owner
 -path xxx          path to synchronize
 -perms n           part of the permissions which is synchronized
 -root xxx          root of a replica (should be used exactly twice)
 -silent            print nothing except error messages
 -terse             suppress status messages
 -testserver        exit immediately after the connection to the server
 -times             synchronize modification times
 -version           print version and exit

Advanced options: 
 -addprefsto xxx    file to add new prefs to
 -addversionno      add version number to name of unison on server
 -atomic xxx        add a pattern to the atomic list
 -backup xxx        add a pattern to the backup list
 -backupcurr xxx    add a pattern to the backupcurr list
 -backupcurrnot xxx add a pattern to the backupcurrnot list
 -backupdir xxx     directory for storing centralized backups
 -backuploc xxx     where backups are stored ('local' or 'central')
 -backupnot xxx     add a pattern to the backupnot list
 -backupprefix xxx  prefix for the names of backup files
 -backups           keep backup copies of all files (see also 'backup')
 -backupsuffix xxx  a suffix to be added to names of backup files
 -clientHostName xxx set host name of client
 -color xxx         use color output for text UI (true/false/default)
 -confirmbigdel     ask about whole-replica (or path) deletes (default true)
 -confirmmerge      ask for confirmation before committing results of a merge
 -contactquietly    suppress the 'contacting server' message during startup
 -copymax n         maximum number of simultaneous copyprog transfers
 -copyonconflict    keep copies of conflicting files
 -copyprog xxx      external program for copying large files
 -copyprogrest xxx  variant of copyprog for resuming partial transfers
 -copyquoterem xxx  add quotes to remote file name for copyprog (true/false/default)
 -copythreshold n   use copyprog on files bigger than this (if &gt;=0, in Kb)
 -debug xxx         debug module xxx ('all' -&gt; everything, 'verbose' -&gt; more)
 -diff xxx          set command for showing differences between files
 -dontchmod         when set, never use the chmod system call
 -dumbtty           do not change terminal settings in text UI
 -fastcheck xxx     do fast update detection (true/false/default)
 -fastercheckUNSAFE skip computing fingerprints for new files (experts only!)
 -follow xxx        add a pattern to the follow list
 -force xxx         force changes from this replica to the other
 -forcepartial xxx  add a pattern to the forcepartial list
 -halfduplex        force half-duplex communication with the server
 -height n          height (in lines) of main window in graphical interface
 -host xxx          bind the socket to this host name in server socket mode
 -ignorearchives    ignore existing archive files
 -ignorecase xxx    identify upper/lowercase filenames (true/false/default)
 -ignoreinodenumbers ignore inode number changes when detecting updates
 -ignorelocks       ignore locks left over from previous run (dangerous!)
 -immutable xxx     add a pattern to the immutable list
 -immutablenot xxx  add a pattern to the immutablenot list
 -key xxx           define a keyboard shortcut for this profile (in some UIs)
 -killserver        kill server when done (even when using sockets)
 -label xxx         provide a descriptive string label for this profile
 -links xxx         allow the synchronization of symbolic links (true/false/default)
 -log               record actions in logfile (default true)
 -logfile xxx       logfile name
 -maxbackups n      number of backed up versions of a file
 -maxerrors n       maximum number of errors before a directory transfer is aborted
 -maxsizethreshold n prevent transfer of files bigger than this (if &gt;=0, in Kb)
 -maxthreads n      maximum number of simultaneous file transfers
 -merge xxx         add a pattern to the merge list
 -mountpoint xxx    abort if this path does not exist
 -nocreationpartial xxx add a pattern to the nocreationpartial list
 -nodeletionpartial xxx add a pattern to the nodeletionpartial list
 -noupdatepartial xxx add a pattern to the noupdatepartial list
 -numericids        don't map uid/gid values by user/group names
 -prefer xxx        choose this replica's version for conflicting changes
 -preferpartial xxx add a pattern to the preferpartial list
 -repeat xxx        synchronize repeatedly (text interface only)
 -retry n           re-try failed synchronizations N times (text ui only)
 -rootalias xxx     register alias for canonical root names
 -rsrc xxx          synchronize resource forks (true/false/default)
 -rsync             activate the rsync transfer mode (default true)
 -selftest          run internal tests and exit
 -servercmd xxx     name of unison executable on remote server
 -showarchive       show 'true names' (for rootalias) of roots and archive
 -socket xxx        act as a server on a socket
 -sortbysize        list changed files by size, not name
 -sortfirst xxx     add a pattern to the sortfirst list
 -sortlast xxx      add a pattern to the sortlast list
 -sortnewfirst      list new before changed files
 -sshargs xxx       other arguments (if any) for remote shell command
 -sshcmd xxx        path to the ssh executable
 -stream            use a streaming protocol for transferring file contents (default true)
 -ui xxx            select UI ('text' or 'graphic'); command-line only
 -unicode xxx       assume Unicode encoding in case insensitive mode
 -watch             when set, use a file watcher process to detect changes
 -xferbycopying     optimize transfers using local copies (default true)

Special command line options: 
 -include xxx       include a profile file's preferences
 -source xxx        include a file's preferences

</pre>
</blockquote><p>
Here, in more detail, is what they do. Many are discussed in greater detail
in other sections of the manual.</p><p>It should be noted that some command-line arguments are handled specially during startup, including <code class="verb">-doc</code>, <code class="verb">-help</code>, <code class="verb">-version</code>, <code class="verb">-server</code>, <code class="verb">-socket</code>, and <code class="verb">-ui</code>. They are expected to appear on the command-line only, not in a profile. In particular, <code class="verb">-version</code> and <code class="verb">-doc</code> will print to the standard output, so they only make sense if invoked from the command-line (and not a click-launched gui that has no standard output). Furthermore, the actions associated with these command-line arguments are executed without loading a profile or doing the usual command-line parsing. This is because we want to run the actions without loading a profile; and then we can&#X2019;t do command-line parsing because it is intertwined with profile loading.
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold">addprefsto <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
By default, new preferences added by Unison (e.g., new <code class="verb">ignore</code> clauses) will be appended to whatever preference file Unison was told to load at the beginning of the run. Setting the preference <span style="font-family:monospace">addprefsto </span><span style="font-family:monospace"><span style="font-style:italic">filename</span></span> makes Unison add new preferences to the file named <span style="font-family:monospace"><span style="font-style:italic">filename</span></span> instead.</dd><dt class="dt-description"><span style="font-weight:bold">addversionno </span></dt><dd class="dd-description">
When this flag is set to <span style="font-family:monospace">true</span>, Unison will use <span style="font-family:monospace">unison-</span><span style="font-family:monospace"><span style="font-style:italic">currentmajorversionnumber</span></span> instead of just <code class="verb">unison</code> as the remote server command (note that the minor version number is dropped &#X2013; e.g., unison-2.51). This allows multiple binaries for different versions of unison to coexist conveniently on the same server: whichever version is run on the client, the same version will be selected on the server.</dd><dt class="dt-description"><span style="font-weight:bold">atomic <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference specifies paths for directories whose contents will be considered as a group rather than individually when they are both modified. The backups are also made atomically in this case. The option <span style="font-family:monospace">backupcurr</span> however has no effect on atomic directories.</dd><dt class="dt-description"><span style="font-weight:bold">auto </span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag causes the user interface to skip asking for confirmations on non-conflicting changes. (More precisely, when the user interface is done setting the propagation direction for one entry and is about to move to the next, it will skip over all non-conflicting entries and go directly to the next conflict.)</dd><dt class="dt-description"><span style="font-weight:bold">backup <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-backup </span><span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> causes Unison to keep backup files for each path that matches <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span>; directories (nor their permissions or any other metadata) are not backed up. These backup files are kept in the directory specified by the <code class="verb">backuplocation</code> preference. The backups are named according to the <code class="verb">backupprefix</code> and <code class="verb">backupsuffix</code> preferences. The number of versions that are kept is determined by the <code class="verb">maxbackups</code> preference.<p>The syntax of <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> is described in the <a href="#pathspec">Path Specification</a> section.</p></dd><dt class="dt-description"><span style="font-weight:bold">backupcurr <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-backupcurr </span><span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> causes Unison to keep a backup of the <em>current</em> version of every file matching <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span>. This file will be saved as a backup with version number 000. Such backups can be used as inputs to external merging programs, for instance. See the documentatation for the <code class="verb">merge</code> preference. For more details, see the <a href="#merge">Merging Conflicting Versions</a> section.<p>The syntax of <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> is described in the <a href="#pathspec">Path Specification</a> section.</p></dd><dt class="dt-description"><span style="font-weight:bold">backupcurrnot <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Exceptions to <code class="verb">backupcurr</code>, like the <code class="verb">ignorenot</code> preference.</dd><dt class="dt-description"><span style="font-weight:bold">backupdir <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
If this preference is set, Unison will use it as the name of the directory used to store backup files specified by the <span style="font-family:monospace">backup</span> preference, when <span style="font-family:monospace">backuplocation</span> is set to <code class="verb">central</code>. It is checked <em>after</em> the <span style="font-family:monospace">UNISONBACKUPDIR</span> environment variable.</dd><dt class="dt-description"><span style="font-weight:bold">backuploc <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference determines whether backups should be kept locally, near the original files, or in a central directory specified by the <span style="font-family:monospace">backupdir</span> preference. If set to <code class="verb">local</code>, backups will be kept in the same directory as the original files, and if set to <code class="verb">central</code>, <span style="font-family:monospace">backupdir</span> will be used instead.</dd><dt class="dt-description"><span style="font-weight:bold">backupnot <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
The values of this preference specify paths or individual files or regular expressions that should <em>not</em> be backed up, even if the <span style="font-family:monospace">backup</span> preference selects them&#X2014;i.e., it selectively overrides <span style="font-family:monospace">backup</span>.</dd><dt class="dt-description"><span style="font-weight:bold">backupprefix <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When a backup for a file <code class="verb">NAME</code> is created, it is stored in a directory specified by <span style="font-family:monospace">backuplocation</span>, in a file called <span style="font-family:monospace">backupprefix</span><code class="verb">NAME</code><span style="font-family:monospace">backupsuffix</span>. <span style="font-family:monospace">backupprefix</span> can include a directory name (causing Unison to keep all backup files for a given directory in a subdirectory with this name), and both <span style="font-family:monospace">backupprefix</span> and <span style="font-family:monospace">backupsuffix</span> can contain the string<span style="font-family:monospace"><span style="font-style:italic">$VERSION</span></span>, which will be replaced by the <em>age</em> of the backup (1 for the most recent, 2 for the second most recent, and so on...). This keyword is ignored if it appears in a directory name in the prefix; if it does not appear anywhere in the prefix or the suffix, it will be automatically placed at the beginning of the suffix. <p>One thing to be careful of: If the <span style="font-family:monospace">backuploc</span> preference is set to <span style="font-family:monospace">local</span>, Unison will automatically ignore <em>all</em> files whose prefix and suffix match <span style="font-family:monospace">backupprefix</span> and <span style="font-family:monospace">backupsuffix</span>. So be careful to choose values for these preferences that are sufficiently different from the names of your real files.</p></dd><dt class="dt-description"><span style="font-weight:bold">backups </span></dt><dd class="dd-description">
Setting this flag to true is equivalent to setting <span style="font-family:monospace">backuplocation</span> to <span style="font-family:monospace">local</span> and <span style="font-family:monospace">backup</span> to <code class="verb">Name *</code>.</dd><dt class="dt-description"><span style="font-weight:bold">backupsuffix <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
See <span style="font-family:monospace">backupprefix</span> for full documentation.</dd><dt class="dt-description"><span style="font-weight:bold">batch </span></dt><dd class="dd-description">
When this is set to <span style="font-family:monospace">true</span>, the user interface will ask no questions at all. Non-conflicting changes will be propagated; conflicts will be skipped.</dd><dt class="dt-description"><span style="font-weight:bold">clientHostName <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When specified, the host name of the client will not be guessedand the provided host name will be used to find the archive.</dd><dt class="dt-description"><span style="font-weight:bold">color <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag enables color output in text mode user interface. When set to <span style="font-family:monospace">false</span>, all color output is disabled. Default is to enable color if the <span style="font-family:monospace">NO_COLOR</span> environment variable is not set.</dd><dt class="dt-description"><span style="font-weight:bold">confirmbigdel </span></dt><dd class="dd-description">
When this is set to <span style="font-family:monospace">true</span>, Unison will request an extra confirmation if it appears that the entire replica has been deleted, before propagating the change. If the <span style="font-family:monospace">batch</span> flag is also set, synchronization will be aborted. When the <span style="font-family:monospace">path</span> preference is used, the same confirmation will be requested for top-level paths. (At the moment, this flag only affects the text user interface.) See also the <span style="font-family:monospace">mountpoint</span> preference.</dd><dt class="dt-description"><span style="font-weight:bold">confirmmerge </span></dt><dd class="dd-description">
Setting this preference causes both the text and graphical interfaces to ask the user if the results of a merge command may be committed to the replica or not. Since the merge command works on temporary files, the user can then cancel all the effects of applying the merge if it turns out that the result is not satisfactory. In batch-mode, this preference has no effect. Default is false.</dd><dt class="dt-description"><span style="font-weight:bold">contactquietly </span></dt><dd class="dd-description">
If this flag is set, Unison will skip displaying the &#X2018;Contacting server&#X2019; message (which some users find annoying) during startup.</dd><dt class="dt-description"><span style="font-weight:bold">copymax <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
A number indicating how many instances of the external copying utility Unison is allowed to run simultaneously (default to 1).</dd><dt class="dt-description"><span style="font-weight:bold">copyonconflict </span></dt><dd class="dd-description">
When this flag is set, Unison will make a copy of files that would otherwise be overwritten or deleted in case of conflicting changes, and more generally whenever the default behavior is overridden. This makes it possible to automatically resolve conflicts in a fairly safe way when synchronizing continuously, in combination with the <code class="verb">-repeat watch</code> and <code class="verb">-prefer newer</code> preferences.</dd><dt class="dt-description"><span style="font-weight:bold">copyprog <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
A string giving the name of an external program that can be used to copy large files efficiently (plus command-line switches telling it to copy files in-place). The default setting invokes <span style="font-family:monospace">rsync</span> with appropriate options&#X2014;most users should not need to change it.</dd><dt class="dt-description"><span style="font-weight:bold">copyprogrest <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
A variant of <span style="font-family:monospace">copyprog</span> that names an external program that should be used to continue the transfer of a large file that has already been partially transferred. Typically, <span style="font-family:monospace">copyprogrest</span> will just be <span style="font-family:monospace">copyprog</span> with one extra option (e.g., <span style="font-family:monospace">--partial</span>, for rsync). The default setting invokes <span style="font-family:monospace">rsync</span> with appropriate options&#X2014;most users should not need to change it.</dd><dt class="dt-description"><span style="font-weight:bold">copyquoterem <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag causes Unison to add an extra layer of quotes to the remote path passed to the external copy program. This is needed by rsync, for example, which internally uses an ssh connection requiring an extra level of quoting for paths containing spaces. When this flag is set to <span style="font-family:monospace">default</span>, extra quotes are added if the value of <span style="font-family:monospace">copyprog</span> contains the string <span style="font-family:monospace">rsync</span>.</dd><dt class="dt-description"><span style="font-weight:bold">copythreshold <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
A number indicating above what filesize (in kilobytes) Unison should use the external copying utility specified by <span style="font-family:monospace">copyprog</span>. Specifying 0 will cause <em>all</em> copies to use the external program; a negative number will prevent any files from using it. The default is -1. See the <a href="#speeding">Making Unison Faster on Large Files</a> section for more information.</dd><dt class="dt-description"><span style="font-weight:bold">debug <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference is used to make Unison print various sorts of information about what it is doing internally on the standard error stream. It can be used many times, each time with the name of a module for which debugging information should be printed. Possible arguments for <code class="verb">debug</code> can be found by looking for calls to <code class="verb">Util.debug</code> in the sources (using, e.g., <code class="verb">grep</code>). Setting <code class="verb">-debug all</code> causes information from <em>all</em> modules to be printed (this mode of usage is the first one to try, if you are trying to understand something that Unison seems to be doing wrong); <code class="verb">-debug verbose</code> turns on some additional debugging output from some modules (e.g., it will show exactly what bytes are being sent across the network).</dd><dt class="dt-description"><span style="font-weight:bold">diff <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference can be used to control the name and command-line arguments of the system utility used to generate displays of file differences. The default is &#X2018;<code class="verb">diff -u OLDER NEWER</code>&#X2019;. If the value of this preference contains the substrings CURRENT1 and CURRENT2, these will be replaced by the names of the files to be diffed. If the value of this preference contains the substrings NEWER and OLDER, these will be replaced by the names of files to be diffed, NEWER being the most recently modified file of the two. Without any of these substrings, the two filenames will be appended to the command. In all cases, the filenames are suitably quoted.</dd><dt class="dt-description"><span style="font-weight:bold">doc <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
The command-line argument <span style="font-family:monospace">-doc </span><span style="font-family:monospace"><span style="font-style:italic">secname</span></span> causes unison to display section <span style="font-family:monospace"><span style="font-style:italic">secname</span></span> of the manual on the standard output and then exit. Use <code class="verb">-doc all</code> to display the whole manual, which includes exactly the same information as the printed and HTML manuals, modulo formatting. Use <code class="verb">-doc topics</code> to obtain a list of the names of the various sections that can be printed.</dd><dt class="dt-description"><span style="font-weight:bold">dontchmod </span></dt><dd class="dd-description">
By default, Unison uses the &#X2019;chmod&#X2019; system call to set the permission bits of files after it has copied them. But in some circumstances (and under some operating systems), the chmod call always fails. Setting this preference completely prevents Unison from ever calling chmod.</dd><dt class="dt-description"><span style="font-weight:bold">dumbtty </span></dt><dd class="dd-description">
When set to <code class="verb">true</code>, this flag makes the text mode user interface avoid trying to change any of the terminal settings. (Normally, Unison puts the terminal in &#X2018;raw mode&#X2019;, so that it can do things like overwriting the current line.) This is useful, for example, when Unison runs in a shell inside of Emacs. <p>When <code class="verb">dumbtty</code> is set, commands to the user interface need to be followed by a carriage return before Unison will execute them. (When it is off, Unison recognizes keystrokes as soon as they are typed.)</p><p>This preference has no effect on the graphical user interface.</p></dd><dt class="dt-description"><span style="font-weight:bold">dumparchives </span></dt><dd class="dd-description">
When this preference is set, Unison will create a file unison.dump on each host, containing a text summary of the archive, immediately after loading it.</dd><dt class="dt-description"><span style="font-weight:bold">fastcheck <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When this preference is set to <code class="verb">true</code>, Unison will use the modification time and length of a file as a
&#X2018;pseudo inode number&#X2019; when scanning replicas for updates, instead of reading the full contents of every file. (This does not apply to the very first run, when Unison will always scan all files regardless of this switch). Under Windows, this may cause Unison to miss propagating an update if the modification time and length of the file are both unchanged by the update. However, Unison will never <em>overwrite</em> such an update with a change from the other replica, since it always does a safe check for updates just before propagating a change. Thus, it is reasonable to use this switch under Windows most of the time and occasionally run Unison once with <span style="font-family:monospace">fastcheck</span> set to <code class="verb">false</code>, if you are worried that Unison may have overlooked an update. For backward compatibility, <code class="verb">yes</code>, <code class="verb">no</code>, and <code class="verb">default</code> can be used in place of <code class="verb">true</code>, <code class="verb">false</code>, and <code class="verb">auto</code>. See the <a href="#fastcheck">Fast Update Detection</a> section for more information.</dd><dt class="dt-description"><span style="font-weight:bold">fastercheckUNSAFE </span></dt><dd class="dd-description">
THIS FEATURE IS STILL EXPERIMENTAL AND SHOULD BE USED WITH EXTREME CAUTION. <p>When this flag is set to <span style="font-family:monospace">true</span>, Unison will compute a &#X2019;pseudo-fingerprint&#X2019; the first time it sees a file (either because the file is new or because Unison is running for the first time). This enormously speeds update detection, but it must be used with care, as it can cause Unison to miss conflicts: If a given path in the filesystem contains files on <em>both</em> sides that Unison has not yet seen, and if those files have the same length but different contents, then Unison will not notice the presence of a conflict. If, later, one of the files is changed, the changed file will be propagated, overwriting the other. </p><p>Moreover, even when the files are initially identical, setting this flag can lead to potentially confusing behavior: if a newly created file is later touched without being modified, Unison will treat this conservatively as a potential change (since it has no record of the earlier contents) and show it as needing to be propagated to the other replica. </p><p>Most users should leave this flag off &#X2013; the small time savings of not fingerprinting new files is not worth the cost in terms of safety. However, it can be very useful for power users with huge replicas that are known to be already synchronized (e.g., because one replica is a newly created duplicate of the other, or because they have previously been synchronized with Unison but Unison&#X2019;s archives need to be rebuilt). In such situations, it is recommended that this flag be set only for the initial run of Unison, so that new archives can be created quickly, and then turned off for normal use.</p></dd><dt class="dt-description"><span style="font-weight:bold">fat </span></dt><dd class="dd-description">
When this is set to <span style="font-family:monospace">true</span>, Unison will use appropriate options to synchronize efficiently and without error a replica located on a FAT filesystem on a non-Windows machine: do not synchronize permissions (<span style="font-family:monospace">perms = 0</span>); never use chmod (	t dontchmod = true); treat filenames as case insensitive (<span style="font-family:monospace">ignorecase = true</span>); do not attempt to synchronize symbolic links (<span style="font-family:monospace">links = false</span>); ignore inode number changes when detecting updates (<span style="font-family:monospace">ignoreinodenumbers = true</span>). Any of these change can be overridden by explicitly setting the corresponding preference in the profile.</dd><dt class="dt-description"><span style="font-weight:bold">follow <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-follow </span><span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> causes Unison to treat symbolic links matching <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> as &#X2018;invisible&#X2019; and behave as if the object pointed to by the link had appeared literally at this position in the replica. See the <a href="#symlinks">Symbolic Links</a> section for more details. The syntax of <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> is described in the <a href="#pathspec">Path Specification</a> section.</dd><dt class="dt-description"><span style="font-weight:bold">force <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-force </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> causes Unison to resolve all differences (even non-conflicting changes) in favor of <span style="font-family:monospace"><span style="font-style:italic">root</span></span>. This effectively changes Unison from a synchronizer into a mirroring utility. <p>You can also specify <code class="verb">-force newer</code> (or <code class="verb">-force older</code>) to force Unison to choose the file with the later (earlier) modtime. In this case, the <code class="verb">-times</code> preference must also be enabled.</p><p>This preference is overridden by the <code class="verb">forcepartial</code> preference.</p><p>This preference should be used only if you are <em>sure</em> you know what you are doing!</p></dd><dt class="dt-description"><span style="font-weight:bold">forcepartial <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">forcepartial = </span><span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span><span style="font-family:monospace"> -&gt; </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> causes Unison to resolve all differences (even non-conflicting changes) in favor of <span style="font-family:monospace"><span style="font-style:italic">root</span></span> for the files in <span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span> (see the <a href="#pathspec">Path Specification</a> section for more information). This effectively changes Unison from a synchronizer into a mirroring utility. <p>You can also specify <code class="verb">forcepartial PATHSPEC -&gt; newer</code> (or <code class="verb">forcepartial PATHSPEC older</code>) to force Unison to choose the file with the later (earlier) modtime. In this case, the <code class="verb">-times</code> preference must also be enabled.</p><p>This preference should be used only if you are <em>sure</em> you know what you are doing!</p></dd><dt class="dt-description"><span style="font-weight:bold">group </span></dt><dd class="dd-description">
When this flag is set to <code class="verb">true</code>, the group attributes of the files are synchronized. Whether the group names or the group identifiers are synchronized depends on the preference <span style="font-family:monospace">numerids</span>.</dd><dt class="dt-description"><span style="font-weight:bold">halfduplex </span></dt><dd class="dd-description">
When this flag is set to <span style="font-family:monospace">true</span>, Unison network communication is forced to be half duplex (the client and the server never simultaneously emit data). If you experience unstabilities with your network link, this may help. The communication is always half-duplex when synchronizing with a Windows machine due to a limitation of Unison current implementation that could result in a deadlock.</dd><dt class="dt-description"><span style="font-weight:bold">height <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
Used to set the height (in lines) of the main window in the graphical user interface.</dd><dt class="dt-description"><span style="font-weight:bold">i </span></dt><dd class="dd-description">
Provide this preference in the command line arguments to enable interactive profile manager in the text user interface. Currently only profile listing and interactive selection are available. Preferences like <span style="font-family:monospace">batch</span> and <span style="font-family:monospace">silent</span> remain applicable to synchronization functionality.</dd><dt class="dt-description"><span style="font-weight:bold">ignore <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-ignore </span><span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> causes Unison to completely ignore paths that match <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> (as well as their children). This is useful for avoiding synchronizing temporary files, object files, etc. The syntax of <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> is described in the <a href="#pathspec">Path Specification</a> section, and further details on ignoring paths is found in the <a href="#ignore">Ignoring Paths</a> section.</dd><dt class="dt-description"><span style="font-weight:bold">ignorearchives </span></dt><dd class="dd-description">
When this preference is set, Unison will ignore any existing archive files and behave as though it were being run for the first time on these replicas. It is not a good idea to set this option in a profile: it is intended for command-line use.</dd><dt class="dt-description"><span style="font-weight:bold">ignorecase <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag causes Unison to treat filenames as case insensitive&#X2014;i.e., files in the two replicas whose names differ in (upper- and lower-case) &#X2018;spelling&#X2019; are treated as the same file. When the flag is set to <span style="font-family:monospace">false</span>, Unison will treat all filenames as case sensitive. Ordinarily, when the flag is set to <span style="font-family:monospace">default</span>, filenames are automatically taken to be case-insensitive if either host is running Windows or OSX. In rare circumstances it may be useful to set the flag manually.</dd><dt class="dt-description"><span style="font-weight:bold">ignoreinodenumbers </span></dt><dd class="dd-description">
When set to true, this preference makes Unison not take advantage of inode numbers during fast update detection. This switch should be used with care, as it is less safe than the standard update detection method, but it can be useful with filesystems which do not support inode numbers.</dd><dt class="dt-description"><span style="font-weight:bold">ignorelocks </span></dt><dd class="dd-description">
When this preference is set, Unison will ignore any lock files that may have been left over from a previous run of Unison that was interrupted while reading or writing archive files; by default, when Unison sees these lock files it will stop and request manual intervention. This option should be set only if you are <em>positive</em> that no other instance of Unison might be concurrently accessing the same archive files (e.g., because there was only one instance of unison running and it has just crashed or you have just killed it). It is probably not a good idea to set this option in a profile: it is intended for command-line use.</dd><dt class="dt-description"><span style="font-weight:bold">ignorenot <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference overrides the preference <span style="font-family:monospace">ignore</span>.
It gives a list of patterns
(in the same format as
<code class="verb">ignore</code>) for paths that should definitely <em>not</em> be ignored,
whether or not they happen to match one of the <code class="verb">ignore</code> patterns.
<p>Note that the semantics of <span style="font-family:monospace">ignore</span> and <span style="font-family:monospace">ignorenot</span> is a
little counter-intuitive. When detecting updates, Unison examines
paths in depth-first order, starting from the roots of the replicas
and working downwards. Before examining each path, it checks whether
it matches <span style="font-family:monospace">ignore</span> and does not match <span style="font-family:monospace">ignorenot</span>; in this case
it skips this path <em>and all its descendants</em>. This means that,
if some parent of a given path matches an <span style="font-family:monospace">ignore</span> pattern, then
it will be skipped even if the path itself matches an <span style="font-family:monospace">ignorenot</span>
pattern. In particular, putting <span style="font-family:monospace">ignore = Path *</span> in your profile
and then using <span style="font-family:monospace">ignorenot</span> to select particular paths to be
synchronized will not work. Instead, you should use the <span style="font-family:monospace">path</span>
preference to choose particular paths to synchronize.</p></dd><dt class="dt-description"><span style="font-weight:bold">immutable <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference specifies paths for directories whose immediate children are all immutable files &#X2014; i.e., once a file has been created, its contents never changes. When scanning for updates, Unison does not check whether these files have been modified; this can speed update detection significantly (in particular, for mail directories).</dd><dt class="dt-description"><span style="font-weight:bold">immutablenot <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference overrides <span style="font-family:monospace">immutable</span>.</dd><dt class="dt-description"><span style="font-weight:bold">key <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Used in a profile to define a numeric key (0-9) that can be used in the user interface to switch immediately to this profile.</dd><dt class="dt-description"><span style="font-weight:bold">killserver </span></dt><dd class="dd-description">
When set to <code class="verb">true</code>, this flag causes Unison to kill the remote server process when the synchronization is finished. This behavior is the default for <code class="verb">ssh</code> connections, so this preference is not normally needed when running over <code class="verb">ssh</code>; it is provided so that socket-mode servers can be killed off after a single run of Unison, rather than waiting to accept future connections. (Some users prefer to start a remote socket server for each run of Unison, rather than leaving one running all the time.)</dd><dt class="dt-description"><span style="font-weight:bold">label <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Used in a profile to provide a descriptive string documenting its settings. (This is useful for users that switch between several profiles, especially using the &#X2018;fast switch&#X2019; feature of the graphical user interface.)</dd><dt class="dt-description"><span style="font-weight:bold">links <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag causes Unison to synchronize symbolic links. When the flag is set to <span style="font-family:monospace">false</span>, symbolic links will result in an error during update detection. Ordinarily, when the flag is set to <span style="font-family:monospace">default</span>, symbolic links are synchronized except when one of the hosts is running Windows. In rare circumstances it may be useful to set the flag manually.</dd><dt class="dt-description"><span style="font-weight:bold">log </span></dt><dd class="dd-description">
When this flag is set, Unison will log all changes to the filesystems
on a file.</dd><dt class="dt-description"><span style="font-weight:bold">logfile <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
By default, logging messages will be appended to the file
<code class="verb">unison.log</code> in your .unison directory. Set this preference if
you prefer another file. It can be a path relative to your .unison directory.
Sending SIGUSR1 will close the logfile; the logfile will be re-opened (and
created, if needed) automatically, to allow for log rotation.</dd><dt class="dt-description"><span style="font-weight:bold">maxbackups <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
This preference specifies the number of backup versions that will be kept by unison, for each path that matches the predicate <code class="verb">backup</code>. The default is 2.</dd><dt class="dt-description"><span style="font-weight:bold">maxerrors <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
This preference controls after how many errors Unison aborts a directory transfer. Setting it to a large number allows Unison to transfer most of a directory even when some files fail to be copied. The default is 1. If the preference is set too high, Unison may take a long time to abort in case of repeated failures (for instance, when the disk is full).</dd><dt class="dt-description"><span style="font-weight:bold">maxsizethreshold <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
A number indicating above what filesize (in kilobytes) Unison should flag a conflict instead of transferring the file. This conflict remains even in the presence of force or prefer options. A negative number will allow every transfer independently of the size. The default is -1. </dd><dt class="dt-description"><span style="font-weight:bold">maxthreads <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
This preference controls how much concurrency is allowed during the transport phase. Normally, it should be set reasonably high to maximize performance, but when Unison is used over a low-bandwidth link it may be helpful to set it lower (e.g. to 1) so that Unison doesn&#X2019;t soak up all the available bandwidth. The default is the special value 0, which mean 20 threads when file content streaming is desactivated and 1000 threads when it is activated.</dd><dt class="dt-description"><span style="font-weight:bold">merge <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference can be used to run a merge program which will create a new version for each of the files and the backup, with the last backup and both replicas. The syntax of <span style="font-family:monospace"><span style="font-style:italic">pathspec -&gt; cmd</span></span> is described in the <a href="#pathspec">Path Specification</a> section, and further details on Merging functions are present in the <a href="#merge">Merging Conflicting Versions</a> section.</dd><dt class="dt-description"><span style="font-weight:bold">mountpoint <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-mountpoint PATH</span> causes Unison to double-check, at the end of update detection, that <span style="font-family:monospace">PATH</span> exists and abort if it does not. This is useful when Unison is used to synchronize removable media. This preference can be given more than once. See the <a href="#mountpoints">Mount Points and Removable Media</a> section.</dd><dt class="dt-description"><span style="font-weight:bold">nocreation <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-nocreation </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> prevents Unison from performing any file creation on root <span style="font-family:monospace"><span style="font-style:italic">root</span></span>.<p>This preference can be included twice, once for each root, if you want to prevent any creation.</p></dd><dt class="dt-description"><span style="font-weight:bold">nocreationpartial <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">nocreationpartial = </span><span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span><span style="font-family:monospace"> -&gt; </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> prevents Unison from performing any file creation in <span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span> on root <span style="font-family:monospace"><span style="font-style:italic">root</span></span> (see the <a href="#pathspec">Path Specification</a> section for more information). It is recommended to use <span style="font-family:monospace">BelowPath</span> patterns when selecting a directory and all its contents.</dd><dt class="dt-description"><span style="font-weight:bold">nodeletion <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-nodeletion </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> prevents Unison from performing any file deletion on root <span style="font-family:monospace"><span style="font-style:italic">root</span></span>.<p>This preference can be included twice, once for each root, if you want to prevent any deletion.</p></dd><dt class="dt-description"><span style="font-weight:bold">nodeletionpartial <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">nodeletionpartial = </span><span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span><span style="font-family:monospace"> -&gt; </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> prevents Unison from performing any file deletion in <span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span> on root <span style="font-family:monospace"><span style="font-style:italic">root</span></span> (see the <a href="#pathspec">Path Specification</a> section for more information). It is recommended to use <span style="font-family:monospace">BelowPath</span> patterns when selecting a directory and all its contents.</dd><dt class="dt-description"><span style="font-weight:bold">noupdate <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-noupdate </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> prevents Unison from performing any file update or deletion on root <span style="font-family:monospace"><span style="font-style:italic">root</span></span>.<p>This preference can be included twice, once for each root, if you want to prevent any update.</p></dd><dt class="dt-description"><span style="font-weight:bold">noupdatepartial <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">noupdatepartial = </span><span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span><span style="font-family:monospace"> -&gt; </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> prevents Unison from performing any file update or deletion in <span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span> on root <span style="font-family:monospace"><span style="font-style:italic">root</span></span> (see the <a href="#pathspec">Path Specification</a> section for more information). It is recommended to use <span style="font-family:monospace">BelowPath</span> patterns when selecting a directory and all its contents.</dd><dt class="dt-description"><span style="font-weight:bold">numericids </span></dt><dd class="dd-description">
When this flag is set to <code class="verb">true</code>, groups and users are synchronized numerically, rather than by name. <p>The special uid 0 and the special group 0 are never mapped via user/group names even if this preference is not set.</p></dd><dt class="dt-description"><span style="font-weight:bold">owner </span></dt><dd class="dd-description">
When this flag is set to <code class="verb">true</code>, the owner attributes of the files are synchronized. Whether the owner names or the owner identifiers are synchronizeddepends on the preference <span style="font-family:monospace">numerids</span>.</dd><dt class="dt-description"><span style="font-weight:bold">path <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When no <code class="verb">path</code> preference is given, Unison will simply synchronize the two entire replicas, beginning from the given pair of roots. If one or more <code class="verb">path</code> preferences are given, then Unison will synchronize only these paths and their children. (This is useful for doing a fast sync of just one directory, for example.) Note that <span style="font-family:monospace">path</span> preferences are interpreted literally&#X2014;they are not regular expressions.</dd><dt class="dt-description"><span style="font-weight:bold">perms <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
The integer value of this preference is a mask indicating which permission bits should be synchronized. It is set by default to 0<span style="font-style:italic">o</span>1777: all bits but the set-uid and set-gid bits are synchronised (synchronizing theses latter bits can be a security hazard). If you want to synchronize all bits, you can set the value of this preference to &#X2212;1. If one of the replica is on a FAT [Windows] filesystem, you should consider using the 	t fat preference instead of this preference. If you need Unison not to set permissions at all, set the value of this preference to 0 and set the preference 	t dontchmod to 	t true.</dd><dt class="dt-description"><span style="font-weight:bold">prefer <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-prefer </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> causes Unison always to resolve conflicts in favor of <span style="font-family:monospace"><span style="font-style:italic">root</span></span>, rather than asking for guidance from the user, except for paths marked by the preference <span style="font-family:monospace">merge</span>. (The syntax of <span style="font-family:monospace"><span style="font-style:italic">root</span></span> is the same as for the <code class="verb">root</code> preference, plus the special values <code class="verb">newer</code> and <code class="verb">older</code>.) <p>This preference is overridden by the <code class="verb">preferpartial</code> preference.</p><p>This preference should be used only if you are <em>sure</em> you know what you are doing!</p></dd><dt class="dt-description"><span style="font-weight:bold">preferpartial <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">preferpartial = </span><span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span><span style="font-family:monospace"> -&gt; </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> causes Unison always to resolve conflicts in favor of <span style="font-family:monospace"><span style="font-style:italic">root</span></span>, rather than asking for guidance from the user, for the files in <span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span> (see the <a href="#pathspec">Path Specification</a> section for more information). (The syntax of <span style="font-family:monospace"><span style="font-style:italic">root</span></span> is the same as for the <code class="verb">root</code> preference, plus the special values <code class="verb">newer</code> and <code class="verb">older</code>.) <p>This preference should be used only if you are <em>sure</em> you know what you are doing!</p></dd><dt class="dt-description"><span style="font-weight:bold">repeat <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Setting this preference causes the text-mode interface to synchronize repeatedly, rather than doing it just once and stopping. If the argument is a number, Unison will pause for that many seconds before beginning again. When the argument is <code class="verb">watch</code>, Unison relies on an external file monitoring process to synchronize whenever a change happens.</dd><dt class="dt-description"><span style="font-weight:bold">retry <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
Setting this preference causes the text-mode interface to try again to synchronize updated paths where synchronization fails. Each such path will be tried N times.</dd><dt class="dt-description"><span style="font-weight:bold">root <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Each use of this preference names the root of one of the replicas for Unison to synchronize. Exactly two roots are needed, so normal modes of usage are either to give two values for <code class="verb">root</code> in the profile, or to give no values in the profile and provide two on the command line. Details of the syntax of roots can be found in the <a href="#roots">Roots</a> section.<p>The two roots can be given in either order; Unison will sort them into a canonical order before doing anything else. It also tries to &#X2018;canonize&#X2019; the machine names and paths that appear in the roots, so that, if Unison is invoked later with a slightly different name for the same root, it will be able to locate the correct archives.</p></dd><dt class="dt-description"><span style="font-weight:bold">rootalias <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When calculating the name of the archive files for a given pair of roots, Unison replaces any roots matching the left-hand side of any rootalias rule by the corresponding right-hand side.</dd><dt class="dt-description"><span style="font-weight:bold">rshargs <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
The string value of this preference will be passed as additional arguments (besides the host name and the name of the Unison executable on the remote system) to the <code class="verb">rsh</code> command used to invoke the remote server. The backslash is an escape character.</dd><dt class="dt-description"><span style="font-weight:bold">rshcmd <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference can be used to explicitly set the name of the rsh executable (e.g., giving a full path name), if necessary.</dd><dt class="dt-description"><span style="font-weight:bold">rsrc <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag causes Unison to synchronize resource forks and HFS meta-data. On filesystems that do not natively support resource forks, this data is stored in Carbon-compatible ._ AppleDouble files. When the flag is set to <span style="font-family:monospace">false</span>, Unison will not synchronize these data. Ordinarily, the flag is set to <span style="font-family:monospace">default</span>, and these data are
automatically synchronized if either host is running OSX. In rare circumstances it is useful to set the flag manually.</dd><dt class="dt-description"><span style="font-weight:bold">rsync </span></dt><dd class="dd-description">
Unison uses the &#X2019;rsync algorithm&#X2019; for &#X2019;diffs-only&#X2019; transfer of updates to large files. Setting this flag to false makes Unison use whole-file transfers instead. Under normal circumstances, there is no reason to do this, but if you are having trouble with repeated &#X2019;rsync failure&#X2019; errors, setting it to false should permit you to synchronize the offending files.</dd><dt class="dt-description"><span style="font-weight:bold">selftest </span></dt><dd class="dd-description">
Run internal tests and exit. This option is mostly for developers and must be used carefully: in particular, it will delete the contents of both roots, so that it can install its own files for testing. This flag only makes sense on the command line. When it is provided, no preference file is read: all preferences must be specified on thecommand line. Also, since the self-test procedure involves overwriting the roots and backup directory, the names of the roots and of the backupdir preference must include the string "test" or else the tests will be aborted. (If these are not given on the command line, dummy subdirectories in the current directory will be created automatically.)</dd><dt class="dt-description"><span style="font-weight:bold">servercmd <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference can be used to explicitly set the name of the Unison executable on the remote server (e.g., giving a full path name), if necessary.</dd><dt class="dt-description"><span style="font-weight:bold">showarchive </span></dt><dd class="dd-description">
When this preference is set, Unison will print out the &#X2019;true names&#X2019;of the roots, in the same form as is expected by the <span style="font-family:monospace">rootalias</span>preference.</dd><dt class="dt-description"><span style="font-weight:bold">silent </span></dt><dd class="dd-description">
When this preference is set to <span style="font-family:monospace">true</span>, the textual user interface will print nothing at all, except in the case of errors. Setting <span style="font-family:monospace">silent</span> to true automatically sets the <span style="font-family:monospace">batch</span> preference to <span style="font-family:monospace">true</span>.</dd><dt class="dt-description"><span style="font-weight:bold">sortbysize </span></dt><dd class="dd-description">
When this flag is set, the user interface will list changed files by size (smallest first) rather than by name. This is useful, for example, for synchronizing over slow links, since it puts very large files at the end of the list where they will not prevent smaller files from being transferred quickly.<p>This preference (as well as the other sorting flags, but not the sorting preferences that require patterns as arguments) can be set interactively and temporarily using the &#X2019;Sort&#X2019; menu in the graphical and text user interfaces.</p></dd><dt class="dt-description"><span style="font-weight:bold">sortfirst <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Each argument to <span style="font-family:monospace">sortfirst</span> is a pattern <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span>, which describes a set of paths. Files matching any of these patterns will be listed first in the user interface. The syntax of <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> is described in the <a href="#pathspec">Path Specification</a> section.</dd><dt class="dt-description"><span style="font-weight:bold">sortlast <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Similar to <code class="verb">sortfirst</code>, except that files matching one of these patterns will be listed at the very end.</dd><dt class="dt-description"><span style="font-weight:bold">sortnewfirst </span></dt><dd class="dd-description">
When this flag is set, the user interface will list newly created files before all others. This is useful, for example, for checking that newly created files are not &#X2018;junk&#X2019;, i.e., ones that should be ignored or deleted rather than synchronized.</dd><dt class="dt-description"><span style="font-weight:bold">sshargs <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
The string value of this preference will be passed as additional arguments (besides the host name and the name of the Unison executable on the remote system) to the <code class="verb">ssh</code> command used to invoke the remote server. The backslash is an escape character.</dd><dt class="dt-description"><span style="font-weight:bold">sshcmd <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference can be used to explicitly set the name of the ssh executable (e.g., giving a full path name), if necessary.</dd><dt class="dt-description"><span style="font-weight:bold">sshversion <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference can be used to control which version of ssh should be used to connect to the server. Legal values are 1 and 2, which will cause unison to try to use <code class="verb">ssh1</code> or<code class="verb">ssh2</code> instead of just <code class="verb">ssh</code> to invoke ssh. The default value is empty, which will make unison use whatever version of ssh is installed as the default &#X2018;ssh&#X2019; command.</dd><dt class="dt-description"><span style="font-weight:bold">stream </span></dt><dd class="dd-description">
When this preference is set, Unison will use an experimental streaming protocol for transferring file contents more efficiently. The default value is <span style="font-family:monospace">true</span>.</dd><dt class="dt-description"><span style="font-weight:bold">terse </span></dt><dd class="dd-description">
When this preference is set to <span style="font-family:monospace">true</span>, the user interface will not print status messages.</dd><dt class="dt-description"><span style="font-weight:bold">testserver </span></dt><dd class="dd-description">
Setting this flag on the command line causes Unison to attempt to connect to the remote server and, if successful, print a message and immediately exit. Useful for debugging installation problems. Should not be set in preference files.</dd><dt class="dt-description"><span style="font-weight:bold">times </span></dt><dd class="dd-description">
When this flag is set to <code class="verb">true</code>, file modification times (but not directory modtimes) are propagated.</dd><dt class="dt-description"><span style="font-weight:bold">ui <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference selects either the graphical or the textual user interface. Legal values are <code class="verb">graphic</code> or <code class="verb">text</code>. <p>Because this option is processed specially during Unison&#X2019;s start-up sequence, it can <em>only</em> be used on the command line. In preference files it has no effect.</p><p>If the Unison executable was compiled with only a textual interface, this option has no effect. (The pre-compiled binaries are all compiled with both interfaces available.)</p></dd><dt class="dt-description"><span style="font-weight:bold">unicode <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag causes Unison to perform case insensitive file comparisons assuming Unicode encoding. This is the default. When the flag is set to <span style="font-family:monospace">false</span>, a Latin 1 encoding is assumed. When Unison runs in case sensitive mode, this flag only makes a difference if one host is running Windows or Mac OS X. Under Windows, the flag selects between using the Unicode or 8bit Windows API for accessing the filesystem. Under Mac OS X, it selects whether comparing the filenames up to decomposition, or byte-for-byte.</dd><dt class="dt-description"><span style="font-weight:bold">version </span></dt><dd class="dd-description">
Print the current version number and exit. (This option only makes sense on the command line.)</dd><dt class="dt-description"><span style="font-weight:bold">watch </span></dt><dd class="dd-description">
Unison uses a file watcher process, when available, to detect filesystem changes; this is used to speed up update detection. Setting this flag to false disables the use of this process.</dd><dt class="dt-description"><span style="font-weight:bold">xferbycopying </span></dt><dd class="dd-description">
When this preference is set, Unison will try to avoid transferring file contents across the network by recognizing when a file with the required contents already exists in the target replica. This usually allows file moves to be propagated very quickly. The default value is<span style="font-family:monospace">true</span>. </dd></dl><!--TOC subsection id="sec45" Profiles-->
<h3 id="sec45" class="subsection">Profiles</h3><!--SEC END --><p>A <em>profile</em> is a text file that specifies permanent settings for
roots, paths, ignore patterns, and other preferences, so that they do
not need to be typed at the command line every time Unison is run.
Profiles should reside in the <code class="verb">.unison</code> directory on the client
machine. If Unison is started with just one argument <span style="font-family:monospace"><span style="font-style:italic">name</span></span> on
the command line, it looks for a profile called <span style="font-family:monospace"><span style="font-style:italic">name</span></span><span style="font-family:monospace">.prf</span> in
the <code class="verb">.unison</code> directory. If it is started with no arguments, it
scans the <code class="verb">.unison</code> directory for files whose names end in
<code class="verb">.prf</code> and offers a menu (provided that the Unison executable is compiled with the graphical user interface). If a file named <code class="verb">default.prf</code> is
found, its settings will be offered as the default choices.</p><p>To set the value of a preference <span style="font-family:monospace">p</span> permanently, add to the
appropriate profile a line of the form
</p><pre class="verbatim">        p = true
</pre><p>
for a boolean flag or
</p><pre class="verbatim">        p = &lt;value&gt;
</pre><p>
for a preference of any other type.</p><p>Whitespaces around <span style="font-family:monospace">p</span> and <span style="font-family:monospace">xxx</span> are ignored.
A profile may also include blank lines and lines beginning
with <span style="font-family:monospace">#</span>; both are ignored.</p><p>When Unison starts, it first reads the profile and then the command
line, so command-line options will override settings from the
profile.</p><p>Profiles may also include lines of the form <span style="font-family:monospace">include </span><span style="font-family:monospace"><span style="font-style:italic">name</span></span>,
which will cause the file <span style="font-family:monospace"><span style="font-style:italic">name</span></span> (or <span style="font-family:monospace"><span style="font-style:italic">name</span></span><span style="font-family:monospace">.prf</span>, if
<span style="font-family:monospace"><span style="font-style:italic">name</span></span> does not exist in the <code class="verb">.unison</code> directory) to be read at
the point, and included as if its contents, instead of the <span style="font-family:monospace">include</span>
line, was part of the profile. Include lines allows settings common to
several profiles to be stored in one place.
A similar line of the form <span style="font-family:monospace">source </span><span style="font-family:monospace"><span style="font-style:italic">name</span></span> does the same except
that it does not attempt to add a suffix to <span style="font-family:monospace"><span style="font-style:italic">name</span></span>.
Similar lines of the form <span style="font-family:monospace">include</span><span style="font-family:monospace">?</span><span style="font-family:monospace"> </span><span style="font-family:monospace"><span style="font-style:italic">name</span></span> or
<span style="font-family:monospace">source</span><span style="font-family:monospace">?</span><span style="font-family:monospace"> </span><span style="font-family:monospace"><span style="font-style:italic">name</span></span> do the same as their respective lines
without the question mark except that it does not constitue an error to
specify a non-existing file <span style="font-family:monospace"><span style="font-style:italic">name</span></span>.
In <span style="font-family:monospace"><span style="font-style:italic">name</span></span> the backslash is an escape character.</p><p>A profile may include a preference &#X2018;<span style="font-family:monospace">label = </span><span style="font-family:monospace"><span style="font-style:italic">desc</span></span>&#X2019; to
provide a description of the options selected in this profile. The
string <span style="font-family:monospace"><span style="font-style:italic">desc</span></span> is listed along with the profile name in the profile
selection dialog, and displayed in the top-right corner of the main
Unison window in the graphical user interface.</p><p>The graphical user-interface also supports one-key shortcuts for commonly
used profiles. If a profile contains a preference of the form
&#X2018;<span style="font-family:monospace">key = </span><span style="font-family:monospace"><span style="font-style:italic">n</span></span>&#X2019;, where <span style="font-family:monospace"><span style="font-style:italic">n</span></span> is a single digit, then
pressing this digit key will cause Unison to immediately switch to
this profile and begin synchronization again from scratch. In this
case, all actions that have been selected for a set of changes
currently being displayed will be discarded.</p><!--TOC subsection id="sec46" Sample Profiles-->
<h3 id="sec46" class="subsection">Sample Profiles</h3><!--SEC END --><!--TOC subsubsection id="sec47" A Minimal Profile-->
<h4 id="sec47" class="subsubsection">A Minimal Profile</h4><!--SEC END --><p>Here is a very minimal profile file, such as might be found in <span style="font-family:monospace">.unison/default.prf</span>:
</p><pre class="verbatim">    # Roots of the synchronization
    root = /home/bcpierce
    root = ssh://saul//home/bcpierce

    # Paths to synchronize
    path = current
    path = common
    path = .netscape/bookmarks.html
</pre><!--TOC subsubsection id="sec48" A Basic Profile-->
<h4 id="sec48" class="subsubsection">A Basic Profile</h4><!--SEC END --><p>Here is a more sophisticated profile, illustrating some other useful
features.
</p><pre class="verbatim">    # Roots of the synchronization
    root = /home/bcpierce
    root = ssh://saul//home/bcpierce

    # Paths to synchronize
    path = current
    path = common
    path = .netscape/bookmarks.html

    # Some regexps specifying names and paths to ignore
    ignore = Name temp.*
    ignore = Name *~
    ignore = Name .*~
    ignore = Path */pilot/backup/Archive_*
    ignore = Name *.o
    ignore = Name *.tmp

    # Window height
    height = 37

    # Keep a backup copy of every file in a central location
    backuplocation = central
    backupdir = /home/bcpierce/backups
    backup = Name *
    backupprefix = $VERSION.
    backupsuffix =

    # Use this command for displaying diffs
    diff = diff -y -W 79 --suppress-common-lines

    # Log actions to the terminal
    log = true
</pre><!--TOC subsubsection id="sec49" A Power-User Profile-->
<h4 id="sec49" class="subsubsection">A Power-User Profile</h4><!--SEC END --><p>When Unison is used with large replicas, it is often convenient to be
able to synchronize just a part of the replicas on a given run (this
saves the time of detecting updates in the other parts). This can be
accomplished by splitting up the profile into several parts &#X2014; a common
part containing most of the preference settings, plus one &#X201C;top-level&#X201D;
file for each set of paths that need to be synchronized. (The <span style="font-family:monospace">include</span> mechanism can also be used to allow the same set of preference
settings to be used with different roots.)</p><p>The collection
of profiles implementing this scheme might look as follows.
The file <span style="font-family:monospace">default.prf</span> is empty except for an <span style="font-family:monospace">include</span>
directive:
</p><pre class="verbatim">    # Include the contents of the file common
    include common
</pre><p>
Note that the name of the common file is <span style="font-family:monospace">common</span>, not <span style="font-family:monospace">common.prf</span>; this prevents Unison from offering <span style="font-family:monospace">common</span> as one of
the list of profiles in the opening dialog (in the graphical UI).</p><p>The file <span style="font-family:monospace">common</span> contains the real preferences:
</p><pre class="verbatim">    # Roots of the synchronization
    root = /home/bcpierce
    root = ssh://saul//home/bcpierce

    # (... other preferences ...)

    # If any new preferences are added by Unison (e.g. 'ignore'
    # preferences added via the graphical UI), then store them in the
    # file 'common' rather than in the top-level preference file
    addprefsto = common

    # Names and paths to ignore:
    ignore = Name temp.*
    ignore = Name *~
    ignore = Name .*~
    ignore = Path */pilot/backup/Archive_*
    ignore = Name *.o
    ignore = Name *.tmp
</pre><p>
Note that there are no <span style="font-family:monospace">path</span> preferences in <span style="font-family:monospace">common</span>. This
means that, when we invoke Unison with the default profile (e.g., by
typing &#X2019;<span style="font-family:monospace">unison default</span>&#X2019; or just &#X2019;<span style="font-family:monospace">unison</span>&#X2019; on the command
line), the whole replicas will be synchronized. (If we <em>never</em> want
to synchronize the whole replicas, then <span style="font-family:monospace">default.prf</span> would instead
include settings for all the paths that are usually synchronized.)</p><p>To synchronize just part of the replicas, Unison is invoked with an
alternate preference file&#X2014;e.g., doing &#X2019;<span style="font-family:monospace">unison workingset</span>&#X2019;, where the
preference file <span style="font-family:monospace">workingset.prf</span> contains
</p><pre class="verbatim">    path = current/papers
    path = Mail/inbox
    path = Mail/drafts
    include common
</pre><p>
causes Unison to synchronize just the listed subdirectories.</p><p>The <span style="font-family:monospace">key</span> preference can be used in combination with the graphical UI
to quickly switch between different sets of paths. For example, if the
file <span style="font-family:monospace">mail.prf</span> contains
</p><pre class="verbatim">    path = Mail
    batch = true
    key = 2
    include common
</pre><p>
then pressing 2 will cause Unison to look for updates in the <span style="font-family:monospace">Mail</span>
subdirectory and (because the <span style="font-family:monospace">batch</span> flag is set) immediately
propagate any that it finds.</p><!--TOC subsection id="sec50" Keeping Backups-->
<h3 id="sec50" class="subsection">Keeping Backups</h3><!--SEC END --><p>When Unison overwrites (or deletes) a file or directory while propagating changes from
the other replica, it can keep the old version around as a backup. There
are several preferences that control precisely where these backups are
stored and how they are named.</p><p>To enable backups, you must give one or more <code class="verb">backup</code> preferences.
Each of these has the form
</p><pre class="verbatim">    backup = &lt;pathspec&gt;
</pre><p>
where <code class="verb">&lt;pathspec&gt;</code> has the same form as for the <code class="verb">ignore</code>
preference. For example,
</p><pre class="verbatim">    backup = Name *
</pre><p>
causes Unison to keep backups of <em>all</em> files and directories. The
<code class="verb">backupnot</code> preference can be used to give a few exceptions: it
specifies which files and directories should <em>not</em> be backed up, even if
they match the <code class="verb">backup</code> pathspec.</p><p>It is important to note that the <code class="verb">pathspec</code> is matched against the path
that is being updated by Unison, not its descendants. For example, if you
set <code class="verb">backup = Name *.txt</code> and then delete a whole directory named
<code class="verb">foo</code> containing some text files, these files will not be backed up
because Unison will just check that <code class="verb">foo</code> does not match <code class="verb">*.txt</code>.
Similarly, if the directory itself happened to be called <code class="verb">foo.txt</code>,
then the whole directory and all the files in it will be backed up,
regardless of their names.</p><p>Backup files can be stored either <em>centrally</em> or <em>locally</em>. This
behavior is controlled by the preference <code class="verb">backuplocation</code>, whose value
must be either <code class="verb">central</code> or <code class="verb">local</code>. (The default is
<code class="verb">central</code>.)</p><p>When backups are stored locally, they are kept in the same
directory as the original.</p><p>When backups are stored centrally, the directory used to hold them is
controlled by the preference <code class="verb">backupdir</code> and the
environment variable <code class="verb">UNISONBACKUPDIR</code>. (The environment variable is
checked first.) If neither of these are set, then the directory
<code class="verb">.unison/backup</code> in the user&#X2019;s home directory is used.</p><p>The preference <code class="verb">maxbackups</code> controls how many previous versions of
each file are kept (including the current version).</p><p>By default, backup files are named <code class="verb">.bak.VERSION.FILENAME</code>,
where <code class="verb">FILENAME</code> is the original filename and <code class="verb">VERSION</code> is the
backup number (1 for the most recent, 2 for the next most recent,
etc.). This can be changed by setting the preferences <code class="verb">backupprefix</code>
and/or <code class="verb">backupsuffix</code>. If desired, <code class="verb">backupprefix</code> may include a
directory prefix; this can be used with <code class="verb">backuplocation = local</code> to put all
backup files for each directory into a single subdirectory. For example, setting
</p><pre class="verbatim">    backuplocation = local
    backupprefix = .unison/$VERSION.
    backupsuffix =
</pre><p>
will put all backups in a local subdirectory named <code class="verb">.unison</code>. Also,
note that the string <code class="verb">$VERSION</code> in either <code class="verb">backupprefix</code> or
<code class="verb">backupsuffix</code> (it must appear in one or the other) is replaced by
the version number. This can be used, for example, to ensure that backup
files retain the same extension as the originals.</p><p>For backward compatibility, the <code class="verb">backups</code> preference is also supported.
It simply means <code class="verb">backup = Name *</code> and <code class="verb">backuplocation = local</code>.</p><!--TOC subsection id="sec51" Merging Conflicting Versions-->
<h3 id="sec51" class="subsection">Merging Conflicting Versions</h3><!--SEC END --><p>Unison can invoke external programs to merge conflicting versions of a file.
The preference <code class="verb">merge</code> controls this process.</p><p>The <code class="verb">merge</code> preference may be given once or several times in a
preference file (it can also be given on the command line, of course, but
this tends to be awkward because of the spaces and special characters
involved). Each instance of the preference looks like this:
</p><pre class="verbatim">    merge = &lt;PATHSPEC&gt; -&gt; &lt;MERGECMD&gt;
</pre><p>
The <code class="verb">&lt;PATHSPEC&gt;</code> here has exactly the same format as for the
<code class="verb">ignore</code> preference (see the <a href="#pathspec">Path Specification</a> section). For example,
using &#X201C;<code class="verb">Name *.txt</code>&#X201D; as the <code class="verb">&lt;PATHSPEC&gt;</code> tells Unison that this
command should be used whenever a file with extension <code class="verb">.txt</code> needs to
be merged.</p><p>Many external merging programs require as inputs not just the two files that
need to be merged, but also a file containing the <em>last synchronized
version</em>. You can ask Unison to keep a copy of the last synchronized
version for some files using the <code class="verb">backupcurrent</code> preference. This
preference is used in exactly the same way as <code class="verb">backup</code> and its meaning
is similar, except that it causes backups to be kept of the <em>current</em>
contents of each file after it has been synchronized by Unison, rather than
the <em>previous</em> contents that Unison overwrote. These backups are kept
on <em>both</em> replicas in the same place as ordinary backup files&#X2014;i.e.
according to the <code class="verb">backuplocation</code> and <code class="verb">backupdir</code> preferences.
They are named like the original files if <code class="verb">backupslocation</code> is set to
&#X2019;central&#X2019; and otherwise, Unison uses the <code class="verb">backupprefix</code> and
<code class="verb">backupsuffix</code> preferences and assumes a version number 000 for these
backups.</p><p>The <code class="verb">&lt;MERGECMD&gt;</code> part of the preference specifies what external command
should be invoked to merge files at paths matching the <code class="verb">&lt;PATHSPEC&gt;</code>.
Within this string, several special substrings are recognized; these will be
substituted with appropriate values before invoking a sub-shell to execute
the command.
</p><ul class="itemize"><li class="li-itemize">
<code class="verb">CURRENT1</code> is replaced by the name of (a temporary copy of)
the local variant of the file.
</li><li class="li-itemize"><code class="verb">CURRENT2</code> is replaced by the name of a temporary
file, into which the contents of the remote variant of the file have
been transferred by Unison prior to performing the merge.
</li><li class="li-itemize"><code class="verb">CURRENTARCH</code> is replaced by the name of the backed up copy
of the original version of the file (i.e., the file saved by Unison
if the current filename matches the path specifications for the
<code class="verb">backupcurrent</code> preference, as explained above), if one exists.
If no archive exists and <code class="verb">CURRENTARCH</code> appears in the
merge command, then an error is signalled.
</li><li class="li-itemize"><code class="verb">CURRENTARCHOPT</code> is replaced by the name of the backed up copy
of the original version of the file (i.e., its state at the end of
the last successful run of Unison), if one exists, or the empty
string if no archive exists.
</li><li class="li-itemize"><code class="verb">NEW</code> is replaced by the name of a temporary file
that Unison expects to be written by the merge program when it
finishes, giving the desired new contents of the file.
</li><li class="li-itemize"><code class="verb">PATH</code> is replaced by the path (relative to the roots of
the replicas) of the file being merged.
</li><li class="li-itemize"><code class="verb">NEW1</code> and <code class="verb">NEW2</code> are replaced by the names of temporary files
that Unison expects to be written by the merge program when it
is only able to partially merge the originals; in this case, <code class="verb">NEW1</code>
will be written back to the local replica and <code class="verb">NEW2</code> to the remote
replica; <code class="verb">NEWARCH</code>, if present, will be used as the &#X201C;last common
state&#X201D; of the replicas. (These three options are provided for
later compatibility with the Harmony data synchronizer.)
</li><li class="li-itemize"><code class="verb">BATCHMODE</code> is replaced according to the batch mode of
Unison; if it is in <span style="font-family:monospace">batch</span> mode, then a non empty string
(&#X201C;<code class="verb">batch</code>&#X201D;) is substituted, otherwise the empty string is substituted.
</li></ul><p>
To accommodate the wide variety of programs that users might want to use for
merging, Unison checks for several possible situations when the merge
program exits:
</p><ul class="itemize"><li class="li-itemize">
If the merge program exits with a non-zero status, then merge is
considered to have failed and the replicas are not changed.
</li><li class="li-itemize">If the file <code class="verb">NEW</code> has been created, it is written back to both
replicas (and stored in the backup directory). Similarly, if just the
file <code class="verb">NEW1</code> has been created, it is written back to both
replicas.
</li><li class="li-itemize">If neither <code class="verb">NEW</code> nor <code class="verb">NEW1</code> have been created, then Unison
examines the temporary files <code class="verb">CURRENT1</code> and <code class="verb">CURRENT2</code> that
were given as inputs to the merge program. If either has been changed (or
both have been changed in identical ways), then its new contents are written
back to both replicas. If either <code class="verb">CURRENT1</code> or <code class="verb">CURRENT2</code> has
been <em>deleted</em>, then the contents of the other are written back to
both replicas.
</li><li class="li-itemize">If the files <code class="verb">NEW1</code>, <code class="verb">NEW2</code>, and <code class="verb">NEWARCH</code> have all
been created, they are written back to the local replica, remote replica,
and backup directory, respectively. If the files <code class="verb">NEW1</code>, <code class="verb">NEW2</code> have
been created, but <code class="verb">NEWARCH</code> has not, then these files are written back to the
local replica and remote replica, respectively. Also, if <code class="verb">NEW1</code> and
<code class="verb">NEW2</code> have identical contents, then the same contents are stored as
a backup (if the <code class="verb">backupcurrent</code> preference is set for this path) to
reflect the fact that the path is currently in sync.
</li><li class="li-itemize">If <code class="verb">NEW1</code> and <code class="verb">NEW2</code> (resp. <code class="verb">CURRENT1</code> and
<code class="verb">CURRENT2</code>) are created (resp. overwritten) with different contents
but the merge command did not fail (i.e., it exited with status code 0),
then we copy <code class="verb">NEW1</code> (resp. <code class="verb">CURRENT1</code>) to the other replica and
to the archive.<p>This behavior is a design choice made to handle the case where a merge
command only synchronizes some specific contents between two files,
skipping some irrelevant information (order between entries, for
instance). We assume that, if the merge command exits normally, then the
two resulting files are &#X201C;as good as equal.&#X201D; (The reason we copy one on
top of the other is to avoid Unison detecting that the files are unequal
the next time it is run and trying again to merge them when, in fact, the
merge program has already made them as similar as it is able to.)
</p></li></ul><p>You can disable a merge by setting a <code class="verb">&lt;MERGECMD&gt;</code> that does nothing. For
example you can override the merging of text files specified in a profile by
typing on the command line:
</p><pre class="verbatim">    unison profile -merge 'Name *.txt -&gt; echo SKIP'
</pre><p>If the <code class="verb">confirmmerge</code> preference is set and Unison is not run in
batch mode, then Unison will always ask for confirmation before
actually committing the results of the merge to the replicas.</p><p>You can detect batch mode by testing <code class="verb">BATCHMODE</code>; for
example to avoid a merge completely do nothing:
</p><pre class="verbatim">    merge = Name *.txt -&gt; [ -z "BATCHMODE" ] &amp;&amp; mergecmd CURRENT1 CURRENT2
</pre><p>A large number of external merging programs are available.
For example, on Unix systems setting the <code class="verb">merge</code> preference to
</p><pre class="verbatim">    merge = Name *.txt -&gt; diff3 -m CURRENT1 CURRENTARCH CURRENT2
                            &gt; NEW || echo "differences detected"
</pre><p>
will tell Unison to use the external <code class="verb">diff3</code> program for merging.
Alternatively, users of <code class="verb">emacs</code> may find the following settings convenient:
</p><pre class="verbatim">    merge = Name *.txt -&gt; emacs -q --eval '(ediff-merge-files-with-ancestor
                             "CURRENT1" "CURRENT2" "CURRENTARCH" nil "NEW")'
</pre><p>
(These commands are displayed here on two lines to avoid running off the
edge of the page. In your preference file, each command should be written on a
single line.)</p><p>Users running emacs under windows may find something like this useful:
</p><pre class="verbatim">   merge = Name * -&gt; C:\Progra~1\Emacs\emacs\bin\emacs.exe -q --eval
                            "(ediff-files """CURRENT1""" """CURRENT2""")"
</pre><p>Users running Mac OS X (you may need the Developer Tools installed to get
the <span style="font-family:monospace">opendiff</span> utility) may prefer
</p><pre class="verbatim">    merge = Name *.txt -&gt; opendiff CURRENT1 CURRENT2 -ancestor CURRENTARCH -merge NEW
</pre><p>
Here is a slightly more involved hack. The <span style="font-family:monospace">opendiff</span> program can
operate either with or without an archive file. A merge command of this
form
</p><pre class="verbatim">    merge = Name *.txt -&gt;
              if [ CURRENTARCHOPTx = x ];
              then opendiff CURRENT1 CURRENT2 -merge NEW;
              else opendiff CURRENT1 CURRENT2 -ancestor CURRENTARCHOPT -merge NEW;
              fi
</pre><p>
(still all on one line in the preference file!) will test whether an archive
file exists and use the appropriate variant of the arguments to <span style="font-family:monospace">opendiff</span>.</p><p>Linux users may enjoy this variant:
</p><pre class="verbatim">    merge = Name * -&gt; kdiff3 -o NEW CURRENTARCHOPT CURRENT1 CURRENT2
</pre><p>Ordinarily, external merge programs are only invoked when Unison is <em>not</em> running in batch mode. To specify an external merge program that
should be used no matter the setting of the <span style="font-family:monospace">batch</span> flag, use the <span style="font-family:monospace">mergebatch</span> preference instead of <span style="font-family:monospace">merge</span>.</p><blockquote class="quote">
<span style="font-style:italic">Please post suggestions for other useful values of the
</span><code class="verb"><span style="font-style:italic">merge</span></code><span style="font-style:italic"> preference to the </span><span style="font-style:italic"><span style="font-family:monospace">unison-users</span></span><span style="font-style:italic"> mailing list&#X2014;we&#X2019;d like
to give several examples here.
</span></blockquote><!--TOC subsection id="sec52" The User Interface-->
<h3 id="sec52" class="subsection">The User Interface</h3><!--SEC END --><p>Both the textual and the graphical user interfaces are intended to be
mostly self-explanatory. Here are just a few tricks:
</p><ul class="itemize"><li class="li-itemize">
By default, when running on Unix the textual user interface will
try to put the terminal into the &#X201C;raw mode&#X201D; so that it reads the input a
character at a time rather than a line at a time. (This means you can
type just the single keystroke &#X201C;<code class="verb">&gt;</code>&#X201D; to tell Unison to
propagate a file from left to right, rather than &#X201C;<code class="verb">&gt;</code> Enter.&#X201D;)<p>There are some situations, though, where this will not work &#X2014; for
example, when Unison is running in a shell window inside Emacs.
Setting the <code class="verb">dumbtty</code> preference will force Unison to leave the
terminal alone and process input a line at a time.
</p></li></ul><!--TOC subsection id="sec53" Exit Code-->
<h3 id="sec53" class="subsection">Exit Code</h3><!--SEC END --><p>When running in the textual mode, Unison returns an exit status, which
describes whether, and at which level, the synchronization was successful.
The exit status could be useful when Unison is invoked from a script.
Currently, there are four possible values for the exit status:
</p><ul class="itemize"><li class="li-itemize">
0: successful synchronization; everything is up-to-date now.
</li><li class="li-itemize">1: some files were skipped, but all file transfers were successful.
</li><li class="li-itemize">2: non-fatal failures occurred during file transfer.
</li><li class="li-itemize">3: a fatal error occurred, or the execution was interrupted.
</li></ul><p>
The graphical interface does not return any useful information through the
exit status.</p><!--TOC subsection id="sec54" Path Specification-->
<h3 id="sec54" class="subsection">Path Specification</h3><!--SEC END --><p>
Several Unison preferences (e.g., <code class="verb">ignore</code>/<code class="verb">ignorenot</code>,
<code class="verb">follow</code>, <code class="verb">sortfirst</code>/<code class="verb">sortlast</code>, <code class="verb">backup</code>,
<code class="verb">merge</code>, etc.)
specify individual paths or sets of paths. These preferences share a
common syntax based on regular-expressions. Each preference
is associated with a list of path patterns; the paths specified are those
that match any one of the path pattern.</p><ul class="itemize"><li class="li-itemize">
Pattern preferences can be given on the command line,
or, more often, stored in profiles, using the same syntax as other preferences.
For example, a profile line of the form
<pre>
             ignore = <span style="font-family:monospace"><span style="font-style:italic">pattern</span></span>
</pre>
adds <span style="font-family:monospace"><span style="font-style:italic">pattern</span></span> to the list of patterns to be ignored.</li><li class="li-itemize">Each <span style="font-family:monospace"><span style="font-style:italic">pattern</span></span> can have one of three forms. The most
general form is a Posix extended regular expression introduced by the
keyword <code class="verb">Regex</code>. (The collating sequences and character classes of
full Posix regexps are not currently supported).
<pre>
                 Regex <span style="font-family:monospace"><span style="font-style:italic">regexp</span></span>
</pre>
For convenience, three other styles of pattern are also recognized:
<pre>
                 Name <span style="font-family:monospace"><span style="font-style:italic">name</span></span>
</pre>
matches any path in which the last component matches <span style="font-family:monospace"><span style="font-style:italic">name</span></span>,
<pre>
                 Path <span style="font-family:monospace"><span style="font-style:italic">path</span></span>
</pre>
matches exactly the path <span style="font-family:monospace"><span style="font-style:italic">path</span></span>, and
<pre>
                 BelowPath <span style="font-family:monospace"><span style="font-style:italic">path</span></span>
</pre>
matches the path <span style="font-family:monospace"><span style="font-style:italic">path</span></span> and any path below.
The <span style="font-family:monospace"><span style="font-style:italic">name</span></span> and <span style="font-family:monospace"><span style="font-style:italic">path</span></span> arguments of the latter forms of
patterns are <em>not</em> regular expressions. Instead,
standard &#X201C;globbing&#X201D; conventions can be used in <span style="font-family:monospace"><span style="font-style:italic">name</span></span> and
<span style="font-family:monospace"><span style="font-style:italic">path</span></span>:
<ul class="itemize"><li class="li-itemize">
a <code class="verb">*</code> matches any sequence of characters not including <code class="verb">/</code>
(and not beginning with <code class="verb">.</code>, when used at the beginning of a
<span style="font-family:monospace"><span style="font-style:italic">name</span></span>)
</li><li class="li-itemize">a <code class="verb">?</code> matches any single character except <code class="verb">/</code> (and leading
<code class="verb">.</code>)
</li><li class="li-itemize"><code class="verb">[xyz]</code> matches any character from the set {<span style="font-family:monospace"><span style="font-style:italic">x</span></span>,
<span style="font-family:monospace"><span style="font-style:italic">y</span></span>, <span style="font-family:monospace"><span style="font-style:italic">z</span></span> }
</li><li class="li-itemize"><code class="verb">{a,bb,ccc}</code> matches any one of <code class="verb">a</code>, <code class="verb">bb</code>, or
<code class="verb">ccc</code>. (Be careful not to put extra spaces after the commas:
these will be interpreted literally as part of the strings to be matched!)
</li></ul>
</li><li class="li-itemize">The path separator in path patterns is always the
forward-slash character &#X201C;/&#X201D; &#X2014; even when the client or server is
running under Windows, where the normal separator character is a
backslash. This makes it possible to use the same set of path
patterns for both Unix and Windows file systems.
</li><li class="li-itemize">A path specification may be followed by the separator &#X201C;<code class="verb"> -&gt; </code>&#X201D; itself
followed by a string which will be associated to the matching paths:
<pre>
                 Path <span style="font-family:monospace"><span style="font-style:italic">path</span></span> -&gt; <span style="font-family:monospace"><span style="font-style:italic">associated string</span></span>
</pre>
Not all pathspec preferences use these associated strings but all pathspec
preferences are parsed identically and the strings may be ignored. Only the
last match of the separator string on the line is used as a delimiter. Thus
to allow a path specification to contain the separator string, append an
associated string to it, even if it is not used. The associated string cannot
contain the separator string.
</li></ul><p>
Some examples of path patterns appear in the <a href="#ignore">Ignoring Paths</a> section.
Associated strings are used by the preference <span style="font-family:monospace">merge</span>.</p><!--TOC subsection id="sec55" Ignoring Paths-->
<h3 id="sec55" class="subsection">Ignoring Paths</h3><!--SEC END --><p>Most users of Unison will find that their replicas contain lots of
files that they don&#X2019;t ever want to synchronize &#X2014; temporary files,
very large files, old stuff, architecture-specific binaries, etc.
They can instruct Unison to ignore these paths using patterns
introduced in the <a href="#pathspec">Path Specification</a> section.</p><p>For example, the following pattern will make Unison ignore any
path containing the name <code class="verb">CVS</code> or a name ending in <code class="verb">.cmo</code>:
</p><pre class="verbatim">             ignore = Name {CVS,*.cmo}
</pre><p>
The next pattern makes Unison ignore the path <code class="verb">a/b</code>:
</p><pre class="verbatim">             ignore = Path a/b
</pre><p>
Path patterns do <em>not</em> skip filenames beginning with <code class="verb">.</code> (as Name
patterns do). For example,
</p><pre class="verbatim">             ignore = Path */tmp
</pre><p>
will include <code class="verb">.foo/tmp</code> in the set of ignore directories, as it is a
path, not a name, that is ignored.</p><p>The following pattern makes Unison ignore any path beginning with <code class="verb">a/b</code>
and ending with a name ending by <code class="verb">.ml</code>.
</p><pre class="verbatim">             ignore = Regex a/b/.*\.ml
</pre><p>
Note that regular expression patterns are &#X201C;anchored&#X201D;: they must
match the whole path, not just a substring of the path.</p><p>Here are a few extra points regarding the <span style="font-family:monospace">ignore</span> preference.
</p><ul class="itemize"><li class="li-itemize">
If a directory is ignored, all its descendants will be too.</li><li class="li-itemize">The user interface provides some convenient commands for adding
new patterns to be ignored. To ignore a particular file, select it
and press &#X201C;<span style="font-family:monospace">i</span>&#X201D;. To ignore all files with the same extension,
select it and press &#X201C;<span style="font-family:monospace">E</span>&#X201D; (with the shift key). To ignore all
files with the same name, no matter what directory they appear in,
select it and press &#X201C;<span style="font-family:monospace">N</span>&#X201D;.
These new patterns become permanent: they
are immediately added to the current profile on disk.</li><li class="li-itemize">If you use the <code class="verb">include</code> directive to include a common
collection of preferences in several top-level preference files, you will
probably also want to set the <code class="verb">addprefsto</code> preference to the name of
this file. This will cause any new ignore patterns that you add from
inside Unison to be appended to this file, instead of whichever top-level
preference file you started Unison with.</li><li class="li-itemize">Ignore patterns can also be specified on the command line, if
you like (this is probably not very useful), using an option like
<code class="verb">-ignore 'Name temp.txt'</code>.</li><li class="li-itemize">Be careful about renaming directories containing ignored files.
Because Unison understands the rename as a delete plus a create, any ignored
files in the directory will be lost (since they are invisible to Unison and
therefore they do not get recreated in the new version of the directory).</li><li class="li-itemize">There is also an <code class="verb">ignorenot</code> preference, which specifies a set of
patterns for paths that should <em>not</em> be ignored, even if they match an
<code class="verb">ignore</code> pattern. However, the interaction of these two sets of
patterns can be a little tricky. Here is exactly how it works:
<ul class="itemize"><li class="li-itemize">
Unison starts detecting updates from the root of the
replicas&#X2014;i.e., from the empty path. If the empty path matches an
<code class="verb">ignore</code> pattern and does not match an <code class="verb">ignorenot</code> pattern, then
the whole replica will be ignored. (For this reason, it is not a good
idea to include <code class="verb">Name *</code> as an <code class="verb">ignore</code> pattern. If you want to
ignore everything except a certain set of files, use <code class="verb">Name ?*</code>.)
</li><li class="li-itemize">If the root is a directory, Unison continues looking for updates in
all the immediate children of the root. Again, if the name of some child matches an
<code class="verb">ignore</code> pattern and does not match an <code class="verb">ignorenot</code> pattern, then
this whole path <em>including everything below it</em> will be ignored.
</li><li class="li-itemize">If any of the non-ignored children are directories, then the process
continues recursively.
</li></ul>
</li></ul><!--TOC subsection id="sec56" Symbolic Links-->
<h3 id="sec56" class="subsection">Symbolic Links</h3><!--SEC END --><p>Ordinarily, Unison treats symbolic links in Unix replicas as
&#X201C;opaque&#X201D;: it considers the contents of the link to be just the
string specifying where the link points, and it will propagate changes in
this string to the other replica.</p><p>It is sometimes useful to treat a symbolic link &#X201C;transparently,&#X201D;
acting as though whatever it points to were physically <em>in</em> the
replica at the point where the symbolic link appears. To tell Unison
to treat a link in this manner, add a line of the form
</p><pre>
             follow = <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span>
</pre><p>
to the profile, where <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> is a path pattern as described in
the <a href="#pathspec">Path Specification</a> section.</p><p>Windows file systems do not support symbolic links; Unison will refuse
to propagate an opaque symbolic link from Unix to Windows and flag the
path as erroneous. When a Unix replica is to be synchronized with a
Windows system, all symbolic links should match either an
<code class="verb">ignore</code> pattern or a <code class="verb">follow</code> pattern.</p><!--TOC subsection id="sec57" Permissions-->
<h3 id="sec57" class="subsection">Permissions</h3><!--SEC END --><p>Synchronizing the permission bits of files is slightly tricky when two
different filesystems are involved (e.g., when synchronizing a Windows
client and a Unix server). In detail, here&#X2019;s how it works:
</p><ul class="itemize"><li class="li-itemize">
When the permission bits of an existing file or directory are
changed, the values of those bits that make sense on <em>both</em>
operating systems will be propagated to the other replica. The other
bits will not be changed.
</li><li class="li-itemize">When a newly created file is propagated to a remote replica, the
permission bits that make sense in both operating systems are also
propagated. The values of the other bits are set to default values
(they are taken from the current umask, if the receiving host is a
Unix system).
</li><li class="li-itemize">For security reasons, the Unix <code class="verb">setuid</code> and <code class="verb">setgid</code>
bits are not propagated.
</li><li class="li-itemize">The Unix owner and group ids are not propagated. (What would
this mean, in general?) All files are created with the owner and
group of the server process.
</li></ul><!--TOC subsection id="sec58" Cross-Platform Synchronization-->
<h3 id="sec58" class="subsection">Cross-Platform Synchronization</h3><!--SEC END --><p>If you use Unison to synchronize files between Windows and Unix
systems, there are a few special issues to be aware of.</p><p><span style="font-weight:bold">Case conflicts.</span> In Unix, filenames are case sensitive:
<span style="font-family:monospace">foo</span> and <span style="font-family:monospace">FOO</span> can refer to different files. In
Windows, on the other hand, filenames are not case sensitive:
<span style="font-family:monospace">foo</span> and <span style="font-family:monospace">FOO</span> can only refer to the same file. This
means that a Unix <span style="font-family:monospace">foo</span> and <span style="font-family:monospace">FOO</span> cannot be synchronized
onto a Windows system &#X2014; Windows won&#X2019;t allow two different files to
have the &#X201C;same&#X201D; name. Unison detects this situation for you, and
reports that it cannot synchronize the files.</p><p>You can deal with a case conflict in a couple of ways. If you need to
have both files on the Windows system, your only choice is to rename
one of the Unix files to avoid the case conflict, and re-synchronize.
If you don&#X2019;t need the files on the Windows system, you can simply
disregard Unison&#X2019;s warning message, and go ahead with the
synchronization; Unison won&#X2019;t touch those files. If you don&#X2019;t want to
see the warning on each synchronization, you can tell Unison to ignore
the files (see the <a href="#ignore">Ignoring Paths</a> section).</p><p><span style="font-weight:bold">Illegal filenames.</span> Unix allows some filenames that are
illegal in Windows. For example, colons (&#X2018;:&#X2019;) are not allowed in
Windows filenames, but they are legal in Unix filenames. This means
that a Unix file <span style="font-family:monospace">foo:bar</span> can&#X2019;t be synchronized to a Windows
system. As with case conflicts, Unison detects this situation for
you, and you have the same options: you can either rename the Unix
file and re-synchronize, or you can ignore it.</p><!--TOC subsection id="sec59" Slow Links-->
<h3 id="sec59" class="subsection">Slow Links</h3><!--SEC END --><p>Unison is built to run well even over relatively slow links such as
modems and DSL connections.</p><p>Unison uses the &#X201C;rsync protocol&#X201D; designed by Andrew Tridgell and Paul
Mackerras to greatly speed up transfers of large files in which only
small changes have been made. More information about the rsync protocol
can be found at the rsync web site (<a href="http://samba.anu.edu.au/rsync/"><span style="font-family:monospace">http://samba.anu.edu.au/rsync/</span></a>).</p><p>If you are using Unison with <span style="font-family:monospace">ssh</span>, you may get some speed
improvement by enabling <span style="font-family:monospace">ssh</span>&#X2019;s compression feature. Do this by
adding the option &#X201C;<span style="font-family:monospace">-sshargs -C</span>&#X201D; to the command line or &#X201C;<span style="font-family:monospace">sshargs = -C</span>&#X201D; to your profile.</p><!--TOC subsection id="sec60" Making Unison Faster on Large Files-->
<h3 id="sec60" class="subsection">Making Unison Faster on Large Files</h3><!--SEC END --><p>Unison&#X2019;s built-in implementation of the rsync algorithm makes transferring
updates to existing files pretty fast. However, for whole-file copies of
newly created files, the built-in transfer method is not highly optimized.
Also, if Unison is interrupted in the middle of transferring a large file,
it will attempt to retransfer the whole thing on the next run.</p><p>These shortcomings can be addressed with a little extra work by telling
Unison to use an external file copying utility for whole-file transfers.
The recommended one is the standalone <span style="font-family:monospace">rsync</span> tool, which is available
by default on most Unix systems and can easily be installed on Windows
systems using Cygwin.</p><p>If you have <span style="font-family:monospace">rsync</span> installed on both hosts, you can make Unison use it
simply by setting the <span style="font-family:monospace">copythreshold</span> flag to something non-negative.
If you set it to 0, Unison will use the external copy utility for <em>all</em>
whole-file transfers. (This is probably slower than letting Unison copy
small files by itself, but can be useful for testing.) If you set it to a
larger value, Unison will use the external utility for all files larger than
this size (which is given in kilobytes, so setting it to 1000 will cause the
external tool to be used for all transfers larger than a megabyte).</p><p>If you want to use a different external copy utility, set both the <span style="font-family:monospace">copyprog</span> and <span style="font-family:monospace">copyprogrest</span> preferences&#X2014;the former is used for
the first transfer of a file, while the latter is used when Unison sees a
partially transferred temp file on the receiving host. Be careful here:
Your external tool needs to be instructed to copy files in place (otherwise
if the transfer is interrupted Unison will not notice that some of the data
has already been transferred, the next time it tries). The default values
are:
</p><pre class="verbatim">   copyprog      =   rsync --inplace --compress
   copyprogrest  =   rsync --partial --inplace --compress
</pre><p>
You may also need to set the <span style="font-family:monospace">copyquoterem</span> preference. When it is set
to <span style="font-family:monospace">true</span>, this causes Unison to add an extra layer of quotes to
the remote path passed to the external copy program. This is is needed by
rsync, for example, which internally uses an ssh connection, requiring an
extra level of quoting for paths containing spaces. When this flag is set to
<span style="font-family:monospace">default</span>, extra quotes are added if the value of <span style="font-family:monospace">copyprog</span>
contains the string <span style="font-family:monospace">rsync</span>. The default value is <span style="font-family:monospace">default</span>,
naturally.</p><p>If a <em>directory</em> transfer is interrupted, the next run of Unison will
automatically skip any files that were completely transferred before the
interruption. (This behavior is always on: it does not depend on the
setting of the <span style="font-family:monospace">copythreshold</span> preference.) Note, though, that the new
directory will not appear in the destination filesystem until everything has
been transferred&#X2014;partially transferred directories are kept in a temporary
location (with names like <span style="font-family:monospace">.unison.DIRNAME....</span>) until the transfer is
complete.</p><!--TOC subsection id="sec61" Fast Update Detection-->
<h3 id="sec61" class="subsection">Fast Update Detection</h3><!--SEC END --><p>If your replicas are large and at least one of them is on a Windows
system, you may find that Unison&#X2019;s default method for detecting changes
(which involves scanning the full contents of every file on every
sync&#X2014;the only completely safe way to do it under Windows) is too slow.
Unison provides a preference <span style="font-family:monospace">fastcheck</span> that, when set to
<code class="verb">true</code>, causes it to use file creation times as &#X2019;pseudo inode
numbers&#X2019; when scanning replicas for updates, instead of reading the full
contents of every file.</p><p>When <code class="verb">fastcheck</code> is set to <code class="verb">no</code>,
Unison will perform slow checking&#X2014;re-scanning the contents of each file
on each synchronization&#X2014;on all replicas. When <code class="verb">fastcheck</code> is set
to <code class="verb">default</code> (which, naturally, is the default), Unison will use
fast checks on Unix replicas and slow checks on Windows replicas.</p><p>This strategy may cause Unison to miss propagating an update if the
modification time and length of the file are both unchanged
by the update.
However, Unison will never <em>overwrite</em> such an update with a change
from the other replica, since it always does a safe check for updates
just before propagating a change. Thus, it is reasonable to use this
switch most of the time and occasionally run Unison once with <span style="font-family:monospace">fastcheck</span> set to <code class="verb">no</code>, if you are worried that Unison may have
overlooked an update.</p><p>Fastcheck is (always) automatically disabled for files with extension
<code class="verb">.xls</code> or <code class="verb">.mpp</code>, to prevent Unison from being confused by the
habits of certain programs (Excel, in particular) of updating files without
changing their modification times.</p><!--TOC subsection id="sec62" Mount Points and Removable Media-->
<h3 id="sec62" class="subsection">Mount Points and Removable Media</h3><!--SEC END --><p>Using Unison removable media such as USB drives can be dangerous unless you
are careful. If you synchronize a directory that is stored on removable
media when the media is not present, it will look to Unison as though the
whole directory has been deleted, and it will proceed to delete the
directory from the other replica&#X2014;probably not what you want!</p><p>To prevent accidents, Unison provides a preference called
<code class="verb">mountpoint</code>. Including a line like
</p><pre class="verbatim">             mountpoint = foo
</pre><p>
in your preference file will cause Unison to check, after it finishes
detecting updates, that something actually exists at the path
<code class="verb">foo</code> on both replicas; if it does not, the Unison run will
abort.</p><!--TOC subsection id="sec63" Click-starting Unison-->
<h3 id="sec63" class="subsection">Click-starting Unison</h3><!--SEC END --><p>On Windows NT/2k/XP systems, the graphical version of Unison can be
invoked directly by clicking on its icon. On Windows 95/98 systems,
click-starting also works, <em>as long as you are not using ssh</em>.
Due to an incompatibility with OCaml and Windows 95/98 that is not
under our control, you must start Unison from a DOS window in Windows
95/98 if you want to use ssh.</p><p>When you click on the Unison icon, two windows will be created:
Unison&#X2019;s regular window, plus a console window, which is used only for
giving your password to ssh (if you do not use ssh to connect, you can
ignore this window). When your password is requested, you&#X2019;ll need to
activate the console window (e.g., by clicking in it) before typing.
If you start Unison from a DOS window, Unison&#X2019;s regular window will
appear and you will type your password in the DOS window you were
using.</p><p>To use Unison in this mode, you must first create a profile (see
the <a href="#profile">Profiles</a> section). Use your favorite editor for this.</p><p><hr></p><!--TOC section id="sec64" Ssh-->
<h2 id="sec64" class="section">Ssh</h2><!--SEC END --><p>Your local host will need just an ssh client; the remote host needs an
ssh server (or daemon). ssh is now normal, and Unison thus does not
provide instructions.</p><p><hr></p><!--TOC section id="sec65" Changes in Version 2.51.4-->
<h2 id="sec65" class="section">Changes in Version 2.51.4</h2><!--SEC END --><p>Changes since 2.51.3:
</p><ul class="itemize"><li class="li-itemize">

OCaml 4.12 support
</li><li class="li-itemize">fsmonitor improvements and Solaris support
</li><li class="li-itemize">Color support in text UI, with a new preference, disabled by
NO_COLOR.
</li><li class="li-itemize">Interactive profile selection in text UI, enabled by a new
preference.
</li><li class="li-itemize">Working files are stored in the unison directory (typically
&#X2004;&#X200D;/.unison) rather than $HOME.
</li><li class="li-itemize">Build cleanups, CI improvements, housekeeping
</li><li class="li-itemize">Many bugfixes and minor improvements

</li></ul><p>Changes since 2.51.2:
</p><ul class="itemize"><li class="li-itemize">

Some nontrivial changes to profile parsing (G.raud Meyer)
<ul class="itemize"><li class="li-itemize">
&#X2019;=&#X2019; has been considered whitespace until now: several
following chars are considered as only one; trailing chars are
discarded; any non empty sequence of char is splitting. This is non
standard and leads to confusion, for example -ignore== &#X2019;Name .*=*&#X2019;
is valid when -ignore=&#X2019;Name .*=*&#X2019; is not, and worse -ignore=&#X2019;Name
*=&#X2019; is the same as -ignore=&#X2019;Name *&#X2019;. The parser now takes just a
single &#X2019;=&#X2019; as delimiter after the option name. Other = characters
are considered as part of the value being assigned to the option.
</li></ul>
</li><li class="li-itemize">Numerous improvements to the text user-interface (G.raud Meyer)
<ul class="itemize"><li class="li-itemize">
New key-commands that restrict the display to a set of
"matching" items: ones that are offering to propagate changes in a
particular direction, conflicts, files to be merged, etc., plus
several more useful key-commands. Type "?" to Unison to see all
available commands.
</li></ul>

</li></ul><p>Changes since 2.48:
</p><ul class="itemize"><li class="li-itemize">

Repository transplanted from SVN to Git and moved to GitHub (<a href="https://github.com/bcpierce00/unison">)</a>.
</li><li class="li-itemize">Add a new preference, &#X2019;<span style="font-family:monospace">atomic</span>&#X2019;, for specifying directories that
should be treated atomically: if there are changes within such a
directory in both replicase, the whole directory is marked as a
conflict instead of propagating any of the changes. Thanks to
Julian Squires for submitting this patch!
</li><li class="li-itemize">OSX / macOS
<ul class="itemize"><li class="li-itemize">
Ported to 10.13, High Sierra, and Apple&#X2019;s new APFS (earlier
versions of Unison break because of new behavior of AppleDouble files)
</li><li class="li-itemize">Replaced Growl with OS X native notification center.
</li></ul>
</li><li class="li-itemize">Miscellaneous:
<ul class="itemize"><li class="li-itemize">
The OCaml compiler version is now included in the &#X201C;connection header
&#X2014; the string that&#X2019;s printed when connecting to a remote server &#X2014; to
facilitate debugging version mismatch issues. 
</li><li class="li-itemize">Compatible with OCaml 4.06.
</li><li class="li-itemize">Added a DockerFile for the convenience of Docker users.
</li><li class="li-itemize">Many small bugfixes and UI improvements.
</li></ul>

</li></ul><p>Changes since 2.45:
</p><ul class="itemize"><li class="li-itemize">

Incorporated a patch from Christopher Zimmermann to replace the
Uprintf module (which doesn&#X2019;t work with OCaml 4.02, causing Unison to crash) with equivalent
functionality from the standard library.
</li><li class="li-itemize">Incorporated a refresh of the OSX GUI, contributed by Alan Shutko.
</li><li class="li-itemize">Added a <span style="font-family:monospace">maxsizethreshold</span> option, which prevents the transfer of
files larger than the size specified (in Kb).
</li><li class="li-itemize">Added a "copyonconflict" preference, to make a copy of files that would
otherwise be overwritten or deleted in case of conflicting changes.
(This makes it possible to automatically resolve conflicts in a
fairly safe way when synchronizing continuously, in combination
with the "<span style="font-family:monospace">repeat = watch</span>" and "<span style="font-family:monospace">prefer = newer</span>" preferences.
</li><li class="li-itemize">File system monitoring:
<ul class="itemize"><li class="li-itemize">
The file watcher now fails when unable to
watch a directory, rather than silently ignoring the issue.
</li><li class="li-itemize">File system monitoring: more robust communication with the helper program
(in socket mode, the unison server will still work properly despite
unexpected unison client disconnections).
</li><li class="li-itemize">A bytecode version of unison-fsmonitor is now produced by "make NATIVE=false"
</li><li class="li-itemize">Improved search for unison-fsmonitor
</li><li class="li-itemize">Detect when the helper process exits.
</li><li class="li-itemize">More robust file watching helper programs for Windows and Linux.
They communicate with Unison through pipes (Unison redirects stdin
and stdout), using a race-free protocol.
</li><li class="li-itemize">Retries paths with failures using an exponential backoff algorithm.
</li><li class="li-itemize">The information returned by the file watchers are used
independently for each replica; thus, when only one replica has
changes, Unison will only rescan this replica.
</li><li class="li-itemize">When available, used by the graphical UIs to speed up rescanning
(can be disabled by setting the new <span style="font-family:monospace">watch</span> preference to
</li><li class="li-itemize">Small fix to the way fsmonitor.py gets invoked when using the file
watching functionality, suggested by Josh Berdine. Unison will now
look for <span style="font-family:monospace">fsmonitor.py</span> in the same directory where the Unison
executable itself lives.
</li></ul>
</li><li class="li-itemize">Minor:
<ul class="itemize"><li class="li-itemize">
Fixed a bug in export procedure that was messing up documentation
strings.
</li><li class="li-itemize">Incorporated a patch from Ir&#XE1;nyossy Knoblauch Art&#XFA;r to make temp file
names fit within 143 characters (to make eCryptFS happy).
</li><li class="li-itemize">Added a string to the Conflict direction to document the reason of
the conflict.
</li><li class="li-itemize">Log conflicts and problems in the text UI even if nothing is propagated.
</li><li class="li-itemize">Use hash function from OCaml 3.x for comparing archives, even when
compiled with OCaml 4.x.
</li><li class="li-itemize">Do not restart Unison in case of uncaught exception when the repeat
preference is set. This seems safer. And it does not work, for
instance, in case of lost connection.
</li><li class="li-itemize">Fix Unix.readlink invalid argument error under Windows
</li><li class="li-itemize">Fix a crash when the output of the <span style="font-family:monospace">diff</span> program is too large.
</li><li class="li-itemize">Fixed Makefile for cross-compiling towards Windows (updated to MinGW-w64)
</li></ul>

</li></ul><p>Changes since 2.40.63:
</p><ul class="itemize"><li class="li-itemize">

New preference <span style="font-family:monospace">fastercheckUNSAFE</span>, which can be used (with care!)
to achieve <em>much</em> faster update detection when all the common files in
the two replicas are known to be identical. See the manual for more
information.<p>This feature should still be considered experimental, but it&#X2019;s ready for
other people to try out.
</p></li><li class="li-itemize">Added option <span style="font-family:monospace">clientHostName</span>. If specified, it will be used to as
the client host name, overriding <span style="font-family:monospace">UNISONLOCALHOSTNAME</span> and the actual
host name.
</li><li class="li-itemize">OS X GUI:
<ul class="itemize"><li class="li-itemize">
fix crash under Lion, because of problems with the toolbar, using the
fix suggested in <span style="font-family:monospace">http://blitzbasic.com/Community/posts.php?topic=95778</span>.</li><li class="li-itemize">uimacnew09 is now the standard graphical interface on OSX
</li><li class="li-itemize">A small improvement to the uimacnew09 interface from Alan Schmitt
and Steve Kalkwarf: when Unison is run with the -batch flag, the
interface will now automatically propagate changes and terminate,
without waiting for user interaction.
</li><li class="li-itemize">Show a modal warning window if there is no archive for the hosts. The
user can then choose to exit or proceed (proceed is the default). The window
is not shown if the <span style="font-family:monospace">batch</span> preference is true.
</li><li class="li-itemize">file details panel selectable
</li></ul>
</li><li class="li-itemize">GTK GUI:
<ul class="itemize"><li class="li-itemize">
New version of uigtk2.ml from Matt Zagrabelny that reorganizes the
icons in a slightly more intuitive way.
</li></ul>
</li><li class="li-itemize">Minor fixes:
<ul class="itemize"><li class="li-itemize">
Setting the <span style="font-family:monospace">prefer</span> preference to <span style="font-family:monospace">older</span> or <span style="font-family:monospace">newer</span> now
propagates deletions when there is no conflict.
</li><li class="li-itemize">Correctly quote the path when running merge commands.
</li><li class="li-itemize">Add quotes to paths when calling external file watcher utility.
</li><li class="li-itemize">Incorporate a patch to fsmonitor.py (the external filewatcher
utility) from Tomasz Zernicki to make it work better under Windows.
</li><li class="li-itemize">Incorporated new version of fsmonitor.py from Christophe Gohle
</li><li class="li-itemize">Fixed incompatibility with OpenSSH 5.6.
</li><li class="li-itemize">Fixed fingerprint cache: do not cache file properties
</li><li class="li-itemize">Some spelling corrections in documentation and comments from Stephane
Glondu
</li><li class="li-itemize">Fixed <span style="font-family:monospace">O_APPEND</span> mode for open under Windows
</li><li class="li-itemize">Fixed String.sub invalid argument error when an AppleDouble file does
not contain a finder information field
</li><li class="li-itemize">Trim duplicate paths when using "-repeat watch"
</li><li class="li-itemize">Unison now passes path arguments and &#X2013;follow directives to
fsmonitor.py. This seems to work except for one small issue with
how fsmonitor.py treats <span style="font-family:monospace">-follow</span> directives for directories that
don&#X2019;t exist (or maybe this is an issue with how it treats any kind
of monitoring when the thing being monitored doesn&#X2019;t exist?). If we
create a symlink to a nonexistent directory, give Unison (hence
fsmonitor.py) a &#X2019;follow&#X2019; directive for the symlink, start unison, and
<em>then</em> create the directory, fsmonitor.py misses the change.
</li><li class="li-itemize">Lines added in profile files by unison always start at a new line
</li></ul>

</li></ul><p>Changes since 2.40.1:
</p><ul class="itemize"><li class="li-itemize">

Added "BelowPath" patterns, that match a path as well as all paths below
(convenient to use with nodeletion,update,creationpartial preferences)
</li><li class="li-itemize">Added a "fat" preference that makes Unison use the right options
when one of the replica is on a FAT filesystem.
</li><li class="li-itemize">Allow "prefer/force=newer" even when not synchronizing modification
times. (The reconciler will not be aware of the modification time
of unchanged files, so the synchronization choices of Unison can be
different from when "times=true", but the behavior remains sane:
changed files with the most recent modification time will be
propagated.)
</li><li class="li-itemize">Minor fixes and improvements:
<ul class="itemize"><li class="li-itemize">
Compare filenames up to decomposition in case sensitive mode when
one host is running MacOSX and the unicode preference is set to
true.
</li><li class="li-itemize">Rsync: somewhat faster compressor
</li><li class="li-itemize">Make Unicode the default on all architectures (it was only the
default when a Mac OS X or Windows machine was involved).
</li></ul>

</li></ul><p>Changes since 2.32:
</p><ul class="itemize"><li class="li-itemize">

Major enhancement: Unicode support.
<ul class="itemize"><li class="li-itemize">
Unison should now handle unicode filenames correctly on all platforms.
</li><li class="li-itemize">This functionality is controlled by a new preference <span style="font-family:monospace">unicode</span>.
</li><li class="li-itemize">Unicode mode is now the default when one of the hosts is under
Windows or MacOS. This may make upgrades a bit more painful (the
archives cannot be reused), but this is a much saner default.
</li></ul>
</li><li class="li-itemize">Partial transfer of directories. If an error occurs while
transferring a directory, the part transferred so far is copied into
place (and the archives are updated accordingly).
The "maxerrors" preference controls how many transfer error Unison
will accept before stopping the transfer of a directory (by default,
only one). This makes it possible to transfer most of a directory
even if there are some errors. Currently, only the first error is
reported by the GUIs.<p>Also, allow partial transfer of a directory when there was an error deep
inside this directory during update detection. At the moment, this
is only activated with the text and GTK UIs, which have been
modified so that they show that the transfer is going to be partial
and so that they can display all errors.
</p></li><li class="li-itemize">Improvement to the code for resuming directory transfers:
<ul class="itemize"><li class="li-itemize">
if a file was not correctly transferred (or the source has been
modified since, with unchanged size), Unison performs a new
transfer rather than failing
</li><li class="li-itemize">spurious files are deleted (this can happen if a file is deleted
on the source replica before resuming the transfer; not deleting
the file would result in it reappearing on the target replica)
</li></ul>
</li><li class="li-itemize">Experimental streaming protocol for transferring file contents (can
be disabled by setting the directive "stream" to false): file
contents is transferred asynchronously (without waiting for a response
from the destination after each chunk sent) rather than using the
synchronous RPC mechanism. As a consequence:
<ul class="itemize"><li class="li-itemize">
Unison now transfers the contents of a single file at a time
(Unison used to transfer several contents simultaneously in order
to hide the connection latency.)
</li><li class="li-itemize">the transfer of large files uses the full available bandwidth
and is not slowed done due to the connection latency anymore
</li><li class="li-itemize">we get performance improvement for small files as well by
scheduling many files simultaneously (as scheduling a file for
transfer consume little resource: it does not mean allocating a
large buffer anymore)
</li></ul>
</li><li class="li-itemize">Changes to the internal implementation of the rsync algorithm:
<ul class="itemize"><li class="li-itemize">
use longer blocks for large files (the size of a block is the
square root of the size of the file for large files);
</li><li class="li-itemize">transmit less checksum information per block (we still have less
than one chance in a hundred million of transferring a file
incorrectly, and Unison will catch any transfer error when
fingerprinting the whole file)
</li><li class="li-itemize">avoid transfer overhead (which was 4 bytes per block)
</li></ul>
For a 1G file, the first optimization saves a factor 50 on the
amount of data transferred from the target to the source (blocks
are 32768 bytes rather than just 700 bytes). The two other
optimizations save another factor of 2 (from 24 bytes per block
down to 10).
</li><li class="li-itemize">Implemented an on-disk file fingerprint cache to speed-up update
detection after a crash: this way, Unison does not have do recompute
all the file fingerprints from scratch.
<ul class="itemize"><li class="li-itemize">
When Unison detects that the archive case-sensitivity mode
does not match the current settings, it populates the fingerprint
cache using the archive contents. This way, changing the
case-sensitivity mode should be reasonably fast.
</li></ul>
</li><li class="li-itemize">New preferences "noupdate=root", "nodeletion=root", "nocreation=root"
that prevent Unison from performing files updates, deletions or
creations on the given root. Also &#X2019;partial&#X2019; versions of &#X2019;noupdate&#X2019;,
&#X2019;nodeletion&#X2019; and &#X2019;nocreation&#X2019;
</li><li class="li-itemize">Limit the number of simultaneous external copy program
("copymax" preference)
</li><li class="li-itemize">New "links" preference. When set to false, Unison will report an
error on symlinks during update detection. (This is the default
when one host is running Windows but not Cygwin.) This is better
than failing during propagation.
</li><li class="li-itemize">Added a preference "halfduplex" to force half-duplex communication
with the server. This may be useful on unreliable links (as a more
efficient alternative to "maxthreads = 1").
</li><li class="li-itemize">Renamed preference "pretendwin" to "ignoreinodenumbers" (an alias is
kept for backwards compatibility).
</li><li class="li-itemize">Ignore one-second differences when synchronizing modification time.
(Technically, this is an incompatible archive format change, but it
is backward compatible. To trigger a problem, a user would have to
synchronize modification times on a filesystem with a two-second
granularity and then downgrade to a previous version of Unison,
which does not work well in such a case. Thus, it does not
seem worthwhile to increment the archive format number, which would
impact all users.)
</li><li class="li-itemize">Do not keep many files simultaneously opened anymore when the rsync
algorithm is in use.
</li><li class="li-itemize">Add &#X201C;ignorearchives&#X201D; preference to ignore existing archives (to
avoid forcing users to delete them manually, in situations where one
archive has gotten deleted or corrupted).
</li><li class="li-itemize">Mac OS
<ul class="itemize"><li class="li-itemize">
fixed rsync bug which could result in an "index out of bounds"
error when transferring resource forks.
</li><li class="li-itemize">Fixed bug which made Unison ignore finder information and resource
fork when compiled to 64bit on Mac OSX.
</li><li class="li-itemize">should now be 64 bit clean (the Growl framework is not up to date,
though)
</li><li class="li-itemize">Made the bridge between Objective C and Ocaml code GC friendly
(it was allocating ML values and putting them in an array which
was not registered with the GC)
</li><li class="li-itemize">use darker grey arrows (patch contributed by Eric Y. Kow)
</li></ul>
</li><li class="li-itemize">GTK user interface
<ul class="itemize"><li class="li-itemize">
assistant for creating profiles
</li><li class="li-itemize">profile editor
</li><li class="li-itemize">pop up a summary window when the replicas are not fully
synchronized after transport
</li><li class="li-itemize">display estimated remaining time and transfer rate on the
progress bar
</li><li class="li-itemize">allow simultaneous selection of several items
</li><li class="li-itemize">Do not reload the preference file before a new update
detection if it is unchanged
</li><li class="li-itemize">disabled scrolling to the first unfinished item during transport.
It goes way too fast when lot of small files are synchronized, and it
makes it impossible to browse the file list during transport.
</li><li class="li-itemize">take into account the "height" preference again
</li><li class="li-itemize">the internal list of selected reconciler item was not always in
sync with what was displayed (GTK bug?); workaround implemented
</li><li class="li-itemize">Do not display "Looking for change" messages during propagation
(when checking the targe is unchanged) but only during update detection
</li><li class="li-itemize">Apply patch to fix some crashes in the OSX GUI, thanks to Onne Gorter.
</li></ul>
</li><li class="li-itemize">Text UI
<ul class="itemize"><li class="li-itemize">
During update detection, display status by updating a single line
rather than generating a new line of output every so often. Should be less
confusing.
</li></ul>
</li><li class="li-itemize">Windows
<ul class="itemize"><li class="li-itemize">
Fastcheck is now the default under Windows. People mostly use NTFS
nowadays and the Unicode API provides an equivalent to inode numbers
for this filesystem.
</li><li class="li-itemize">Only use long UNC path for accessing replicas (as &#X2019;..&#X2019; is
not handled with this format of paths, but can be useful)
</li><li class="li-itemize">Windows text UI: now put the console into UTF-8 output mode. This
is the right thing to do when in Unicode mode, and is no worse than
what we had previously otherwise (the console use some esoteric
encoding by default). This only works when using a Unicode font
instead of the default raster font.
</li><li class="li-itemize">Don&#X2019;t get the home directory from environment variable HOME under
Windows (except for Cygwin binaries): we don&#X2019;t want the behavior of
Unison to depends on whether it is run from a Cygwin shell (where
HOME is set) or in any other way (where HOME is usually not set).
</li></ul>
</li><li class="li-itemize">Miscellaneous fixes and improvements
<ul class="itemize"><li class="li-itemize">
Made a server waiting on a socket more resilient to unexpected
lost connections from the client.
</li><li class="li-itemize">Small patch to property setting code suggested by Ulrich Gernkow.
</li><li class="li-itemize">Several fixes to the change transfer functions (both the internal ones
and external transfers using rsync). In particular, limit the number of
simultaneous transfer using an rsync
(as the rsync algorithm can use a large amount of memory when
processing huge files)
</li><li class="li-itemize">Keep track of which file contents are being transferred, and delay
the transfer of a file when another file with the same contents is
currently being transferred. This way, the second transfer can be
skipped and replaced by a local copy.
</li><li class="li-itemize">Experimental update detection optimization:
do not read the contents of unchanged directories
</li><li class="li-itemize">When a file transfer fails, turn off fastcheck for this file on the
next sync.
</li><li class="li-itemize">Fixed bug with case insensitive mode on a case sensitive filesystem:
<ul class="itemize"><li class="li-itemize">
if file "a/a" is created on one replica and directory "A" is
created on the other, the file failed to be synchronized the first
time Unison is run afterwards, as Unison uses the wrong path "a/a"
(if Unison is run again, the directories are in the archive, so
the right path is used);
</li><li class="li-itemize">if file "a" appears on one replica and file "A" appears on the
other with different contents, Unison was unable to synchronize
them.
</li></ul>
</li><li class="li-itemize">Improved error reporting when the destination is updated during
synchronization: Unison now tells which file has been updated, and how.
</li><li class="li-itemize">Limit the length of temporary file names
</li><li class="li-itemize">Case sensitivity information put in the archive (in a backward
compatible way) and checked when the archive is loaded
</li><li class="li-itemize">Got rid of the 16mb marshalling limit by marshalling to a bigarray.
</li><li class="li-itemize">Resume copy of partially transferred files.
</li></ul>

</li></ul><p>Changes since 2.31:
</p><ul class="itemize"><li class="li-itemize">

Small user interface changes
<ul class="itemize"><li class="li-itemize">
Small change to text UI "scanning..." messages, to print just
directories (hopefully making it clearer that individual files are
not necessarily being fingerprinted).
</li></ul>
</li><li class="li-itemize">Minor fixes and improvements:
<ul class="itemize"><li class="li-itemize">
Ignore one hour differences when deciding whether a file may have
been updated. This avoids slow update detection after daylight
saving time changes under Windows. This makes Unison slightly more
likely to miss an update, but it should be safe enough.
</li><li class="li-itemize">Fix a small bug that was affecting mainly windows users. We need to
commit the archives at the end of the sync even if there are no
updates to propagate because some files (in fact, if we&#X2019;ve just
switched to DST on windows, a LOT of files) might have new modtimes
in the archive. (Changed the text UI only. It&#X2019;s less clear where
to change the GUI.)
</li><li class="li-itemize">Don&#X2019;t delete the temp file when a transfer fails due to a
fingerprint mismatch (so that we can have a look and see why!) We&#X2019;ve also
added more debugging code togive more informative error messages when we
encounter the dreaded and longstanding "assert failed during file
transfer" bug
</li><li class="li-itemize">Incorrect paths ("path" directive) now result in an error update
item rather than a fatal error.
</li><li class="li-itemize">Create parent directories (with correct permissions) during
transport for paths which point to non-existent locations in the
destination replica.
</li></ul>

</li></ul><p>Changes since 2.27:
</p><ul class="itemize"><li class="li-itemize">

If Unison is interrupted during a directory transfer, it will now
leave the partially transferred directory intact in a temporary
location. (This maintains the invariant that new files/directories are
transferred either completely or not at all.) The next time Unison is run,
it will continue filling in this temporary directory, skipping transferring
files that it finds are already there.
</li><li class="li-itemize">We&#X2019;ve added experimental support for invoking an external file
transfer tool for whole-file copies instead of Unison&#X2019;s built-in transfer
protocol. Three new preferences have been added:
<ul class="itemize"><li class="li-itemize">
<span style="font-family:monospace">copyprog</span> is a string giving the name (and command-line
switches, if needed) of an external program that can be used to copy large
files efficiently. By default, rsync is invoked, but other tools such as
scp can be used instead by changing the value of this preference. (Although
this is not its primary purpose, rsync is actually a pretty fast way of
copying files that don&#X2019;t already exist on the receiving host.) For files
that do already exist on (but that have been changed in one replica), Unison
will always use its built-in implementation of the rsync algorithm.
</li><li class="li-itemize">Added a "copyprogrest" preference, so that we can give different
command lines for invoking the external copy utility depending on whether a
partially transferred file already exists or not. (Rsync doesn&#X2019;t seem to
care about this, but other utilities may.)
</li><li class="li-itemize"><span style="font-family:monospace">copythreshold</span> is an integer (-1 by default), indicating above what
filesize (in megabytes) Unison should use the external copying utility
specified by copyprog. Specifying 0 will cause ALL copies to use the
external program; a negative number will prevent any files from using it.
(Default is -1.)
</li></ul>
Thanks to Alan Schmitt for a huge amount of hacking and to an anonymous
sponsor for suggesting and underwriting this extension.
</li><li class="li-itemize">Small improvements:
<ul class="itemize"><li class="li-itemize">
Added a new preference, <span style="font-family:monospace">dontchmod</span>. By default, Unison uses the
<span style="font-family:monospace">chmod</span> system call to set the permission bits of files after it has
copied them. But in some circumstances (and under some operating systems),
the chmod call always fails. Setting this preference completely prevents
Unison from ever calling <span style="font-family:monospace">chmod</span>.
</li><li class="li-itemize">Don&#X2019;t ignore files that look like backup files if the <span style="font-family:monospace">backuplocation</span> preference is set to <span style="font-family:monospace">central</span>
</li><li class="li-itemize">Shortened the names of several preferences. The old names are also
still supported, for backwards compatibility, but they do not appear in the
documentation.
</li><li class="li-itemize">Lots of little documentation tidying. (In particular, preferences are
separated into Basic and Advanced! This should hopefully make Unison a
little more approachable for new users.
</li><li class="li-itemize">Unison can sometimes fail to transfer a file, giving the unhelpful
message "Destination updated during synchronization" even though the file
has not been changed. This can be caused by programs that change either the
file&#X2019;s contents <em>or</em> the file&#X2019;s extended attributes without changing
its modification time. It&#X2019;s not clear what is the best fix for this &#X2013; it
is not Unison&#X2019;s fault, but it makes Unison&#X2019;s behavior puzzling &#X2013; but at
least Unison can be more helpful about suggesting a workaround (running once
with <span style="font-family:monospace">fastcheck</span> set to false). The failure message has been changed to
give this advice.
</li><li class="li-itemize">Further improvements to the OS X GUI (thanks to Alan Schmitt and Craig
Federighi).
</li></ul>
</li><li class="li-itemize">Very preliminary support for triggering Unison from an external
filesystem-watching utility. The current implementation is very
simple, not efficient, and almost completely untested&#X2014;not ready
for real users. But if someone wants to help improve it (e.g.,
by writing a filesystem watcher for your favorite OS), please make
yourself known!<p>On the Unison side, the new behavior is very simple:
</p><ul class="itemize"><li class="li-itemize">
use the text UI
</li><li class="li-itemize">start Unison with the command-line flag "-repeat FOO",
where FOO is name of a file where Unison should look
for notifications of changes
</li><li class="li-itemize">when it starts up, Unison will read the whole contents
of this file (on both hosts), which should be a
newline-separated list of paths (relative to the root
of the synchronization) and synchronize just these paths,
as if it had been started with the "-path=xxx" option for
each one of them
</li><li class="li-itemize">when it finishes, it will sleep for a few seconds and then
examine the watchfile again; if anything has been added, it
will read the new paths, synchronize them, and go back to
sleep
</li><li class="li-itemize">that&#X2019;s it!
</li></ul><p>
To use this to drive Unison "incrementally," just start it in
this mode and start up a tool (on each host) to watch for
new changes to the filesystem and append the appropriate paths
to the watchfile. Hopefully such tools should not be too hard
to write.
</p></li><li class="li-itemize">Bug fixes:
<ul class="itemize"><li class="li-itemize">
Fixed a bug that was causing new files to be created with
permissions 0x600 instead of using a reasonable default (like
0x644), if the &#X2019;perms&#X2019; flag was set to 0. (Bug reported by Ben
Crowell.)
</li><li class="li-itemize">Follow maxthreads preference when transferring directories.
</li></ul>

</li></ul><p>Changes since 2.17:
</p><ul class="itemize"><li class="li-itemize">

Major rewrite and cleanup of the whole Mac OS X graphical user
interface by Craig Federighi. Thanks, Craig!!!
</li><li class="li-itemize">Small fix to ctime (non-)handling in update detection under windows
with fastcheck.
</li><li class="li-itemize">Several small fixes to the GTK2 UI to make it work better under
Windows [thanks to Karl M for these].
</li><li class="li-itemize">The backup functionality has been completely rewritten. The external
interface has not changed, but numerous bugs, irregular behaviors, and
cross-platform inconsistencies have been corrected.
</li><li class="li-itemize">The Unison project now accepts donations via PayPal. If you&#X2019;d like to
donate, you can find a link to the donation page on the
<a href="http://www.cis.upenn.edu/&#X2004;&#X200D;bcpierce/unison/lists.html">Unison home
page</a>.
</li><li class="li-itemize">Some important safety improvements:
<ul class="itemize"><li class="li-itemize">
Added a new <code class="verb">mountpoint</code> preference, which can be used to specify
a path that must exist in both replicas at the end of update detection
(otherwise Unison aborts). This can be used to avoid potentially dangerous
situations when Unison is used with removable media such as external hard
drives and compact flash cards.
</li><li class="li-itemize">The confirmation of &#X201C;big deletes&#X201D; is now controlled by a boolean preference
<code class="verb">confirmbigdeletes</code>. Default is true, which gives the same behavior as
previously. (This functionality is at least partly superseded by the
<code class="verb">mountpoint</code> preference, but it has been left in place in case it is
useful to some people.)
</li><li class="li-itemize">If Unison is asked to &#X201C;follow&#X201D; a symbolic link but there is
nothing at the other end of the link, it will now flag this path as an
error, rather than treating the symlink itself as missing or deleted.
This avoids a potentially dangerous situation where a followed symlink
points to an external filesystem that might be offline when Unison is run
(whereupon Unison would cheerfully delete the corresponding files in the
other replica!).
</li></ul></li><li class="li-itemize">Smaller changes:
<ul class="itemize"><li class="li-itemize">
Added <code class="verb">forcepartial</code> and <code class="verb">preferpartial</code> preferences, which
behave like <code class="verb">force</code> and <code class="verb">prefer</code> but can be specified on a
per-path basis. [Thanks to Alan Schmitt for this.]
</li><li class="li-itemize">A bare-bones self test feature was added, which runs unison through
some of its paces and checks that the results are as expected. The
coverage of the tests is still very limited, but the facility has already
been very useful in debugging the new backup functionality (especially in
exposing some subtle cross-platform issues).
</li><li class="li-itemize">Refined debugging code so that the verbosity of individual modules
can be controlled separately. Instead of just putting &#X2019;-debug
verbose&#X2019; on the command line, you can put &#X2019;-debug update+&#X2019;, which
causes all the extra messages in the Update module, but not other
modules, to be printed. Putting &#X2019;-debug verbose&#X2019; causes all modules
to print with maximum verbosity.
</li><li class="li-itemize">Removed <code class="verb">mergebatch</code> preference. (It never seemed very useful, and
its semantics were confusing.)
</li><li class="li-itemize">Rewrote some of the merging functionality, for better cooperation
with external Harmony instances.
</li><li class="li-itemize">Changed the temp file prefix from <code class="verb">.#</code> to <code class="verb">.unison</code>.
</li><li class="li-itemize">Compressed the output from the text user interface (particularly
when run with the <code class="verb">-terse</code> flag) to make it easier to interpret the
results when Unison is run several times in succession from a script.
</li><li class="li-itemize">Diff and merge functions now work under Windows.
</li><li class="li-itemize">Changed the order of arguments to the default diff command (so that
the + and - annotations in diff&#X2019;s output are reversed).
</li><li class="li-itemize">Added <code class="verb">.mpp</code> files to the &#X201C;never fastcheck&#X201D; list (like
<code class="verb">.xls</code> files).
</li></ul></li><li class="li-itemize">Many small bugfixes, including:
<ul class="itemize"><li class="li-itemize">
Fixed a longstanding bug regarding fastcheck and daylight saving time
under Windows when Unison is set up to synchronize modification times.
(Modification times cannot be updated in the archive in this case,
so we have to ignore one hour differences.)
</li><li class="li-itemize">Fixed a bug that would occasionally cause the archives to be left in
non-identical states on the two hosts after synchronization.
</li><li class="li-itemize">Fixed a bug that prevented Unison from communicating correctly between
32- and 64-bit architectures.
</li><li class="li-itemize">On windows, file creation times are no longer used as a proxy for
inode numbers. (This is unfortunate, as it makes fastcheck a little less
safe. But it turns out that file creation times are not reliable
under Windows: if a file is removed and a new file is created in its
place, the new one will sometimes be given the same creation date as the
old one!)
</li><li class="li-itemize">Set read-only file to R/W on OSX before attempting to change other attributes.
</li><li class="li-itemize">Fixed bug resulting in spurious "Aborted" errors during transport
(thanks to Jerome Vouillon)
</li><li class="li-itemize">Enable diff if file contents have changed in one replica, but
only properties in the other.
</li><li class="li-itemize">Removed misleading documentation for &#X2019;repeat&#X2019; preference.
</li><li class="li-itemize">Fixed a bug in merging code where Unison could sometimes deadlock
with the external merge program, if the latter produced large
amounts of output.
</li><li class="li-itemize">Workaround for a bug compiling gtk2 user interface against current versions
of gtk2+ libraries.
</li><li class="li-itemize">Added a better error message for "ambiguous paths".
</li><li class="li-itemize">Squashed a longstanding bug that would cause file transfer to fail
with the message &#X201C;Failed: Error in readWrite: Is a directory.&#X201D;
</li><li class="li-itemize">Replaced symlinks with copies of their targets in the Growl framework in src/uimac.
This should make the sources easier to check out from the svn repository on WinXP
systems.
</li><li class="li-itemize">Added a workaround (suggested by Karl M.) for the problem discussed
on the unison users mailing list where, on the Windows platform, the
server would hang when transferring files. I conjecture that
the problem has to do with the RPC mechanism, which was used to
make a call <em>back</em> from the server to the client (inside the Trace.log
function) so that the log message would be appended to the log file on
the client. The workaround is to dump these messages (about when
xferbycopying shortcuts are applied and whether they succeed) just to the
standard output of the Unison process, not to the log file.
</li></ul>

</li></ul><p>Changes since 2.13.0:
</p><ul class="itemize"><li class="li-itemize">

The features for performing backups and for invoking external merge
programs have been completely rewritten by Stephane Lescuyer (thanks,
Stephane!). The user-visible functionality should not change, but the
internals have been rationalized and there are a number of new features.
See the manual (in particular, the description of the <code class="verb">backupXXX</code>
preferences) for details.
</li><li class="li-itemize">Incorporated patches for ipv6 support, contributed by Samuel Thibault.
(Note that, due to a bug in the released OCaml 3.08.3 compiler, this code
will not actually work with ipv6 unless compiled with the CVS version of the
OCaml compiler, where the bug has been fixed; however, ipv4 should continue
to work normally.)
</li><li class="li-itemize">OSX interface:
<ul class="itemize"><li class="li-itemize">
Incorporated Ben Willmore&#X2019;s cool new icon for the Mac UI.
</li></ul>
</li><li class="li-itemize">Small fixes:
<ul class="itemize"><li class="li-itemize">
Fixed off by one error in month numbers (in printed dates) reported
by Bob Burger
</li></ul>

</li></ul><p>Changes since 2.12.0:
</p><ul class="itemize"><li class="li-itemize">

New convention for release numbering: Releases will continue to be
given numbers of the form <code class="verb">X.Y.Z</code>, but,
from now on, just the major version number (<code class="verb">X.Y</code>) will be considered
significant when checking compatibility between client and server versions.
The third component of the version number will be used only to identify
&#X201C;patch levels&#X201D; of releases.<p>This change goes hand in hand with a change to the procedure for making new
releases. Candidate releases will initially be given &#X201C;beta release&#X201D;
status when they are announced for public consumption. Any bugs that are
discovered will be fixed in a separate branch of the source repository
(without changing the major version number) and new tarballs re-released as
needed. When this process converges, the patched beta version will be
dubbed stable.
</p></li><li class="li-itemize">Warning (failure in batch mode) when one path is completely emptied.
This prevents Unison from deleting everything on one replica when
the other disappear.
</li><li class="li-itemize">Fix diff bug (where no difference is shown the first time the diff
command is given).
</li><li class="li-itemize">User interface changes:
<ul class="itemize"><li class="li-itemize">
Improved workaround for button focus problem (GTK2 UI)
</li><li class="li-itemize">Put leading zeroes in date fields
</li><li class="li-itemize">More robust handling of character encodings in GTK2 UI
</li><li class="li-itemize">Changed format of modification time displays, from <code class="verb">modified at hh:mm:ss on dd MMM, yyyy</code>
to <code class="verb">modified on yyyy-mm-dd hh:mm:ss</code>
</li><li class="li-itemize">Changed time display to include seconds (so that people on FAT
filesystems will not be confused when Unison tries to update a file
time to an odd number of seconds and the filesystem truncates it to
an even number!)
</li><li class="li-itemize">Use the diff "-u" option by default when showing differences between files
(the output is more readable)
</li><li class="li-itemize">In text mode, pipe the diff output to a pager if the environment
variable PAGER is set
</li><li class="li-itemize">Bug fixes and cleanups in ssh password prompting. Now works with
the GTK2 UI under Linux. (Hopefully the Mac OS X one is not broken!)
</li><li class="li-itemize">Include profile name in the GTK2 window name
</li><li class="li-itemize">Added bindings &#X2019;,&#X2019; (same as &#X2019;&lt;&#X2019;) and &#X2019;.&#X2019; (same as &#X2019;&gt;&#X2019;) in the GTK2 UI
</li></ul>
</li><li class="li-itemize">Mac GUI:
<ul class="itemize"><li class="li-itemize">
actions like &lt; and &gt; scroll to the next item as necessary.
</li><li class="li-itemize">Restart has a menu item and keyboard shortcut (command-R).
</li><li class="li-itemize">Added a command-line tool for Mac OS X. It can be installed from
the Unison menu.
</li><li class="li-itemize">New icon.
</li><li class="li-itemize">Handle the "help" command-line argument properly.
</li><li class="li-itemize">Handle profiles given on the command line properly.
</li><li class="li-itemize">When a profile has been selected, the profile dialog is replaced by a
"connecting" message while the connection is being made. This
gives better feedback.
</li><li class="li-itemize">Size of left and right columns is now large enough so that
"PropsChanged" is not cut off.
</li></ul>
</li><li class="li-itemize">Minor changes:
<ul class="itemize"><li class="li-itemize">
Disable multi-threading when both roots are local
</li><li class="li-itemize">Improved error handling code. In particular, make sure all files
are closed in case of a transient failure
</li><li class="li-itemize">Under Windows, use <code class="verb">$UNISON</code> for home directory as a last resort
(it was wrongly moved before <code class="verb">$HOME</code> and <code class="verb">$USERPROFILE</code> in
Unison 2.12.0)
</li><li class="li-itemize">Reopen the logfile if its name changes (profile change)
</li><li class="li-itemize">Double-check that permissions and modification times have been
properly set: there are some combination of OS and filesystem on
which setting them can fail in a silent way.
</li><li class="li-itemize">Check for bad Windows filenames for pure Windows synchronization
also (not just cross architecture synchronization).
This way, filenames containing backslashes, which are not correctly
handled by unison, are rejected right away.
</li><li class="li-itemize">Attempt to resolve issues with synchronizing modification times
of read-only files under Windows
</li><li class="li-itemize">Ignore chmod failures when deleting files
</li><li class="li-itemize">Ignore trailing dots in filenames in case insensitive mode
</li><li class="li-itemize">Proper quoting of paths, files and extensions ignored using the UI
</li><li class="li-itemize">The strings CURRENT1 and CURRENT2 are now correctly substitued when
they occur in the diff preference
</li><li class="li-itemize">Improvements to syncing resource forks between Macs via a non-Mac system.
</li></ul>

</li></ul><p>Changes since 2.10.2:
</p><ul class="itemize"><li class="li-itemize">

<span style="font-weight:bold">Incompatible change:</span>
 Archive format has changed.
</li><li class="li-itemize">Source code availability: The Unison sources are now managed using
Subversion. One nice side-effect is that anonymous checkout is now
possible, like this:
<pre class="verbatim">        svn co https://cvs.cis.upenn.edu:3690/svnroot/unison/
</pre>
We will also continue to export a &#X201C;developer tarball&#X201D; of the current
(modulo one day) sources in the web export directory. To receive commit logs
for changes to the sources, subscribe to the <code class="verb">unison-hackers</code> list
(<a href="http://www.cis.upenn.edu/&#X2004;&#X200D;bcpierce/unison/lists.html"><span style="font-family:monospace">http://www.cis.upenn.edu/&#X2004;&#X200D;bcpierce/unison/lists.html</span></a>).
</li><li class="li-itemize">Text user interface:
<ul class="itemize"><li class="li-itemize">
Substantial reworking of the internal logic of the text UI to make it
a bit easier to modify.
</li><li class="li-itemize">The <span style="font-family:monospace">dumbtty</span> flag in the text UI is automatically set to true if
the client is running on a Unix system and the <span style="font-family:monospace">EMACS</span> environment
variable is set to anything other than the empty string.
</li></ul>
</li><li class="li-itemize">Native OS X gui:
<ul class="itemize"><li class="li-itemize">
Added a synchronize menu item with keyboard shortcut
</li><li class="li-itemize">Added a merge menu item, still needs to be debugged
</li><li class="li-itemize">Fixes to compile for Panther
</li><li class="li-itemize">Miscellaneous improvements and bugfixes
</li></ul>
</li><li class="li-itemize">Small changes:
<ul class="itemize"><li class="li-itemize">
Changed the filename checking code to apply to Windows only, instead
of OS X as well.
</li><li class="li-itemize">Finder flags now synchronized
</li><li class="li-itemize">Fallback in copy.ml for filesystem that do not support <code class="verb">O_EXCL</code>
</li><li class="li-itemize">Changed buffer size for local file copy (was highly inefficient with
synchronous writes)
</li><li class="li-itemize">Ignore chmod failure when deleting a directory
</li><li class="li-itemize">Fixed assertion failure when resolving a conflict content change /
permission changes in favor of the content change.
</li><li class="li-itemize">Workaround for transferring large files using rsync.
</li><li class="li-itemize">Use buffered I/O for files (this is the only way to open files in binary
mode under Cygwin).
</li><li class="li-itemize">On non-Cygwin Windows systems, the UNISON environment variable is now checked first to determine
where to look for Unison&#X2019;s archive and preference files, followed by <code class="verb">HOME</code> and
<code class="verb">USERPROFILE</code> in that order. On Unix and Cygwin systems, <code class="verb">HOME</code> is used.
</li><li class="li-itemize">Generalized <code class="verb">diff</code> preference so that it can be given either as just
the command name to be used for calculating diffs or else a whole command
line, containing the strings <code class="verb">CURRENT1</code> and <code class="verb">CURRENT2</code>, which will be replaced
by the names of the files to be diff&#X2019;ed before the command is called.
</li><li class="li-itemize">Recognize password prompts in some newer versions of ssh.
</li></ul>

</li></ul><p>Changes since 2.9.20:
</p><ul class="itemize"><li class="li-itemize">

<span style="font-weight:bold">Incompatible change:</span>
 Archive format has changed.
</li><li class="li-itemize">Major functionality changes:
<ul class="itemize"><li class="li-itemize">
Major tidying and enhancement of &#X2019;merge&#X2019; functionality. The main
user-visible change is that the external merge program may either write
the merged output to a single new file, as before, or it may modify one or
both of its input files, or it may write <em>two</em> new files. In the
latter cases, its modifications will be copied back into place on both the
local and the remote host, and (if the two files are now equal) the
archive will be updated appropriately. More information can be found in
the user manual. Thanks to Malo Denielou and Alan Schmitt for these
improvements.<p>Warning: the new merging functionality is not completely compatible with
old versions! Check the manual for details.
</p></li><li class="li-itemize">Files larger than 2Gb are now supported.
</li><li class="li-itemize">Added preliminary (and still somewhat experimental) support for the
Apple OS X operating system.
<ul class="itemize"><li class="li-itemize">
Resource forks should be transferred correctly. (See the manual for
details of how this works when synchronizing HFS with non-HFS volumes.)
Synchronization of file type and creator information is also supported.
</li><li class="li-itemize">On OSX systems, the name of the directory for storing Unison&#X2019;s
archives, preference files, etc., is now determined as follows:
<ul class="itemize"><li class="li-itemize">
if <code class="verb">~/.unison</code> exists, use it
</li><li class="li-itemize">otherwise, use <code class="verb">~/Library/Application Support/Unison</code>,
creating it if necessary.
</li></ul>
</li><li class="li-itemize">A preliminary native-Cocoa user interface is under construction. This
still needs some work, and some users experience unpredictable crashes, so
it is only for hackers for now. Run make with <span style="font-family:monospace">UISTYLE=mac</span> to build
this interface.
</li></ul>
</li></ul></li><li class="li-itemize">Minor functionality changes:
<ul class="itemize"><li class="li-itemize">
Added an <span style="font-family:monospace">ignorelocks</span> preference, which forces Unison to override left-over
archive locks. (Setting this preference is dangerous! Use it only if you
are positive you know what you are doing.)
</li><li class="li-itemize">Added a new preference <span style="font-family:monospace">assumeContentsAreImmutable</span>. If a directory
matches one of the patterns set in this preference, then update detection
is skipped for files in this directory. (The
purpose is to speed update detection for cases like Mail folders, which
contain lots and lots of immutable files.) Also a preference
<span style="font-family:monospace">assumeContentsAreImmutableNot</span>, which overrides the first, similarly
to <span style="font-family:monospace">ignorenot</span>. (Later amendment: these preferences are now called
<span style="font-family:monospace">immutable</span> and <span style="font-family:monospace">immutablenot</span>.)
</li><li class="li-itemize">The <span style="font-family:monospace">ignorecase</span> flag has been changed from a boolean to a three-valued
preference. The default setting, called <span style="font-family:monospace">default</span>, checks the operating systems
running on the client and server and ignores filename case if either of them is
OSX or Windows. Setting ignorecase to <span style="font-family:monospace">true</span> or <span style="font-family:monospace">false</span> overrides
this behavior. If you have been setting <span style="font-family:monospace">ignorecase</span> on the command
line using <span style="font-family:monospace">-ignorecase=true</span> or <span style="font-family:monospace">-ignorecase=false</span>, you will
need to change to <span style="font-family:monospace">-ignorecase true</span> or <span style="font-family:monospace">-ignorecase false</span>.
</li><li class="li-itemize">a new preference, &#X2019;repeat&#X2019;, for the text user interface (only). If &#X2019;repeat&#X2019; is set to
a number, then, after it finishes synchronizing, Unison will wait for that many seconds and
then start over, continuing this way until it is killed from outside. Setting repeat to true
will automatically set the batch preference to true.
</li><li class="li-itemize">Excel files are now handled specially, so that the <span style="font-family:monospace">fastcheck</span>
optimization is skipped even if the <span style="font-family:monospace">fastcheck</span> flag is set. (Excel
does some naughty things with modtimes, making this optimization
unreliable and leading to failures during change propagation.)
</li><li class="li-itemize">The ignorecase flag has been changed from a boolean to a three-valued
preference. The default setting, called &#X2019;default&#X2019;, checks the operating systems
running on the client and server and ignores filename case if either of them is
OSX or Windows. Setting ignorecase to &#X2019;true&#X2019; or &#X2019;false&#X2019; overrides this behavior.
</li><li class="li-itemize">Added a new preference, &#X2019;repeat&#X2019;, for the text user interface (only,
at the moment). If &#X2019;repeat&#X2019; is set to a number, then, after it finishes
synchronizing, Unison will wait for that many seconds and then start over,
continuing this way until it is killed from outside. Setting repeat to
true will automatically set the batch preference to true.
</li><li class="li-itemize">The &#X2019;rshargs&#X2019; preference has been split into &#X2019;rshargs&#X2019; and &#X2019;sshargs&#X2019;
(mainly to make the documentation clearer). In fact, &#X2019;rshargs&#X2019; is no longer
mentioned in the documentation at all, since pretty much everybody uses
ssh now anyway.
</li></ul>
</li><li class="li-itemize">Documentation
<ul class="itemize"><li class="li-itemize">
The web pages have been completely redesigned and reorganized.
(Thanks to Alan Schmitt for help with this.)
</li></ul>
</li><li class="li-itemize">User interface improvements
<ul class="itemize"><li class="li-itemize">
Added a GTK2 user interface, capable (among other things) of displaying filenames
in any locale encoding. Kudos to Stephen Tse for contributing this code!
</li><li class="li-itemize">The text UI now prints a list of failed and skipped transfers at the end of
synchronization.
</li><li class="li-itemize">Restarting update detection from the graphical UI will reload the current
profile (which in particular will reset the -path preference, in case
it has been narrowed by using the &#X201C;Recheck unsynchronized items&#X201D;
command).
</li><li class="li-itemize">Several small improvements to the text user interface, including a
progress display.
</li></ul>
</li><li class="li-itemize">Bug fixes (too numerous to count, actually, but here are some):
<ul class="itemize"><li class="li-itemize">
The <span style="font-family:monospace">maxthreads</span> preference works now.
</li><li class="li-itemize">Fixed bug where warning message about uname returning an unrecognized
result was preventing connection to server. (The warning is no longer
printed, and all systems where &#X2019;uname&#X2019; returns anything other than &#X2019;Darwin&#X2019;
are assumed not to be running OS X.)
</li><li class="li-itemize">Fixed a problem on OS X that caused some valid file names (e.g.,
those including colons) to be considered invalid.
</li><li class="li-itemize">Patched Path.followLink to follow links under cygwin in addition to Unix
(suggested by Matt Swift).
</li><li class="li-itemize">Small change to the storeRootsName function, suggested by bliviero at
ichips.intel.com, to fix a problem in unison with the &#X2018;rootalias&#X2019;
option, which allows you to tell unison that two roots contain the same
files. Rootalias was being applied after the hosts were
sorted, so it wouldn&#X2019;t work properly in all cases.
</li><li class="li-itemize">Incorporated a fix by Dmitry Bely for setting utimes of read-only files
on Win32 systems.
</li></ul>
</li><li class="li-itemize">Installation / portability:
<ul class="itemize"><li class="li-itemize">
Unison now compiles with OCaml version 3.07 and later out of the box.
</li><li class="li-itemize">Makefile.OCaml fixed to compile out of the box under OpenBSD.
</li><li class="li-itemize">a few additional ports (e.g. OpenBSD, Zaurus/IPAQ) are now mentioned in
the documentation
</li><li class="li-itemize">Unison can now be installed easily on OSX systems using the Fink
package manager
</li></ul>

</li></ul><p>Changes since 2.9.1:
</p><ul class="itemize"><li class="li-itemize">

Added a preference <span style="font-family:monospace">maxthreads</span> that can be used to limit the
number of simultaneous file transfers.
</li><li class="li-itemize">Added a <span style="font-family:monospace">backupdir</span> preference, which controls where backup
files are stored.
</li><li class="li-itemize">Basic support added for OSX. In particular, Unison now recognizes
when one of the hosts being synchronized is running OSX and switches to
a case-insensitive treatment of filenames (i.e., &#X2019;foo&#X2019; and &#X2019;FOO&#X2019; are
considered to be the same file).
(OSX is not yet fully working,
however: in particular, files with resource forks will not be
synchronized correctly.)
</li><li class="li-itemize">The same hash used to form the archive name is now also added to
the names of the temp files created during file transfer. The reason for
this is that, during update detection, we are going to silently delete
any old temp files that we find along the way, and we want to prevent
ourselves from deleting temp files belonging to other instances of Unison
that may be running in parallel, e.g. synchronizing with a different
host. Thanks to Ruslan Ermilov for this suggestion.
</li><li class="li-itemize">Several small user interface improvements
</li><li class="li-itemize">Documentation
<ul class="itemize"><li class="li-itemize">
FAQ and bug reporting instructions have been split out as separate
HTML pages, accessible directly from the unison web page.
</li><li class="li-itemize">Additions to FAQ, in particular suggestions about performance
tuning.
</li></ul>
</li><li class="li-itemize">Makefile
<ul class="itemize"><li class="li-itemize">
Makefile.OCaml now sets UISTYLE=text or UISTYLE=gtk automatically,
depending on whether it finds lablgtk installed
</li><li class="li-itemize">Unison should now compile &#X201C;out of the box&#X201D; under OSX
</li></ul>

</li></ul><p>Changes since 2.8.1:
</p><ul class="itemize"><li class="li-itemize">

Changing profile works again under Windows
</li><li class="li-itemize">File movement optimization: Unison now tries to use local copy instead of
transfer for moved or copied files. It is controlled by a boolean option
&#X201C;xferbycopying&#X201D;.
</li><li class="li-itemize">Network statistics window (transfer rate, amount of data transferred).
[NB: not available in Windows-Cygwin version.]
</li><li class="li-itemize">symlinks work under the cygwin version (which is dynamically linked).
</li><li class="li-itemize">Fixed potential deadlock when synchronizing between Windows and
Unix
</li><li class="li-itemize">Small improvements:
<ul class="itemize"><li class="li-itemize">
If neither the <span style="font-family:monospace">USERPROFILE</span> nor the <span style="font-family:monospace">HOME</span> environment
variables are set, then Unison will put its temporary commit log
(called <span style="font-family:monospace">DANGER.README</span>) into the directory named by the
<span style="font-family:monospace">UNISON</span> environment variable, if any; otherwise it will use
<span style="font-family:monospace">C:</span>.
</li><li class="li-itemize">alternative set of values for fastcheck: yes = true; no = false;
default = auto.
</li><li class="li-itemize">-silent implies -contactquietly
</li></ul>
</li><li class="li-itemize">Source code:
<ul class="itemize"><li class="li-itemize">
Code reorganization and tidying. (Started breaking up some of the
basic utility modules so that the non-unison-specific stuff can be
made available for other projects.)
</li><li class="li-itemize">several Makefile and docs changes (for release);
</li><li class="li-itemize">further comments in &#X201C;update.ml&#X201D;;
</li><li class="li-itemize">connection information is not stored in global variables anymore.
</li></ul>

</li></ul><p>Changes since 2.7.78:
</p><ul class="itemize"><li class="li-itemize">

Small bugfix to textual user interface under Unix (to avoid leaving
the terminal in a bad state where it would not echo inputs after Unison
exited).

</li></ul><p>Changes since 2.7.39:
</p><ul class="itemize"><li class="li-itemize">

Improvements to the main web page (stable and beta version docs are
now both accessible).
</li><li class="li-itemize">User manual revised.
</li><li class="li-itemize">Added some new preferences:
<ul class="itemize"><li class="li-itemize">
&#X201C;sshcmd&#X201D; and &#X201C;rshcmd&#X201D; for specifying paths to ssh and rsh programs.
</li><li class="li-itemize">&#X201C;contactquietly&#X201D; for suppressing the &#X201C;contacting server&#X201D; message
during Unison startup (under the graphical UI).
</li></ul>
</li><li class="li-itemize">Bug fixes:
<ul class="itemize"><li class="li-itemize">
Fixed small bug in UI that neglected to change the displayed column
headers if loading a new profile caused the roots to change.
</li><li class="li-itemize">Fixed a bug that would put the text UI into an infinite loop if it
encountered a conflict when run in batch mode.
</li><li class="li-itemize">Added some code to try to fix the display of non-Ascii characters in
filenames on Windows systems in the GTK UI. (This code is currently
untested&#X2014;if you&#X2019;re one of the people that had reported problems with
display of non-ascii filenames, we&#X2019;d appreciate knowing if this actually
fixes things.)
</li><li class="li-itemize">&#X2018;<code class="verb">-prefer/-force newer</code>&#X2019; works properly now.
(The bug was reported by Sebastian Urbaniak and Sean Fulton.)
</li></ul>
</li><li class="li-itemize">User interface and Unison behavior:
<ul class="itemize"><li class="li-itemize">
Renamed &#X2018;Proceed&#X2019; to &#X2018;Go&#X2019; in the graphical UI.
</li><li class="li-itemize">Added exit status for the textual user interface.
</li><li class="li-itemize">Paths that are not synchronized because of conflicts or errors during
update detection are now noted in the log file.
</li><li class="li-itemize"><code class="verb">[END]</code> messages in log now use a briefer format
</li><li class="li-itemize">Changed the text UI startup sequence so that
<span style="font-family:monospace">./unison -ui text</span> will use the default profile instead of failing.
</li><li class="li-itemize">Made some improvements to the error messages.
</li><li class="li-itemize">Added some debugging messages to remote.ml.
</li></ul>

</li></ul><p>Changes since 2.7.7:
</p><ul class="itemize"><li class="li-itemize">

Incorporated, once again, a multi-threaded transport sub-system.
It transfers several files at the same time, thereby making much
more effective use of available network bandwidth. Unlike the
earlier attempt, this time we do not rely on the native thread
library of OCaml. Instead, we implement a light-weight,
non-preemptive multi-thread library in OCaml directly. This version
appears stable.<p>Some adjustments to unison are made to accommodate the multi-threaded
version. These include, in particular, changes to the
user interface and logging, for example:
</p><ul class="itemize"><li class="li-itemize">
Two log entries for each transferring task, one for the
beginning, one for the end.
</li><li class="li-itemize">Suppressed warning messages against removing temp files left
by a previous unison run, because warning does not work nicely
under multi-threading. The temp file names are made less likely
to coincide with the name of a file created by the user. They
take the form <br>
<code class="verb">.#&lt;filename&gt;.&lt;serial&gt;.unison.tmp</code>.
[N.b. This was later changed to <code class="verb">.unison.&lt;filename&gt;.&lt;serial&gt;.unison.tmp</code>.]
</li></ul></li><li class="li-itemize">Added a new command to the GTK user interface: pressing &#X2019;f&#X2019; causes
Unison to start a new update detection phase, using as paths <em>just</em>
those paths that have been detected as changed and not yet marked as
successfully completed. Use this command to quickly restart Unison on
just the set of paths still needing attention after a previous run.
</li><li class="li-itemize">Made the <span style="font-family:monospace">ignorecase</span> preference user-visible, and changed the
initialization code so that it can be manually set to true, even if
neither host is running Windows. (This may be useful, e.g., when using
Unison running on a Unix system with a FAT volume mounted.)
</li><li class="li-itemize">Small improvements and bug fixes:
<ul class="itemize"><li class="li-itemize">
Errors in preference files now generate fatal errors rather than
warnings at startup time. (I.e., you can&#X2019;t go on from them.) Also,
we fixed a bug that was preventing these warnings from appearing in the
text UI, so some users who have been running (unsuspectingly) with
garbage in their prefs files may now get error reports.
</li><li class="li-itemize">Error reporting for preference files now provides file name and
line number.
</li><li class="li-itemize">More intelligible message in the case of identical change to the same
files: &#X201C;Nothing to do: replicas have been changed only in identical
ways since last sync.&#X201D;
</li><li class="li-itemize">Files with prefix &#X2019;.#&#X2019; excluded when scanning for preference
files.
</li><li class="li-itemize">Rsync instructions are send directly instead of first
marshaled.
</li><li class="li-itemize">Won&#X2019;t try forever to get the fingerprint of a continuously changing file:
unison will give up after certain number of retries.
</li><li class="li-itemize">Other bug fixes, including the one reported by Peter Selinger
(<code class="verb">force=older preference</code> not working).
</li></ul>
</li><li class="li-itemize">Compilation:
<ul class="itemize"><li class="li-itemize">
Upgraded to the new OCaml 3.04 compiler, with the LablGtk
1.2.3 library (patched version used for compiling under Windows).
</li><li class="li-itemize">Added the option to compile unison on the Windows platform with
Cygwin GNU C compiler. This option only supports building
dynamically linked unison executables.
</li></ul>

</li></ul><p>Changes since 2.7.4:
</p><ul class="itemize"><li class="li-itemize">

Fixed a silly (but debilitating) bug in the client startup sequence.

</li></ul><p>Changes since 2.7.1:
</p><ul class="itemize"><li class="li-itemize">

Added <code class="verb">addprefsto</code> preference, which (when set) controls which
preference file new preferences (e.g. new ignore patterns) are added to.
</li><li class="li-itemize">Bug fix: read the initial connection header one byte at a time, so
that we don&#X2019;t block if the header is shorter than expected. (This bug
did not affect normal operation &#X2014; it just made it hard to tell when you
were trying to use Unison incorrectly with an old version of the server,
since it would hang instead of giving an error message.)

</li></ul><p>Changes since 2.6.59:
</p><ul class="itemize"><li class="li-itemize">

Changed <code class="verb">fastcheck</code> from a boolean to a string preference. Its
legal values are <code class="verb">yes</code> (for a fast check), <code class="verb">no</code> (for a safe
check), or <code class="verb">default</code> (for a fast check&#X2014;which also happens to be
safe&#X2014;when running on Unix and a safe check when on Windows). The default
is <code class="verb">default</code>.
</li><li class="li-itemize">Several preferences have been renamed for consistency. All
preference names are now spelled out in lowercase. For backward
compatibility, the old names still work, but they are not mentioned in
the manual any more.
</li><li class="li-itemize">The temp files created by the &#X2019;diff&#X2019; and &#X2019;merge&#X2019; commands are now
named by <em>pre</em>pending a new prefix to the file name, rather than
appending a suffix. This should avoid confusing diff/merge programs
that depend on the suffix to guess the type of the file contents.
</li><li class="li-itemize">We now set the keepalive option on the server socket, to make sure
that the server times out if the communication link is unexpectedly broken.
</li><li class="li-itemize">Bug fixes:
<ul class="itemize"><li class="li-itemize">
When updating small files, Unison now closes the destination file.
</li><li class="li-itemize">File permissions are properly updated when the file is behind a
followed link.
</li><li class="li-itemize">Several other small fixes.
</li></ul>

</li></ul><p>Changes since 2.6.38:
</p><ul class="itemize"><li class="li-itemize">

Major Windows performance improvement!<p>We&#X2019;ve added a preference <code class="verb">fastcheck</code> that makes Unison look only at
a file&#X2019;s creation time and last-modified time to check whether it has
changed. This should result in a huge speedup when checking for updates
in large replicas.</p><p>When this switch is set, Unison will use file creation times as
&#X2019;pseudo inode numbers&#X2019; when scanning Windows replicas for updates,
instead of reading the full contents of every file. This may cause
Unison to miss propagating an update if the create time,
modification time, and length of the file are all unchanged by
the update (this is not easy to achieve, but it can be done).
However, Unison will never <em>overwrite</em> such an update with
a change from the other replica, since it
always does a safe check for updates just before propagating a
change. Thus, it is reasonable to use this switch most of the time
and occasionally run Unison once with <span style="font-family:monospace">fastcheck</span> set to false,
if you are worried that Unison may have overlooked an update.</p><p>Warning: This change is has not yet been thoroughly field-tested. If you
set the <code class="verb">fastcheck</code> preference, pay careful attention to what
Unison is doing.</p></li><li class="li-itemize">New functionality: centralized backups and merging
<ul class="itemize"><li class="li-itemize">
This version incorporates two pieces of major new functionality,
implemented by Sylvain Roy during a summer internship at Penn: a
<em>centralized backup</em> facility that keeps a full backup of
(selected files
in) each replica, and a <em>merging</em> feature that allows Unison to
invoke an external file-merging tool to resolve conflicting changes to
individual files.</li><li class="li-itemize">Centralized backups:
<ul class="itemize"><li class="li-itemize">
Unison now maintains full backups of the last-synchronized versions
of (some of) the files in each replica; these function both as
backups in the usual sense
and as the &#X201C;common version&#X201D; when invoking external
merge programs.
</li><li class="li-itemize">The backed up files are stored in a directory &#X2004;&#X200D;/.unison/backup on each
host. (The name of this directory can be changed by setting
the environment variable <code class="verb">UNISONBACKUPDIR</code>.)
</li><li class="li-itemize">The predicate <code class="verb">backup</code> controls which files are actually
backed up:
giving the preference &#X2019;<code class="verb">backup = Path *</code>&#X2019; causes backing up
of all files.
</li><li class="li-itemize">Files are added to the backup directory whenever unison updates
its archive. This means that
<ul class="itemize"><li class="li-itemize">
When unison reconstructs its archive from scratch (e.g.,
because of an upgrade, or because the archive files have
been manually deleted), all files will be backed up.
</li><li class="li-itemize">Otherwise, each file will be backed up the first time unison
propagates an update for it.
</li></ul>
</li><li class="li-itemize">The preference <code class="verb">backupversions</code> controls how many previous
versions of each file are kept. The default is 2 (i.e., the last
synchronized version plus one backup).
</li><li class="li-itemize">For backward compatibility, the <code class="verb">backups</code> preference is also
still supported, but <code class="verb">backup</code> is now preferred.
</li><li class="li-itemize">It is OK to manually delete files from the backup directory (or to throw
away the directory itself). Before unison uses any of these files for
anything important, it checks that its fingerprint matches the one
that it expects.
</li></ul></li><li class="li-itemize">Merging:
<ul class="itemize"><li class="li-itemize">
Both user interfaces offer a new &#X2019;merge&#X2019; command, invoked by pressing
&#X2019;m&#X2019; (with a changed file selected).
</li><li class="li-itemize">The actual merging is performed by an external program.
The preferences <code class="verb">merge</code> and <code class="verb">merge2</code> control how this
program is invoked. If a backup exists for this file (see the
<code class="verb">backup</code> preference), then the <code class="verb">merge</code> preference is used for
this purpose; otherwise <code class="verb">merge2</code> is used. In both cases, the
value of the preference should be a string representing the command
that should be passed to a shell to invoke the
merge program. Within this string, the special substrings
<code class="verb">CURRENT1</code>, <code class="verb">CURRENT2</code>, <code class="verb">NEW</code>, and <code class="verb">OLD</code> may appear
at any point. Unison will substitute these as follows before invoking
the command:
<ul class="itemize"><li class="li-itemize">
<code class="verb">CURRENT1</code> is replaced by the name of the local
copy of the file;
</li><li class="li-itemize"><code class="verb">CURRENT2</code> is replaced by the name of a temporary
file, into which the contents of the remote copy of the file have
been transferred by Unison prior to performing the merge;
</li><li class="li-itemize"><code class="verb">NEW</code> is replaced by the name of a temporary
file that Unison expects to be written by the merge program when
it finishes, giving the desired new contents of the file; and
</li><li class="li-itemize"><code class="verb">OLD</code> is replaced by the name of the backed up
copy of the original version of the file (i.e., its state at the
end of the last successful run of Unison), if one exists
(applies only to <code class="verb">merge</code>, not <code class="verb">merge2</code>).
</li></ul>
For example, on Unix systems setting the <code class="verb">merge</code> preference to
<pre class="verbatim">   merge = diff3 -m CURRENT1 OLD CURRENT2 &gt; NEW
</pre>
will tell Unison to use the external <code class="verb">diff3</code> program for merging.<p>A large number of external merging programs are available. For
example, <code class="verb">emacs</code> users may find the following convenient:
</p><pre class="verbatim">    merge2 = emacs -q --eval '(ediff-merge-files "CURRENT1" "CURRENT2"
               nil "NEW")'
    merge = emacs -q --eval '(ediff-merge-files-with-ancestor
               "CURRENT1" "CURRENT2" "OLD" nil "NEW")'
</pre><p>
(These commands are displayed here on two lines to avoid running off the
edge of the page. In your preference file, each should be written on a
single line.)</p></li><li class="li-itemize">If the external program exits without leaving any file at the
path <code class="verb">NEW</code>,
Unison considers the merge to have failed. If the merge program writes
a file called <code class="verb">NEW</code> but exits with a non-zero status code,
then Unison
considers the merge to have succeeded but to have generated conflicts.
In this case, it attempts to invoke an external editor so that the
user can resolve the conflicts. The value of the <code class="verb">editor</code>
preference controls what editor is invoked by Unison. The default
is <code class="verb">emacs</code>.</li><li class="li-itemize">Please send us suggestions for other useful values of the
<code class="verb">merge2</code> and <code class="verb">merge</code> preferences &#X2013; we&#X2019;d like to give several
examples in the manual.
</li></ul>
</li></ul></li><li class="li-itemize">Smaller changes:
<ul class="itemize"><li class="li-itemize">
When one preference file includes another, unison no longer adds the
suffix &#X2019;<code class="verb">.prf</code>&#X2019; to the included file by default. If a file with
precisely the given name exists in the .unison directory, it will be used;
otherwise Unison will
add <code class="verb">.prf</code>, as it did before. (This change means that included
preference files can be named <code class="verb">blah.include</code> instead of
<code class="verb">blah.prf</code>, so that unison will not offer them in its &#X2019;choose
a preference file&#X2019; dialog.)
</li><li class="li-itemize">For Linux systems, we now offer both a statically linked and a dynamically
linked executable. The static one is larger, but will probably run on more
systems, since it doesn&#X2019;t depend on the same versions of dynamically
linked library modules being available.
</li><li class="li-itemize">Fixed the <code class="verb">force</code> and <code class="verb">prefer</code> preferences, which were
getting the propagation direction exactly backwards.
</li><li class="li-itemize">Fixed a bug in the startup code that would cause unison to crash
when the default profile (<code class="verb">~/.unison/default.prf</code>) does not exist.
</li><li class="li-itemize">Fixed a bug where, on the run when a profile is first created,
Unison would confusingly display the roots in reverse order in the user
interface.
</li></ul></li><li class="li-itemize">For developers:
<ul class="itemize"><li class="li-itemize">
We&#X2019;ve added a module dependency diagram to the source distribution, in
<code class="verb">src/DEPENDENCIES.ps</code>, to help new prospective developers with
navigating the code.
</li></ul>

</li></ul><p>Changes since 2.6.11:
</p><ul class="itemize"><li class="li-itemize">

<span style="font-weight:bold">Incompatible change:</span>
 Archive format has changed.</li><li class="li-itemize"><span style="font-weight:bold">Incompatible change:</span>
 The startup sequence has been completely rewritten
and greatly simplified. The main user-visible change is that the
<code class="verb">defaultpath</code> preference has been removed. Its effect can be
approximated by using multiple profiles, with <code class="verb">include</code> directives
to incorporate common settings. All uses of <code class="verb">defaultpath</code> in
existing profiles should be changed to <code class="verb">path</code>.<p>Another change in startup behavior that will affect some users is that it
is no longer possible to specify roots <em>both</em> in the profile <em>and</em> on the command line.</p><p>You can achieve a similar effect, though, by breaking your profile into
two:
</p><pre class="verbatim">
  default.prf =
      root = blah
      root = foo
      include common

  common.prf =
      &lt;everything else&gt;
</pre><p>
Now do
</p><pre class="verbatim">  unison common root1 root2
</pre><p>
when you want to specify roots explicitly.</p></li><li class="li-itemize">The <code class="verb">-prefer</code> and <code class="verb">-force</code> options have been extended to
allow users to specify that files with more recent modtimes should be
propagated, writing either <code class="verb">-prefer newer</code> or <code class="verb">-force newer</code>.
(For symmetry, Unison will also accept <code class="verb">-prefer older</code> or
<code class="verb">-force older</code>.) The <code class="verb">-force older/newer</code> options can only be
used when <code class="verb">-times</code> is also set.<p>The graphical user interface provides access to these facilities on a
one-off basis via the <code class="verb">Actions</code> menu.</p></li><li class="li-itemize">Names of roots can now be &#X201C;aliased&#X201D; to allow replicas to be
relocated without changing the name of the archive file where Unison
stores information between runs. (This feature is for experts only. See
the &#X201C;Archive Files&#X201D; section of the manual for more information.)</li><li class="li-itemize">Graphical user-interface:
<ul class="itemize"><li class="li-itemize">
A new command is provided in the Synchronization menu for
switching to a new profile without restarting Unison from scratch.
</li><li class="li-itemize">The GUI also supports one-key shortcuts for commonly
used profiles. If a profile contains a preference of the form
&#X2019;<code class="verb">key = n</code>&#X2019;, where <code class="verb">n</code> is a single digit, then pressing this
key will cause Unison to immediately switch to this profile and begin
synchronization again from scratch. (Any actions that may have been
selected for a set of changes currently being displayed will be
discarded.)</li><li class="li-itemize">Each profile may include a preference &#X2019;<code class="verb">label = &lt;string&gt;</code>&#X2019; giving a
descriptive string that described the options selected in this profile.
The string is listed along with the profile name in the profile selection
dialog, and displayed in the top-right corner of the main Unison window.
</li></ul></li><li class="li-itemize">Minor:
<ul class="itemize"><li class="li-itemize">
Fixed a bug that would sometimes cause the &#X2019;diff&#X2019; display to order
the files backwards relative to the main user interface. (Thanks
to Pascal Brisset for this fix.)
</li><li class="li-itemize">On Unix systems, the graphical version of Unison will check the
<code class="verb">DISPLAY</code> variable and, if it is not set, automatically fall back
to the textual user interface.
</li><li class="li-itemize">Synchronization paths (<code class="verb">path</code> preferences) are now matched
against the ignore preferences. So if a path is both specified in a
<code class="verb">path</code> preference and ignored, it will be skipped.
</li><li class="li-itemize">Numerous other bugfixes and small improvements.
</li></ul>

</li></ul><p>Changes since 2.6.1:
</p><ul class="itemize"><li class="li-itemize">

The synchronization of modification times has been disabled for
directories.</li><li class="li-itemize">Preference files may now include lines of the form
<code class="verb">include &lt;name&gt;</code>, which will cause <code class="verb">name.prf</code> to be read
at that point.</li><li class="li-itemize">The synchronization of permission between Windows and Unix now
works properly.</li><li class="li-itemize">A binding <code class="verb">CYGWIN=binmode</code> in now added to the environment
so that the Cygwin port of OpenSSH works properly in a non-Cygwin
context.</li><li class="li-itemize">The <code class="verb">servercmd</code> and <code class="verb">addversionno</code> preferences can now
be used together: <code class="verb">-addversionno</code> appends an appropriate
<code class="verb">-NNN</code> to the server command, which is found by using the value
of the <code class="verb">-servercmd</code> preference if there is one, or else just
<code class="verb">unison</code>.</li><li class="li-itemize">Both <code class="verb">'-pref=val'</code> and <code class="verb">'-pref val'</code> are now allowed for
boolean values. (The former can be used to set a preference to false.)</li><li class="li-itemize">Lot of small bugs fixed.

</li></ul><p>Changes since 2.5.31:
</p><ul class="itemize"><li class="li-itemize">

The <code class="verb">log</code> preference is now set to <code class="verb">true</code> by default,
since the log file seems useful for most users.
</li><li class="li-itemize">Several miscellaneous bugfixes (most involving symlinks).

</li></ul><p>Changes since 2.5.25:
</p><ul class="itemize"><li class="li-itemize">

<span style="font-weight:bold">Incompatible change:</span>
 Archive format has changed (again).</li><li class="li-itemize">Several significant bugs introduced in 2.5.25 have been fixed.

</li></ul><p>Changes since 2.5.1:
</p><ul class="itemize"><li class="li-itemize">

<span style="font-weight:bold">Incompatible change:</span>
 Archive format has changed. Make sure you
synchronize your replicas before upgrading, to avoid spurious
conflicts. The first sync after upgrading will be slow.</li><li class="li-itemize">New functionality:
<ul class="itemize"><li class="li-itemize">
Unison now synchronizes file modtimes, user-ids, and group-ids.<p>These new features are controlled by a set of new preferences, all of
which are currently <code class="verb">false</code> by default.</p><ul class="itemize"><li class="li-itemize">
When the <code class="verb">times</code> preference is set to <code class="verb">true</code>, file
modification times are propaged. (Because the representations of time
may not have the same granularity on both replicas, Unison may not always
be able to make the modtimes precisely equal, but it will get them as
close as the operating systems involved allow.)
</li><li class="li-itemize">When the <code class="verb">owner</code> preference is set to <code class="verb">true</code>, file
ownership information is synchronized.
</li><li class="li-itemize">When the <code class="verb">group</code> preference is set to <code class="verb">true</code>, group
information is synchronized.
</li><li class="li-itemize">When the <code class="verb">numericIds</code> preference is set to <code class="verb">true</code>, owner
and group information is synchronized numerically. By default, owner and
group numbers are converted to names on each replica and these names are
synchronized. (The special user id 0 and the special group 0 are never
mapped via user/group names even if this preference is not set.)
</li></ul></li><li class="li-itemize">Added an integer-valued preference <code class="verb">perms</code> that can be used to
control the propagation of permission bits. The value of this preference
is a mask indicating which permission bits should be synchronized. It is
set by default to 0<span style="font-style:italic">o</span>1777: all bits but the set-uid and set-gid bits are
synchronised (synchronizing theses latter bits can be a security hazard).
If you want to synchronize all bits, you can set the value of this
preference to &#X2212;1.</li><li class="li-itemize">Added a <code class="verb">log</code> preference (default <code class="verb">false</code>), which makes
Unison keep a complete record of the changes it makes to the replicas.
By default, this record is written to a file called <code class="verb">unison.log</code> in
the user&#X2019;s home directory (the value of the <code class="verb">HOME</code> environment
variable). If you want it someplace else, set the <code class="verb">logfile</code>
preference to the full pathname you want Unison to use.</li><li class="li-itemize">Added an <code class="verb">ignorenot</code> preference that maintains a set of patterns
for paths that should definitely <em>not</em> be ignored, whether or not
they match an <code class="verb">ignore</code> pattern. (That is, a path will now be ignored
iff it matches an ignore pattern and does not match any ignorenot patterns.)
</li></ul></li><li class="li-itemize">User-interface improvements:
<ul class="itemize"><li class="li-itemize">
Roots are now displayed in the user interface in the same order
as they were given on the command line or in the preferences file.
</li><li class="li-itemize">When the <code class="verb">batch</code> preference is set, the graphical user interface no
longer waits for user confirmation when it displays a warning message: it
simply pops up an advisory window with a Dismiss button at the bottom and
keeps on going.
</li><li class="li-itemize">Added a new preference for controlling how many status messages are
printed during update detection: <code class="verb">statusdepth</code> controls the maximum
depth for paths on the local machine (longer paths are not displayed, nor
are non-directory paths). The value should be an integer; default is 1.
</li><li class="li-itemize">Removed the <code class="verb">trace</code> and <code class="verb">silent</code> preferences. They did
not seem very useful, and there were too many preferences for controlling
output in various ways.
</li><li class="li-itemize">The text UI now displays just the default command (the one that
will be used if the user just types <code class="verb">&lt;return&gt;</code>) instead of all
available commands. Typing <code class="verb">?</code> will print the full list of
possibilities.
</li><li class="li-itemize">The function that finds the canonical hostname of the local host
(which is used, for example, in calculating the name of the archive file
used to remember which files have been synchronized) normally uses the
<code class="verb">gethostname</code> operating system call. However, if the environment
variable <code class="verb">UNISONLOCALHOSTNAME</code> is set, its value will now be used
instead. This makes it easier to use Unison in situations where a
machine&#X2019;s name changes frequently (e.g., because it is a laptop and gets
moved around a lot).
</li><li class="li-itemize">File owner and group are now displayed in the &#X201C;detail window&#X201D; at
the bottom of the screen, when unison is configured to synchronize them.
</li></ul></li><li class="li-itemize">For hackers:
<ul class="itemize"><li class="li-itemize">
Updated to Jacques Garrigue&#X2019;s new version of <code class="verb">lablgtk</code>, which
means we can throw away our local patched version.<p>If you&#X2019;re compiling the GTK version of unison from sources, you&#X2019;ll need
to update your copy of lablgtk to the developers release.
(Warning: installing lablgtk under Windows is currently a bit
challenging.)</p></li><li class="li-itemize">The TODO.txt file (in the source distribution) has been cleaned up
and reorganized. The list of pending tasks should be much easier to
make sense of, for people that may want to contribute their programming
energies. There is also a separate file BUGS.txt for open bugs.
</li><li class="li-itemize">The Tk user interface has been removed (it was not being maintained
and no longer compiles).
</li><li class="li-itemize">The <code class="verb">debug</code> preference now prints quite a bit of additional
information that should be useful for identifying sources of problems.
</li><li class="li-itemize">The version number of the remote server is now checked right away
during the connection setup handshake, rather than later. (Somebody
sent a bug report of a server crash that turned out to come from using
inconsistent versions: better to check this earlier and in a way that
can&#X2019;t crash either client or server.)
</li><li class="li-itemize">Unison now runs correctly on 64-bit architectures (e.g. Alpha
linux). We will not be distributing binaries for these architectures
ourselves (at least for a while) but if someone would like to make them
available, we&#X2019;ll be glad to provide a link to them.
</li></ul></li><li class="li-itemize">Bug fixes:
<ul class="itemize"><li class="li-itemize">
Pattern matching (e.g. for <code class="verb">ignore</code>) is now case-insensitive
when Unison is in case-insensitive mode (i.e., when one of the replicas
is on a windows machine).
</li><li class="li-itemize">Some people had trouble with mysterious failures during
propagation of updates, where files would be falsely reported as having
changed during synchronization. This should be fixed.
</li><li class="li-itemize">Numerous smaller fixes.
</li></ul>

</li></ul><p>Changes since 2.4.1:
</p><ul class="itemize"><li class="li-itemize">

Added a number of &#X2019;sorting modes&#X2019; for the user interface. By
default, conflicting changes are displayed at the top, and the rest of
the entries are sorted in alphabetical order. This behavior can be
changed in the following ways:
<ul class="itemize"><li class="li-itemize">
Setting the <code class="verb">sortnewfirst</code> preference to <code class="verb">true</code> causes
newly created files to be displayed before changed files.
</li><li class="li-itemize">Setting <code class="verb">sortbysize</code> causes files to be displayed in
increasing order of size.
</li><li class="li-itemize">Giving the preference <code class="verb">sortfirst=&lt;pattern&gt;</code> (where
<code class="verb">&lt;pattern&gt;</code> is a path descriptor in the same format as &#X2019;ignore&#X2019; and &#X2019;follow&#X2019;
patterns, causes paths matching this pattern to be displayed first.
</li><li class="li-itemize">Similarly, giving the preference <code class="verb">sortlast=&lt;pattern&gt;</code>
causes paths matching this pattern to be displayed last.
</li></ul>
The sorting preferences are described in more detail in the user manual.
The <code class="verb">sortnewfirst</code> and <code class="verb">sortbysize</code> flags can also be accessed
from the &#X2019;Sort&#X2019; menu in the grpahical user interface.</li><li class="li-itemize">Added two new preferences that can be used to change unison&#X2019;s
fundamental behavior to make it more like a mirroring tool instead of
a synchronizer.
<ul class="itemize"><li class="li-itemize">
Giving the preference <code class="verb">prefer</code> with argument <code class="verb">&lt;root&gt;</code>
(by adding <code class="verb">-prefer &lt;root&gt;</code> to the command line or <code class="verb">prefer=&lt;root&gt;</code>)
to your profile) means that, if there is a conflict, the contents of
<code class="verb">&lt;root&gt;</code>
should be propagated to the other replica (with no questions asked).
Non-conflicting changes are treated as usual.
</li><li class="li-itemize">Giving the preference <code class="verb">force</code> with argument <code class="verb">&lt;root&gt;</code>
will make unison resolve <em>all</em> differences in favor of the given
root, even if it was the other replica that was changed.
</li></ul>
These options should be used with care! (More information is available in
the manual.)</li><li class="li-itemize">Small changes:
<ul class="itemize"><li class="li-itemize">
Changed default answer to &#X2019;Yes&#X2019; in all two-button dialogs in the
graphical interface (this seems more intuitive).</li><li class="li-itemize">The <code class="verb">rsync</code> preference has been removed (it was used to
activate rsync compression for file transfers, but rsync compression is
now enabled by default).
</li><li class="li-itemize">In the text user interface, the arrows indicating which direction
changes are being
propagated are printed differently when the user has overridden Unison&#X2019;s
default recommendation (<code class="verb">====&gt;</code> instead of <code class="verb">----&gt;</code>). This
matches the behavior of the graphical interface, which displays such
arrows in a different color.
</li><li class="li-itemize">Carriage returns (Control-M&#X2019;s) are ignored at the ends of lines in
profiles, for Windows compatibility.
</li><li class="li-itemize">All preferences are now fully documented in the user manual.
</li></ul>

</li></ul><p>Changes since 2.3.12:
</p><ul class="itemize"><li class="li-itemize">

<span style="font-weight:bold">Incompatible change:</span>
 Archive format has changed. Make sure you
synchronize your replicas before upgrading, to avoid spurious
conflicts. The first sync after upgrading will be slow.</li><li class="li-itemize">New/improved functionality:
<ul class="itemize"><li class="li-itemize">
A new preference -sortbysize controls the order in which changes
are displayed to the user: when it is set to true, the smallest
changed files are displayed first. (The default setting is false.)
</li><li class="li-itemize">A new preference -sortnewfirst causes newly created files to be
listed before other updates in the user interface.
</li><li class="li-itemize">We now allow the ssh protocol to specify a port.
</li><li class="li-itemize">Incompatible change: The unison: protocol is deprecated, and we added
file: and socket:. You may have to modify your profiles in the
.unison directory.
If a replica is specified without an explicit protocol, we now
assume it refers to a file. (Previously "//saul/foo" meant to use
SSH to connect to saul, then access the foo directory. Now it means
to access saul via a remote file mechanism such as samba; the old
effect is now achieved by writing <span style="font-family:monospace">ssh://saul/foo</span>.)
</li><li class="li-itemize">Changed the startup sequence for the case where roots are given but
no profile is given on the command line. The new behavior is to
use the default profile (creating it if it does not exist), and
temporarily override its roots. The manual claimed that this case
would work by reading no profile at all, but AFAIK this was never
true.
</li><li class="li-itemize">In all user interfaces, files with conflicts are always listed first
</li><li class="li-itemize">A new preference &#X2019;sshversion&#X2019; can be used to control which version
of ssh should be used to connect to the server. Legal values are 1 and 2.
(Default is empty, which will make unison use whatever version of ssh
is installed as the default &#X2019;ssh&#X2019; command.)
</li><li class="li-itemize">The situation when the permissions of a file was updated the same on
both side is now handled correctly (we used to report a spurious conflict)</li></ul></li><li class="li-itemize">Improvements for the Windows version:
<ul class="itemize"><li class="li-itemize">
The fact that filenames are treated case-insensitively under
Windows should now be handled correctly. The exact behavior is described
in the cross-platform section of the manual.
</li><li class="li-itemize">It should be possible to synchronize with Windows shares, e.g.,
//host/drive/path.
</li><li class="li-itemize">Workarounds to the bug in syncing root directories in Windows.
The most difficult thing to fix is an ocaml bug: Unix.opendir fails on
c: in some versions of Windows.
</li></ul></li><li class="li-itemize">Improvements to the GTK user interface (the Tk interface is no
longer being maintained):
<ul class="itemize"><li class="li-itemize">
The UI now displays actions differently (in blue) when they have been
explicitly changed by the user from Unison&#X2019;s default recommendation.
</li><li class="li-itemize">More colorful appearance.
</li><li class="li-itemize">The initial profile selection window works better.
</li><li class="li-itemize">If any transfers failed, a message to this effect is displayed along with
&#X2019;Synchronization complete&#X2019; at the end of the transfer phase (in case they
may have scrolled off the top).
</li><li class="li-itemize">Added a global progress meter, displaying the percentage of <em>total</em>
bytes that have been transferred so far.
</li></ul></li><li class="li-itemize">Improvements to the text user interface:
<ul class="itemize"><li class="li-itemize">
The file details will be displayed automatically when a
conflict is been detected.
</li><li class="li-itemize">when a warning is generated (e.g. for a temporary
file left over from a previous run of unison) Unison will no longer
wait for a response if it is running in -batch mode.
</li><li class="li-itemize">The UI now displays a short list of possible inputs each time it waits
for user interaction.
</li><li class="li-itemize">The UI now quits immediately (rather than looping back and starting
the interaction again) if the user presses &#X2019;q&#X2019; when asked whether to
propagate changes.
</li><li class="li-itemize">Pressing &#X2019;g&#X2019; in the text user interface will proceed immediately
with propagating updates, without asking any more questions.
</li></ul></li><li class="li-itemize">Documentation and installation changes:
<ul class="itemize"><li class="li-itemize">
The manual now includes a FAQ, plus sections on common problems and
on tricks contributed by users.
</li><li class="li-itemize">Both the download page and the download directory explicitly say
what are the current stable and beta-test version numbers.
</li><li class="li-itemize">The OCaml sources for the up-to-the-minute developers&#X2019; version (not
guaranteed to be stable, or even to compile, at any given time!) are now
available from the download page.
</li><li class="li-itemize">Added a subsection to the manual describing cross-platform
issues (case conflicts, illegal filenames)
</li></ul></li><li class="li-itemize">Many small bug fixes and random improvements.</li></ul><p>Changes since 2.3.1:
</p><ul class="itemize"><li class="li-itemize">

Several bug fixes. The most important is a bug in the rsync
module that would occasionally cause change propagation to fail with a
&#X2019;rename&#X2019; error.

</li></ul><p>Changes since 2.2:
</p><ul class="itemize"><li class="li-itemize">

The multi-threaded transport system is now disabled by default.
(It is not stable enough yet.)
</li><li class="li-itemize">Various bug fixes.
</li><li class="li-itemize">A new experimental feature:<p>The final component of a -path argument may now be the wildcard
specifier <code class="verb">*</code>. When Unison sees such a path, it expands this path on
the client into into the corresponding list of paths by listing the
contents of that directory.</p><p>Note that if you use wildcard paths from the command line, you will
probably need to use quotes or a backslash to prevent the * from
being interpreted by your shell.</p><p>If both roots are local, the contents of the first one will be used
for expanding wildcard paths. (Nb: this is the first one <em>after</em> the
canonization step &#X2013; i.e., the one that is listed first in the user
interface &#X2013; not the one listed first on the command line or in the
preferences file.)

</p></li></ul><p>Changes since 2.1:
</p><ul class="itemize"><li class="li-itemize">

The transport subsystem now includes an implementation by
Sylvain Gommier and Norman Ramsey of Tridgell and Mackerras&#X2019;s
<code class="verb">rsync</code> protocol. This protocol achieves much faster
transfers when only a small part of a large file has been changed by
sending just diffs. This feature is mainly helpful for transfers over
slow links&#X2014;on fast local area networks it can actually degrade
performance&#X2014;so we have left it off by default. Start unison with
the <code class="verb">-rsync</code> option (or put <code class="verb">rsync=true</code> in your preferences
file) to turn it on.</li><li class="li-itemize">&#X201C;Progress bars&#X201D; are now displayed during remote file transfers,
showing what percentage of each file has been transferred so far.</li><li class="li-itemize">The version numbering scheme has changed. New releases will now
be have numbers like 2.2.30, where the second component is
incremented on every significant public release and the third
component is the &#X201C;patch level.&#X201D;</li><li class="li-itemize">Miscellaneous improvements to the GTK-based user interface.
</li><li class="li-itemize">The manual is now available in PDF format.</li><li class="li-itemize">We are experimenting with using a multi-threaded transport
subsystem to transfer several files at the same time, making
much more effective use of available network bandwidth. This feature
is not completely stable yet, so by default it is disabled in the
release version of Unison.<p>If you want to play with the multi-threaded version, you&#X2019;ll need to
recompile Unison from sources (as described in the documentation),
setting the THREADS flag in Makefile.OCaml to true. Make sure that
your OCaml compiler has been installed with the <code class="verb">-with-pthreads</code>
configuration option. (You can verify this by checking whether the
file <code class="verb">threads/threads.cma</code> in the OCaml standard library
directory contains the string <code class="verb">-lpthread</code> near the end.)

</p></li></ul><p>Changes since 1.292:
</p><ul class="itemize"><li class="li-itemize">

Reduced memory footprint (this is especially important during
the first run of unison, where it has to gather information about all
the files in both repositories).
</li><li class="li-itemize">Fixed a bug that would cause the socket server under NT to fail
after the client exits.
</li><li class="li-itemize">Added a SHIFT modifier to the Ignore menu shortcut keys in GTK
interface (to avoid hitting them accidentally).

</li></ul><p>Changes since 1.231:
</p><ul class="itemize"><li class="li-itemize">

Tunneling over ssh is now supported in the Windows version. See
the installation section of the manual for detailed instructions.</li><li class="li-itemize">The transport subsystem now includes an implementation of the
<code class="verb">rsync</code> protocol, built by Sylvain Gommier and Norman Ramsey.
This protocol achieves much faster transfers when only a small part of
a large file has been changed by sending just diffs. The rsync
feature is off by default in the current version. Use the
<code class="verb">-rsync</code> switch to turn it on. (Nb. We still have a lot of
tuning to do: you may not notice much speedup yet.)</li><li class="li-itemize">We&#X2019;re experimenting with a multi-threaded transport subsystem,
written by Jerome Vouillon. The downloadable binaries are still
single-threaded: if you want to try the multi-threaded version, you&#X2019;ll
need to recompile from sources. (Say <code class="verb">make THREADS=true</code>.)
Native thread support from the compiler is required. Use the option
<code class="verb">-threads N</code> to select the maximal number of concurrent
threads (default is 5). Multi-threaded
and single-threaded clients/servers can interoperate.</li><li class="li-itemize">A new GTK-based user interface is now available, thanks to
Jacques Garrigue. The Tk user interface still works, but we&#X2019;ll be
shifting development effort to the GTK interface from now on.
</li><li class="li-itemize">OCaml 3.00 is now required for compiling Unison from sources.
The modules <code class="verb">uitk</code> and <code class="verb">myfileselect</code> have been changed to
use labltk instead of camltk. To compile the Tk interface in Windows,
you must have ocaml-3.00 and tk8.3. When installing tk8.3, put it in
<code class="verb">c:\Tcl</code> rather than the suggested <code class="verb">c:\Program Files\Tcl</code>,
and be sure to install the headers and libraries (which are not
installed by default).</li><li class="li-itemize">Added a new <code class="verb">-addversionno</code> switch, which causes unison to
use <code class="verb">unison-&lt;currentversionnumber&gt;</code> instead of just <code class="verb">unison</code>
as the remote server command. This allows multiple versions of unison
to coexist conveniently on the same server: whichever version is run
on the client, the same version will be selected on the server.

</li></ul><p>Changes since 1.219:
</p><ul class="itemize"><li class="li-itemize">

<span style="font-weight:bold">Incompatible change:</span>
 Archive format has changed. Make sure you
synchronize your replicas before upgrading, to avoid spurious
conflicts. The first sync after upgrading will be slow.</li><li class="li-itemize">This version fixes several annoying bugs, including:
<ul class="itemize"><li class="li-itemize">
Some cases where propagation of file permissions was not
working.
</li><li class="li-itemize">umask is now ignored when creating directories
</li><li class="li-itemize">directories are create writable, so that a read-only directory and
its contents can be propagated.
</li><li class="li-itemize">Handling of warnings generated by the server.
</li><li class="li-itemize">Synchronizing a path whose parent is not a directory on both sides is
now flagged as erroneous.
</li><li class="li-itemize">Fixed some bugs related to symnbolic links and nonexistent roots.
<ul class="itemize"><li class="li-itemize">
When a change (deletion or new contents) is propagated onto a
&#X2019;follow&#X2019;ed symlink, the file pointed to by the link is now changed.
(We used to change the link itself, which doesn&#X2019;t fit our assertion
that &#X2019;follow&#X2019; means the link is completely invisible)
</li><li class="li-itemize">When one root did not exist, propagating the other root on top of it
used to fail, because unison could not calculate the working directory
into which to write changes. This should be fixed.
</li></ul>
</li></ul></li><li class="li-itemize">A human-readable timestamp has been added to Unison&#X2019;s archive files.</li><li class="li-itemize">The semantics of Path and Name regular expressions now
correspond better.</li><li class="li-itemize">Some minor improvements to the text UI (e.g. a command for going
back to previous items)</li><li class="li-itemize">The organization of the export directory has changed &#X2014; should
be easier to find / download things now.

</li></ul><p>Changes since 1.200:
</p><ul class="itemize"><li class="li-itemize">

<span style="font-weight:bold">Incompatible change:</span>
 Archive format has changed. Make sure you
synchronize your replicas before upgrading, to avoid spurious
conflicts. The first sync after upgrading will be slow.</li><li class="li-itemize">This version has not been tested extensively on Windows.</li><li class="li-itemize">Major internal changes designed to make unison safer to run
at the same time as the replicas are being changed by the user.</li><li class="li-itemize">Internal performance improvements.

</li></ul><p>Changes since 1.190:
</p><ul class="itemize"><li class="li-itemize">

<span style="font-weight:bold">Incompatible change:</span>
 Archive format has changed. Make sure you
synchronize your replicas before upgrading, to avoid spurious
conflicts. The first sync after upgrading will be slow.</li><li class="li-itemize">A number of internal functions have been changed to reduce the
amount of memory allocation, especially during the first
synchronization. This should help power users with very big replicas.</li><li class="li-itemize">Reimplementation of low-level remote procedure call stuff, in
preparation for adding rsync-like smart file transfer in a later
release.</li><li class="li-itemize">Miscellaneous bug fixes.

</li></ul><p>Changes since 1.180:
</p><ul class="itemize"><li class="li-itemize">

<span style="font-weight:bold">Incompatible change:</span>
 Archive format has changed. Make sure you
synchronize your replicas before upgrading, to avoid spurious
conflicts. The first sync after upgrading will be slow.</li><li class="li-itemize">Fixed some small bugs in the interpretation of ignore patterns.</li><li class="li-itemize">Fixed some problems that were preventing the Windows version
from working correctly when click-started.</li><li class="li-itemize">Fixes to treatment of file permissions under Windows, which were
causing spurious reports of different permissions when synchronizing
between windows and unix systems.</li><li class="li-itemize">Fixed one more non-tail-recursive list processing function,
which was causing stack overflows when synchronizing very large
replicas.

</li></ul><p>Changes since 1.169:
</p><ul class="itemize"><li class="li-itemize">

The text user interface now provides commands for ignoring
files.
</li><li class="li-itemize">We found and fixed some <em>more</em> non-tail-recursive list
processing functions. Some power users have reported success with
very large replicas.
</li><li class="li-itemize"><span style="font-weight:bold">Incompatible change:</span>
Files ending in <code class="verb">.tmp</code> are no longer ignored automatically. If you want
to ignore such files, put an appropriate ignore pattern in your profile.</li><li class="li-itemize"><span style="font-weight:bold">Incompatible change:</span>
 The syntax of <span style="font-family:monospace">ignore</span> and <span style="font-family:monospace">follow</span>
patterns has changed. Instead of putting a line of the form
<pre class="verbatim">                 ignore = &lt;regexp&gt;
</pre>
in your profile (<span style="font-family:monospace">.unison/default.prf</span>), you should put:
<pre class="verbatim">                 ignore = Regex &lt;regexp&gt;
</pre>
Moreover, two other styles of pattern are also recognized:
<pre class="verbatim">                 ignore = Name &lt;name&gt;
</pre>
matches any path in which one component matches <code class="verb">&lt;name&gt;</code>, while
<pre class="verbatim">                 ignore = Path &lt;path&gt;
</pre>
matches exactly the path <code class="verb">&lt;path&gt;</code>.<p>Standard &#X201C;globbing&#X201D; conventions can be used in <code class="verb">&lt;name&gt;</code> and
<code class="verb">&lt;path&gt;</code>:
</p><ul class="itemize"><li class="li-itemize">
a <code class="verb">?</code> matches any single character except <code class="verb">/</code>
</li><li class="li-itemize">a <code class="verb">*</code> matches any sequence of characters not including <code class="verb">/</code>
</li><li class="li-itemize"><code class="verb">[xyz]</code> matches any character from the set {<span style="font-family:monospace"><span style="font-style:italic">x</span></span>,
<span style="font-family:monospace"><span style="font-style:italic">y</span></span>, <span style="font-family:monospace"><span style="font-style:italic">z</span></span> }
</li><li class="li-itemize"><code class="verb">{a,bb,ccc}</code> matches any one of <code class="verb">a</code>, <code class="verb">bb</code>, or
<code class="verb">ccc</code>.
</li></ul><p>See the user manual for some examples.

</p></li></ul><p>Changes since 1.146:
</p><ul class="itemize"><li class="li-itemize">

Some users were reporting stack overflows when synchronizing
huge directories. We found and fixed some non-tail-recursive list
processing functions, which we hope will solve the problem. Please
give it a try and let us know.
</li><li class="li-itemize">Major additions to the documentation.

</li></ul><p>Changes since 1.142:
</p><ul class="itemize"><li class="li-itemize">

Major internal tidying and many small bugfixes.
</li><li class="li-itemize">Major additions to the user manual.
</li><li class="li-itemize">Unison can now be started with no arguments &#X2013; it will prompt
automatically for the name of a profile file containing the roots to
be synchronized. This makes it possible to start the graphical UI
from a desktop icon.
</li><li class="li-itemize">Fixed a small bug where the text UI on NT was raising a &#X2019;no such
signal&#X2019; exception.

</li></ul><p>Changes since 1.139:
</p><ul class="itemize"><li class="li-itemize">

The precompiled windows binary in the last release was compiled
with an old OCaml compiler, causing propagation of permissions not to
work (and perhaps leading to some other strange behaviors we&#X2019;ve heard
reports about). This has been corrected. If you&#X2019;re using precompiled
binaries on Windows, please upgrade.
</li><li class="li-itemize">Added a <code class="verb">-debug</code> command line flag, which controls debugging
of various modules. Say <code class="verb">-debug XXX</code> to enable debug tracing for
module <code class="verb">XXX</code>, or <code class="verb">-debug all</code> to turn on absolutely everything.
</li><li class="li-itemize">Fixed a small bug where the text UI on NT was raising a &#X2019;no such signal&#X2019;
exception.

</li></ul><p>Changes since 1.111:
</p><ul class="itemize"><li class="li-itemize">

<span style="font-weight:bold">Incompatible change:</span>
 The names and formats of the preference files in
the .unison directory have changed. In particular:
<ul class="itemize"><li class="li-itemize">
the file &#X201C;prefs&#X201D; should be renamed to default.prf
</li><li class="li-itemize">the contents of the file &#X201C;ignore&#X201D; should be merged into
default.prf. Each line of the form <code class="verb">REGEXP</code> in ignore should
become a line of the form <code class="verb">ignore = REGEXP</code> in default.prf.
</li></ul>
</li><li class="li-itemize">Unison now handles permission bits and symbolic links. See the
manual for details.</li><li class="li-itemize">You can now have different preference files in your .unison
directory. If you start unison like this
<pre class="verbatim">             unison profilename
</pre>
(i.e. with just one &#X201C;anonymous&#X201D; command-line argument), then the
file <code class="verb">~/.unison/profilename.prf</code> will be loaded instead of
<code class="verb">default.prf</code>.</li><li class="li-itemize">Some improvements to terminal handling in the text user interface</li><li class="li-itemize">Added a switch -killServer that terminates the remote server process
when the unison client is shutting down, even when using sockets for
communication. (By default, a remote server created using ssh/rsh is
terminated automatically, while a socket server is left running.)
</li><li class="li-itemize">When started in &#X2019;socket server&#X2019; mode, unison prints &#X2019;server started&#X2019; on
stderr when it is ready to accept connections.
(This may be useful for scripts that want to tell when a socket-mode server
has finished initialization.)
</li><li class="li-itemize">We now make a nightly mirror of our current internal development
tree, in case anyone wants an up-to-the-minute version to hack
around with.
</li><li class="li-itemize">Added a file CONTRIB with some suggestions for how to help us
make Unison better.

</li></ul><p></div></p><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<hr class="horizontal-rule" style="height:2px"><blockquote class="quote"><em>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</em><a href="http://hevea.inria.fr/index.html"><em>H</em><em><span style="font-size:small"><sup>E</sup></span></em><em>V</em><em><span style="font-size:small"><sup>E</sup></span></em><em>A</em></a><em>.</em></blockquote></body>
</html>
